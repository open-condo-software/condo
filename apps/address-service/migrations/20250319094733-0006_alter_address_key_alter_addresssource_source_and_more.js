// auto generated by kmigrator
// KMIGRATOR:0006_alter_address_key_alter_addresssource_source_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI1LTAzLTE5IDA0OjQ3Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMDA1X2F1dG9fMjAyNTAyMjBfMTAxNycpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhZGRyZXNzJywKICAgICAgICAgICAgbmFtZT0na2V5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZCgpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhZGRyZXNzc291cmNlJywKICAgICAgICAgICAgbmFtZT0nc291cmNlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZCgpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhZGRyZXNzJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgna2V5JywpLCBuYW1lPSdhZGRyZXNzX2tleV91bmlxdWVfa2V5JyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FkZHJlc3Nzb3VyY2UnLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSkpLCBmaWVsZHM9KCdzb3VyY2UnLCksIG5hbWU9J2FkZHJlc3Nzb3VyY2Vfc291cmNlX3VuaXF1ZV9rZXknKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;

SET statement_timeout = '1500s';

--
-- Alter field key on address
--
ALTER TABLE "Address" DROP CONSTRAINT "Address_key_key";
DROP INDEX IF EXISTS "Address_key_2e11173a_like";
--
-- Alter field source on addresssource
--
ALTER TABLE "AddressSource" DROP CONSTRAINT "AddressSource_source_key";
DROP INDEX IF EXISTS "AddressSource_source_c1fa68ce_like";
--
-- Create constraint address_key_unique_key on model address
--
CREATE UNIQUE INDEX "address_key_unique_key" ON "Address" ("key") WHERE "deletedAt" IS NULL;
--
-- Create constraint addresssource_source_unique_key on model addresssource
--
CREATE UNIQUE INDEX "addresssource_source_unique_key" ON "AddressSource" ("source") WHERE "deletedAt" IS NULL;

SET statement_timeout = '10s';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;

SET statement_timeout = '1500s';

--
-- Create constraint addresssource_source_unique_key on model addresssource
--
DROP INDEX IF EXISTS "addresssource_source_unique_key";
--
-- Create constraint address_key_unique_key on model address
--
DROP INDEX IF EXISTS "address_key_unique_key";
--
-- Alter field source on addresssource
--
ALTER TABLE "AddressSource" ADD CONSTRAINT "AddressSource_source_key" UNIQUE ("source");
CREATE INDEX "AddressSource_source_c1fa68ce_like" ON "AddressSource" ("source" text_pattern_ops);
--
-- Alter field key on address
--
ALTER TABLE "Address" ADD CONSTRAINT "Address_key_key" UNIQUE ("key");
CREATE INDEX "Address_key_2e11173a_like" ON "Address" ("key" text_pattern_ops);

SET statement_timeout = '10s';

COMMIT;

    `)
}
