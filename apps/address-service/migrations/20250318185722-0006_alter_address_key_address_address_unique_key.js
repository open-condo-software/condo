// auto generated by kmigrator
// KMIGRATOR:0006_alter_address_key_address_address_unique_key:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI1LTAzLTE4IDEzOjU3Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMDA1X2F1dG9fMjAyNTAyMjBfMTAxNycpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhZGRyZXNzJywKICAgICAgICAgICAgbmFtZT0na2V5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZCgpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhZGRyZXNzJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgna2V5JywpLCBuYW1lPSdhZGRyZXNzX3VuaXF1ZV9rZXknKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
    
SET statement_timeout = '1500s';

--
-- Alter field key on address
--
ALTER TABLE "Address" DROP CONSTRAINT "Address_key_key";
DROP INDEX IF EXISTS "Address_key_2e11173a_like";
--
-- Create constraint address_unique_key on model address
--
CREATE UNIQUE INDEX "address_unique_key" ON "Address" ("key") WHERE "deletedAt" IS NULL;

SET statement_timeout = '10s';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
    
SET statement_timeout = '1500s';

--
-- Create constraint address_unique_key on model address
--
DROP INDEX IF EXISTS "address_unique_key";
--
-- Alter field key on address
--
ALTER TABLE "Address" ADD CONSTRAINT "Address_key_2e11173a_uniq" UNIQUE ("key");
CREATE INDEX "Address_key_2e11173a_like" ON "Address" ("key" text_pattern_ops);

SET statement_timeout = '10s';

COMMIT;

    `)
}
