// auto generated by kmigrator
// KMIGRATOR:0008_addressheuristichistoryrecord_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI2LTAyLTEyIDExOjM3CgppbXBvcnQgZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMDA3X2F1dG9fMjAyNjAyMDlfMDcwNScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nYWRkcmVzc2hldXJpc3RpY2hpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdhZGRyZXNzJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndHlwZScsIG1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3ZhbHVlJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgncmVsaWFiaWxpdHknLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdwcm92aWRlcicsIG1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2xhdGl0dWRlJywgbW9kZWxzLkRlY2ltYWxGaWVsZChibGFuaz1UcnVlLCBkZWNpbWFsX3BsYWNlcz00LCBtYXhfZGlnaXRzPTE4LCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbG9uZ2l0dWRlJywgbW9kZWxzLkRlY2ltYWxGaWVsZChibGFuaz1UcnVlLCBkZWNpbWFsX3BsYWNlcz00LCBtYXhfZGlnaXRzPTE4LCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbWV0YScsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2VuYWJsZWQnLCBtb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9kYXRlJywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfYWN0aW9uJywgbW9kZWxzLkNoYXJGaWVsZChtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQWRkcmVzc0hldXJpc3RpY0hpc3RvcnlSZWNvcmQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWRkcmVzcycsCiAgICAgICAgICAgIG5hbWU9J3Bvc3NpYmxlRHVwbGljYXRlT2YnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3Bvc3NpYmxlRHVwbGljYXRlT2YnLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkRPX05PVEhJTkcsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5hZGRyZXNzJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhZGRyZXNzaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J3Bvc3NpYmxlRHVwbGljYXRlT2YnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdhZGRyZXNzaGV1cmlzdGljJywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgndHlwZScsIG1vZGVscy5DaGFyRmllbGQobWF4X2xlbmd0aD01MCkpLAogICAgICAgICAgICAgICAgKCd2YWx1ZScsIG1vZGVscy5UZXh0RmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3JlbGlhYmlsaXR5JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgncHJvdmlkZXInLCBtb2RlbHMuQ2hhckZpZWxkKG1heF9sZW5ndGg9NTApKSwKICAgICAgICAgICAgICAgICgnbGF0aXR1ZGUnLCBtb2RlbHMuRGVjaW1hbEZpZWxkKGJsYW5rPVRydWUsIGRlY2ltYWxfcGxhY2VzPTgsIG1heF9kaWdpdHM9MTgsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdsb25naXR1ZGUnLCBtb2RlbHMuRGVjaW1hbEZpZWxkKGJsYW5rPVRydWUsIGRlY2ltYWxfcGxhY2VzPTgsIG1heF9kaWdpdHM9MTgsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdtZXRhJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZW5hYmxlZCcsIG1vZGVscy5Cb29sZWFuRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoZGVmYXVsdD0xKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdhZGRyZXNzJywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdhZGRyZXNzJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5ET19OT1RISU5HLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuYWRkcmVzcycpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjcmVhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQWRkcmVzc0hldXJpc3RpYycsCiAgICAgICAgICAgICAgICAnY29uc3RyYWludHMnOiBbbW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3R5cGUnLCAndmFsdWUnKSwgbmFtZT0nYWRkcmVzc2hldXJpc3RpY190eXBlX3ZhbHVlX3VuaXF1ZScpXSwKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgXQo=
// KMIGRATOR_VIEWS:0008_addressheuristichistoryrecord_and_more:eyJkdiI6MSwibGlzdHMiOnsiVXNlciI6eyJmaWVsZHMiOlsiY3JlYXRlZEF0IiwiY3JlYXRlZEJ5IiwiZGVsZXRlZEF0IiwiZHYiLCJlbWFpbCIsImlkIiwiaXNBZG1pbiIsImlzU3VwcG9ydCIsIm5hbWUiLCJuZXdJZCIsInBhc3N3b3JkIiwic2VuZGVyIiwidXBkYXRlZEF0IiwidXBkYXRlZEJ5IiwidiJdLCJzZW5zaXRpdmVGaWVsZHMiOlsiZW1haWwiLCJuYW1lIiwicGFzc3dvcmQiXX0sIkFkZHJlc3MiOnsiZmllbGRzIjpbImFkZHJlc3MiLCJjcmVhdGVkQXQiLCJjcmVhdGVkQnkiLCJkZWxldGVkQXQiLCJkdiIsImlkIiwia2V5IiwibWV0YSIsIm5ld0lkIiwib3ZlcnJpZGVzIiwicG9zc2libGVEdXBsaWNhdGVPZiIsInNlbmRlciIsInVwZGF0ZWRBdCIsInVwZGF0ZWRCeSIsInYiXSwic2Vuc2l0aXZlRmllbGRzIjpbXX0sIkFkZHJlc3NJbmplY3Rpb24iOnsiZmllbGRzIjpbImFyZWEiLCJibG9jayIsImNpdHkiLCJjaXR5RGlzdHJpY3QiLCJjb3VudHJ5IiwiY3JlYXRlZEF0IiwiY3JlYXRlZEJ5IiwiZGVsZXRlZEF0IiwiZHYiLCJob3VzZSIsImlkIiwia2V5d29yZHMiLCJtZXRhIiwibmV3SWQiLCJyZWdpb24iLCJzZW5kZXIiLCJzZXR0bGVtZW50Iiwic3RyZWV0IiwidXBkYXRlZEF0IiwidXBkYXRlZEJ5IiwidiJdLCJzZW5zaXRpdmVGaWVsZHMiOltdfSwiQWRkcmVzc1NvdXJjZSI6eyJmaWVsZHMiOlsiYWRkcmVzcyIsImNyZWF0ZWRBdCIsImNyZWF0ZWRCeSIsImRlbGV0ZWRBdCIsImR2IiwiaWQiLCJuZXdJZCIsInNlbmRlciIsInNvdXJjZSIsInVwZGF0ZWRBdCIsInVwZGF0ZWRCeSIsInYiXSwic2Vuc2l0aXZlRmllbGRzIjpbXX19fQ==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model addressheuristichistoryrecord
--
CREATE TABLE "AddressHeuristicHistoryRecord" ("address" uuid NULL, "type" text NULL, "value" text NULL, "reliability" integer NULL, "provider" text NULL, "latitude" numeric(18, 8) NULL, "longitude" numeric(18, 8) NULL, "meta" jsonb NULL, "enabled" boolean NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field possibleDuplicateOf to address
--
ALTER TABLE "Address" ADD COLUMN "possibleDuplicateOf" uuid NULL CONSTRAINT "Address_possibleDuplicateOf_9f161b1e_fk_Address_id" REFERENCES "Address"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Address_possibleDuplicateOf_9f161b1e_fk_Address_id" IMMEDIATE;
--
-- Add field possibleDuplicateOf to addresshistoryrecord
--
ALTER TABLE "AddressHistoryRecord" ADD COLUMN "possibleDuplicateOf" uuid NULL;
--
-- Create model addressheuristic
--
CREATE TABLE "AddressHeuristic" ("type" varchar(50) NOT NULL, "value" text NOT NULL, "reliability" integer NOT NULL, "provider" varchar(50) NOT NULL, "latitude" numeric(18, 8) NULL, "longitude" numeric(18, 8) NULL, "meta" jsonb NULL, "enabled" boolean NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "address" uuid NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
CREATE INDEX "AddressHeuristicHistoryRecord_history_id_a9197fc0" ON "AddressHeuristicHistoryRecord" ("history_id");
CREATE INDEX "Address_possibleDuplicateOf_9f161b1e" ON "Address" ("possibleDuplicateOf");
ALTER TABLE "AddressHeuristic" ADD CONSTRAINT "AddressHeuristic_address_3d0fec3b_fk_Address_id" FOREIGN KEY ("address") REFERENCES "Address" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AddressHeuristic" ADD CONSTRAINT "AddressHeuristic_createdBy_dd03fcd4_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AddressHeuristic" ADD CONSTRAINT "AddressHeuristic_updatedBy_6c3a2fb0_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE UNIQUE INDEX "addressheuristic_type_value_unique" ON "AddressHeuristic" ("type", "value") WHERE "deletedAt" IS NULL;
CREATE INDEX "AddressHeuristic_createdAt_c54713cc" ON "AddressHeuristic" ("createdAt");
CREATE INDEX "AddressHeuristic_updatedAt_ce867486" ON "AddressHeuristic" ("updatedAt");
CREATE INDEX "AddressHeuristic_deletedAt_599a8f16" ON "AddressHeuristic" ("deletedAt");
CREATE INDEX "AddressHeuristic_address_3d0fec3b" ON "AddressHeuristic" ("address");
CREATE INDEX "AddressHeuristic_createdBy_dd03fcd4" ON "AddressHeuristic" ("createdBy");
CREATE INDEX "AddressHeuristic_updatedBy_6c3a2fb0" ON "AddressHeuristic" ("updatedBy");
COMMIT;

--
-- Recreate view for "Address" table
--
DROP VIEW IF EXISTS "analytics"."Address";
CREATE VIEW "analytics"."Address" AS (SELECT "address", "createdAt", "createdBy", "deletedAt", "dv", "id", "key", "meta", "newId", "overrides", "possibleDuplicateOf", "sender", "updatedAt", "updatedBy", "v" FROM "public"."Address");

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model addressheuristic
--
DROP TABLE "AddressHeuristic" CASCADE;
--
-- Add field possibleDuplicateOf to addresshistoryrecord
--
ALTER TABLE "AddressHistoryRecord" DROP COLUMN "possibleDuplicateOf" CASCADE;
--
-- Add field possibleDuplicateOf to address
--
ALTER TABLE "Address" DROP COLUMN "possibleDuplicateOf" CASCADE;
--
-- Create model addressheuristichistoryrecord
--
DROP TABLE "AddressHeuristicHistoryRecord" CASCADE;
COMMIT;

--
-- Recreate view for "Address" table
--
DROP VIEW IF EXISTS "analytics"."Address";
CREATE VIEW "analytics"."Address" AS (SELECT "address", "createdAt", "createdBy", "deletedAt", "dv", "id", "key", "meta", "newId", "overrides", "sender", "updatedAt", "updatedBy", "v" FROM "public"."Address");

    `)
}
