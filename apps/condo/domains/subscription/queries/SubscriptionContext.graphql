query getOrganizationTrialSubscriptions($organizationId: ID!) {
    trialSubscriptions: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            isTrial: true
        }
        sortBy: [createdAt_DESC]
        first: 100
    ) {
        id
        subscriptionPlan {
            id
            name
        }
        isTrial
        startAt
        daysRemaining
        endAt
        createdAt
    }
}

query getLastExpiredSubscriptionContext($organizationId: ID!, $now: String!) {
    lastExpiredContext: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            endAt_lt: $now
            deletedAt: null
        }
        sortBy: [endAt_DESC]
        first: 1
    ) {
        id
        subscriptionPlan {
            id
            name
        }
        isTrial
        startAt
        endAt
    }
}

query getActiveSubscriptionContexts($organizationId: ID!, $now: String!) {
    activeContexts: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            startAt_lte: $now
            deletedAt: null
            OR: [
                { endAt: null }
                { endAt_gt: $now }
            ]
        }
        first: 100
        sortBy: [startAt_DESC]
    ) {
        id
        subscriptionPlan {
            id
            name
            trialDays
            priority
            canBePromoted
            payments
            meters
            tickets
            news
            marketplace
            support
            ai
            customization
            enabledB2BApps
            enabledB2CApps
        }
        basePrice
        calculatedPrice
        appliedRules
        isTrial
        startAt
        endAt
        daysRemaining
    }
}