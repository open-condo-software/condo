query getOrganizationActivatedSubscriptions($organizationId: ID!) {
    activatedSubscriptions: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
        }
        sortBy: [createdAt_DESC]
        first: 100
    ) {
        id
        subscriptionPlan {
            id
            name
            priority
        }
        isTrial
        endAt
        meta
    }
}

query getOrganizationTrialSubscriptions($organizationId: ID!) {
    trialSubscriptions: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            isTrial: true
        }
        sortBy: [createdAt_DESC]
        first: 100
    ) {
        id
        subscriptionPlan {
            id
            name
        }
        isTrial
        startAt
        daysRemaining
        endAt
        createdAt
        meta
    }
}

query getLastExpiredSubscriptionContext($organizationId: ID!, $now: String!) {
    lastExpiredContext: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            endAt_lte: $now
        }
        sortBy: [endAt_DESC]
        first: 1
    ) {
        id
        subscriptionPlan {
            id
            name
        }
        isTrial
        startAt
        endAt
        meta
    }
}

query getSubscriptionContextById($id: ID!) {
    subscriptionContext: SubscriptionContext(where: { id: $id }) {
        id
        subscriptionPlan {
            id
            name
            priority
            canBePromoted
        }
        isTrial
        startAt
        endAt
        daysRemaining
        meta
    }
}