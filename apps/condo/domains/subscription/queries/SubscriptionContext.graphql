query getSubscriptionContext($id: ID!) {
    subscriptionContext: SubscriptionContext(where: { id: $id }) {
        id
        organization {
            id
            name
        }
        subscriptionPlan {
            id
            name
            description
            organizationType
            trialDays
            priority
            news
            marketplace
            support
            ai
            disabledB2BApps
            disabledB2CApps
            isHidden
        }
        startAt
        endAt
        basePrice
        calculatedPrice
        appliedRules
        isTrial
        daysRemaining
        dv
        sender {
            dv
            fingerprint
        }
        v
        deletedAt
        newId
        createdBy {
            id
            name
        }
        updatedBy {
            id
            name
        }
        createdAt
        updatedAt
    }
}

query getOrganizationTrialSubscriptions($organizationId: ID!) {
    trialSubscriptions: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            isTrial: true
        }
        sortBy: [createdAt_DESC]
    ) {
        id
        subscriptionPlan {
            id
            name
        }
        isTrial
        startAt
        daysRemaining
        endAt
        createdAt
    }
}

query getLastExpiredSubscriptionContext($organizationId: ID!, $now: String!) {
    lastExpiredContext: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            endAt_lt: $now
            deletedAt: null
        }
        sortBy: [endAt_DESC]
        first: 1
    ) {
        id
        subscriptionPlan {
            id
            name
        }
        isTrial
        startAt
        endAt
    }
}

query getActiveSubscriptionContexts($organizationId: ID!, $now: String!) {
    activeContexts: allSubscriptionContexts(
        where: {
            organization: { id: $organizationId }
            startAt_lte: $now
            deletedAt: null
            OR: [
                { endAt: null }
                { endAt_gt: $now }
            ]
        }
        sortBy: [startAt_DESC]
    ) {
        id
        subscriptionPlan {
            id
            name
            trialDays
            priority
            canBePromoted
            payments
            meters
            tickets
            news
            marketplace
            support
            ai
            customization
            disabledB2BApps
            disabledB2CApps
        }
        basePrice
        calculatedPrice
        appliedRules
        isTrial
        startAt
        endAt
        daysRemaining
    }
}