/**
 * Generated by `createservice common._internalScheduleTaskByNameService --type mutations`
 */

const { makeClient, expectToThrowAccessDeniedErrorToResult, expectToThrowAuthenticationErrorToResult, makeLoggedInAdminClient } = require('@open-condo/keystone/test.utils')

const { _internalScheduleTaskByNameByTestClient } = require('@condo/domains/common/utils/testSchema')
const { makeLoggedInClient, makeClientWithSupportUser } = require('@condo/domains/user/utils/testSchema')


describe('_internalScheduleTaskByNameService', () => {
    test('admin can execute mutation', async () => {
        const admin = await makeLoggedInAdminClient()
        const payload = {
            taskName: 'commonSampleCronTask',
        }
        const [data] = await _internalScheduleTaskByNameByTestClient(admin, payload)
        expect(data.id).toBeDefined()
    })

    test('support can not execute mutation', async () => {
        const support = await makeClientWithSupportUser()
        const payload = {
            taskName: 'commonSampleCronTask',
        }
        await expectToThrowAccessDeniedErrorToResult(async () => {
            await _internalScheduleTaskByNameByTestClient(support, payload)
        })
    })

    test('user can not execute mutation', async () => {
        const client = await makeLoggedInClient()
        const payload = {
            taskName: 'commonSampleCronTask',
        }
        await expectToThrowAccessDeniedErrorToResult(async () => {
            await _internalScheduleTaskByNameByTestClient(client, payload)
        })
    })
 
    test('anonymous can not execute mutation', async () => {
        const client = await makeClient()
        const payload = {
            taskName: 'commonSampleCronTask',
        }
        await expectToThrowAuthenticationErrorToResult(async () => {
            await _internalScheduleTaskByNameByTestClient(client, payload)
        })
    })
})