/**
 * Generated by `createservice common._internalScheduleTaskByNameService --type mutations`
 */
const { get } = require('lodash')

const { GQLCustomSchema } = require('@open-condo/keystone/schema')
const { scheduleTaskByNameWithArgsAndOpts } = require('@open-condo/keystone/tasks')

const access = require('@condo/domains/common/access/_internalScheduleTaskByNameService')

const _internalScheduleTaskByNameService = new GQLCustomSchema('_internalScheduleTaskByNameService', {
    types: [
        {
            access: true,
            type: 'input _internalScheduleTaskByNameInput { dv: Int!, sender: JSON!, taskName: String!, taskArgs: JSON }',
        },
        {
            access: true,
            type: 'type _internalScheduleTaskByNameOutput { id: String! }',
        },
    ],
    
    mutations: [
        {
            access: access.can_internalScheduleTaskByName,
            schema: '_internalScheduleTaskByName(data: _internalScheduleTaskByNameInput!): _internalScheduleTaskByNameOutput',
            schemaDoc: 'An internal module to schedule tasks. Should not be used by anyone except of system administrators',
            resolver: async (parent, args, context, info, extra = {}) => {

                const taskName = get(args, ['data', 'taskName'])
                const taskArgs = get(args, ['data', 'taskArgs'], [])

                const task = await scheduleTaskByNameWithArgsAndOpts(taskName, taskArgs)
                return {
                    id: task.id,
                }
            },
        },
    ],
    
})

module.exports = {
    _internalScheduleTaskByNameService,
}
