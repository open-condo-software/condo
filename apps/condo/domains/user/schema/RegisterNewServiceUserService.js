/**
 * Generated by `createservice user.RegisterNewServiceUserService`
 */
const faker = require('faker')

const { GQLCustomSchema, getById } = require('@core/keystone/schema')

const access = require('@condo/domains/user/access/RegisterNewServiceUserService')
const { STAFF, MIN_PASSWORD_LENGTH } = require('@condo/domains/user/constants/common')
const { MIN_PASSWORD_LENGTH_ERROR } = require('@condo/domains/user/constants/errors')
const { User } = require('@condo/domains/user/utils/serverSchema')


const RegisterNewServiceUserService = new GQLCustomSchema('RegisterNewServiceUserService', {
    types: [
        {
            access: true,
            type: 'input RegisterNewServiceUserInput {  dv: Int!, sender: SenderFieldInput!, name: String!, email: String!, password: String! meta: JSON }',
        },
    ],
    
    mutations: [
        {
            access: access.canRegisterNewServiceUser,
            schema: 'registerNewServiceUser(data: RegisterNewServiceUserInput!): User',
            resolver: async (parent, args, context) => {
                const userData = {
                    ...args.data,
                    type: STAFF,
                    password: faker.internet.password()
                }
                const user = {...await User.create(context, userData)}

                // Hack that helps to resolve all subfields in result of this mutation
                return await getById('User', user.id)
            },
        },
    ],
    
})

module.exports = {
    RegisterNewServiceUserService,
}
