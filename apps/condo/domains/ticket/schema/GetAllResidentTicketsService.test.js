/**
 * Generated by `createservice ticket.GetAllResidentTicketsService --type queries`
 */
const { addResidentAccess } = require('@condo/domains/user/utils/testSchema')
const { makeClientWithProperty } =  require('@condo/domains/property/utils/testSchema')
const { createResidentTicketByTestClient } = require('@condo/domains/ticket/utils/testSchema')
const { makeLoggedInAdminClient, makeClient } = require('@core/keystone/test.utils')
const { getAllResidentTicketsByTestClient } = require('@condo/domains/ticket/utils/testSchema')

describe('GetAllResidentTicketsService', () => {
    test('resident: can read resident ticket', async () => {
        const userClient = await makeClientWithProperty()
        await addResidentAccess(userClient.user)
        await createResidentTicketByTestClient(userClient, userClient.property)

        const [data] = await getAllResidentTicketsByTestClient(userClient, {}, 1, 0)
        expect(data).toHaveLength(1)
    })

    test('user: can read only own resident ticket', async () => {
        const client = await makeClientWithProperty()
        await addResidentAccess(client.user)
        const client1 = await makeClientWithProperty()
        await addResidentAccess(client1.user)
        await createResidentTicketByTestClient(client, client.property)
        await createResidentTicketByTestClient(client1, client1.property)

        const [data] = await getAllResidentTicketsByTestClient(client, {}, 1, 0)
        expect(data).toHaveLength(1)
    })

    test('anonymous: didn\'t get resident ticket', async () => {
        const client = await makeClient()
        try {
            await getAllResidentTicketsByTestClient(client, {}, 1, 0)
        } catch (error) {
            expect(error.errors).toHaveLength(1)
            expect(error.errors[0].name).toEqual('AuthenticationError')
        }
    })

    test('admin: get resident tickets', async () => {
        const admin = await makeLoggedInAdminClient()
        const client = await makeClientWithProperty()
        await addResidentAccess(client.user)
        await createResidentTicketByTestClient(client, client.property)

        const [data] = await getAllResidentTicketsByTestClient(admin, {}, 1, 0)
        expect(data).toHaveLength(1)
    })
})