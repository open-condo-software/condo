/**
 * Generated by `createservice ticket.ResidentTicketService --type mutations`
 */

const { makeLoggedInClient } = require('../../user/utils/testSchema')
const { createTestProperty } = require('@condo/domains/property/utils/testSchema')
const { createTestTicketClassifier } = require('@condo/domains/ticket/utils/testSchema')
const { createTestOrganization } = require('@condo/domains/organization/utils/testSchema')
const { makeLoggedInAdminClient, makeClient } = require('@core/keystone/test.utils')
const { createResidentTicketByTestClient } = require('@condo/domains/ticket/utils/testSchema')

describe('CreateResidentTicketService', () => {
    test('user: create resident ticket', async () => {
        const admin = await makeLoggedInAdminClient()
        const client = await makeLoggedInClient()
        const [organization] = await createTestOrganization(admin)
        const [classifier] = await createTestTicketClassifier(admin)
        const [property] = await createTestProperty(admin, organization)
        const [data] = await createResidentTicketByTestClient(client, organization, classifier, property)
        expect(data.id).toBeDefined()
    })

    test('anonymous: create resident ticket', async () => {
        const anon = await makeClient()
        const admin = await makeLoggedInAdminClient()
        const [organization] = await createTestOrganization(admin)
        const [classifier] = await createTestTicketClassifier(admin)
        const [property] = await createTestProperty(admin, organization)

        try {
            await createResidentTicketByTestClient(anon, organization, classifier, property)
        } catch (error) {
            expect(error.errors).toHaveLength(1)
            expect(error.errors[0].name).toEqual('AuthenticationError')
        }
    })

    test('admin: create resident ticket', async () => {
        const admin = await makeLoggedInAdminClient()
        const [organization] = await createTestOrganization(admin)
        const [classifier] = await createTestTicketClassifier(admin)
        const [property] = await createTestProperty(admin, organization)
        const [data] = await createResidentTicketByTestClient(admin, organization, classifier, property)
        expect(data.id).toBeDefined()
    })
})
