const { Ticket } = require('../utils/serverSchema')
const { getById } = require('@core/keystone/schema')

/**
 * Generated by `createservice ticket.GetAllResidentTicketsService --type queries`
 */

const { GQLCustomSchema } = require('@core/keystone/schema')
const access = require('@condo/domains/ticket/access/GetAllResidentTicketsService')
const { find } = require('@core/keystone/schema')

const GetAllResidentTicketsService = new GQLCustomSchema('GetAllResidentTicketsService', {
    queries: [
        {
            access: access.canGetAllResidentTickets,
            schema: 'getAllResidentTickets (where: TicketWhereInput, skip: Int!, limit: Int!): [Ticket]',
            resolver: async (parent, args, context, info, extra = {}) => {
                const { where, skip, limit } = args
                const clientId = context.req.user.id
                const tickets = await find('Ticket', { ...where, client: { id: clientId } })

                return tickets.slice(skip, skip + limit)
            },
        },
    ],
    
})

module.exports = {
    GetAllResidentTicketsService,
}
