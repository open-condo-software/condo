// auto generated by kmigrator
// KMIGRATOR:0291_auto_20230627_0756:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMSBvbiAyMDIzLTA2LTI3IDA3OjU2Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucwoKCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6CgogICAgZGVwZW5kZW5jaWVzID0gWwogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDI5MF9hdXRvXzIwMjMwNjI3XzA3NTInKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
    
    SET statement_timeout = '1500s';  
    
    UPDATE "BillingReceipt"
    SET "formula" = "toPayDetails"->>'formula'
    WHERE "toPayDetails"->>'formula' IS NOT NULL;
    
    UPDATE "BillingReceipt"
    SET "charge" = CAST("toPayDetails"->>'charge' AS NUMERIC)
    WHERE "toPayDetails"->>'charge' IS NOT NULL;
    
    UPDATE "BillingReceipt"
    SET "balance" = CAST("toPayDetails"->>'balance' AS NUMERIC)
    WHERE "toPayDetails"->>'balance' IS NOT NULL;
    
    UPDATE "BillingReceipt"
    SET "recalculation" = CAST("toPayDetails"->>'recalculation' AS NUMERIC)
    WHERE "toPayDetails"->>'recalculation' IS NOT NULL;
    
    UPDATE "BillingReceipt"
    SET "privilege" = CAST("toPayDetails"->>'privilege' AS NUMERIC)
    WHERE "toPayDetails"->>'privilege' IS NOT NULL;
    
    UPDATE "BillingReceipt"
    SET "penalty" = CAST("toPayDetails"->>'penalty' AS NUMERIC)
    WHERE "toPayDetails"->>'penalty' IS NOT NULL;
        
    UPDATE "BillingReceipt"
    SET "paid" = CAST("toPayDetails"->>'paid' AS NUMERIC)
    WHERE "toPayDetails"->>'paid' IS NOT NULL;
    
    SET statement_timeout = '10s';
    
    COMMIT;
    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
    
    COMMIT;
    `)
}
