// auto generated by kmigrator
// KMIGRATOR:0173_delete_organizationemployee_specializations_many:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMSBvbiAyMDIyLTA5LTI3IDE1OjI0Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucwoKCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6CgogICAgZGVwZW5kZW5jaWVzID0gWwogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDE3Ml9wcm9wZXJ0eXNjb3BlX3Byb3BlcnR5c2NvcGVoaXN0b3J5cmVjb3JkX2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkRlbGV0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZV9zcGVjaWFsaXphdGlvbnNfbWFueScsCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
     BEGIN;
    -- it's required for gen_random_uuid() function!
    CREATE EXTENSION if not exists pgcrypto;
    END;
    
    BEGIN;
--
-- Move data from "OrganizationEmployee_specializations_many" to "SpecializationScope"
INSERT INTO "SpecializationScope" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "employee", "specialization")
SELECT gen_random_uuid(), 1, 1, '{"dv": 1, "fingerprint": "migration"}'::json, now(), now(), specs."OrganizationEmployee_left_id", specs."TicketCategoryClassifier_right_id"
FROM "OrganizationEmployee_specializations_many" as specs;

-- Delete model organizationemployee_specializations_many
--
DROP TABLE "OrganizationEmployee_specializations_many" CASCADE;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Delete model organizationemployee_specializations_many
--
CREATE TABLE "OrganizationEmployee_specializations_many" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "OrganizationEmployee_left_id" uuid NOT NULL, "TicketCategoryClassifier_right_id" uuid NOT NULL);
ALTER TABLE "OrganizationEmployee_specializations_many" ADD CONSTRAINT "OrganizationEmployee_OrganizationEmployee_cb80e37b_fk_Organizat" FOREIGN KEY ("OrganizationEmployee_left_id") REFERENCES "OrganizationEmployee" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "OrganizationEmployee_specializations_many" ADD CONSTRAINT "OrganizationEmployee_TicketCategoryClassi_ee1eb7bd_fk_TicketCat" FOREIGN KEY ("TicketCategoryClassifier_right_id") REFERENCES "TicketCategoryClassifier" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "OrganizationEmployee_speci_OrganizationEmployee_left__cb80e37b" ON "OrganizationEmployee_specializations_many" ("OrganizationEmployee_left_id");
CREATE INDEX "OrganizationEmployee_speci_TicketCategoryClassifier_r_ee1eb7bd" ON "OrganizationEmployee_specializations_many" ("TicketCategoryClassifier_right_id");
COMMIT;

    `)
}
