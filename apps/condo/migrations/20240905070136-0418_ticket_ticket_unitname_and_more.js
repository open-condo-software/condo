// auto generated by kmigrator
// KMIGRATOR:0418_ticket_ticket_unitname_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMi4xMyBvbiAyMDI0LTA5LTA1IDA0OjAxCgppbXBvcnQgZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuaW5kZXhlcwpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucwoKCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6CgogICAgZGVwZW5kZW5jaWVzID0gWwogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDQxN19iaWxsaW5ncmVjZWlwdF9iaWxsaW5ncmVjZWlwdF9wZXJpb2RfY29udGV4dCcpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BZGRJbmRleCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0JywKICAgICAgICAgICAgaW5kZXg9ZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuaW5kZXhlcy5CVHJlZUluZGV4KGZpZWxkcz1bJ3VuaXROYW1lJ10sIG5hbWU9J3RpY2tldF91bml0TmFtZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRJbmRleCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0JywKICAgICAgICAgICAgaW5kZXg9ZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuaW5kZXhlcy5CVHJlZUluZGV4KGZpZWxkcz1bJ2Fzc2lnbmVlJywgJ2V4ZWN1dG9yJywgJ29yZ2FuaXphdGlvbiddLCBuYW1lPSd0aWNrZXRfYXNzaWduZWVfZXhlY19vcmcnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkSW5kZXgoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldCcsCiAgICAgICAgICAgIGluZGV4PWRqYW5nby5jb250cmliLnBvc3RncmVzLmluZGV4ZXMuQlRyZWVJbmRleChmaWVsZHM9Wydvcmdhbml6YXRpb24nLCAnc3RhdHVzJ10sIG5hbWU9J3RpY2tldF9vcmdhbml6YXRpb25fc3RhdHVzJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEluZGV4KAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXQnLAogICAgICAgICAgICBpbmRleD1kamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5pbmRleGVzLkJUcmVlSW5kZXgoZmllbGRzPVsnb3JkZXInLCAnLWNyZWF0ZWRBdCddLCBuYW1lPSdpZHhfdGlja2V0X29yZGVyX2NyZWF0ZWRhdCcpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';
--
-- Create index ticket_unitName on field(s) unitName of model ticket
--
CREATE INDEX IF NOT EXISTS "ticket_unitName" ON "Ticket" USING btree ("unitName");
--
-- Create index ticket_assignee_exec_org on field(s) assignee, executor, organization of model ticket
--
CREATE INDEX IF NOT EXISTS "ticket_assignee_exec_org" ON "Ticket" USING btree ("assignee", "executor", "organization") WHERE ("deletedAt" IS null);
--
-- Create index ticket_organization_status on field(s) organization, status of model ticket
--
CREATE INDEX IF NOT EXISTS "ticket_organization_status" ON "Ticket" USING btree ("organization", "status") WHERE ("deletedAt" IS null);
--
-- Create index idx_ticket_order_createdat on field(s) order, -createdAt of model ticket
--
CREATE INDEX IF NOT EXISTS "ticket_order_createdat" ON "Ticket" USING btree ("order", "createdAt" DESC);
--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';
--
-- Create index idx_ticket_order_createdat on field(s) order, -createdAt of model ticket
--
DROP INDEX IF EXISTS "idx_ticket_order_createdat";
--
-- Create index ticket_organization_status on field(s) organization, status of model ticket
--
DROP INDEX IF EXISTS "ticket_organization_status";
--
-- Create index ticket_assignee_exec_org on field(s) assignee, executor, organization of model ticket
--
DROP INDEX IF EXISTS "ticket_assignee_exec_org";
--
-- Create index ticket_unitName on field(s) unitName of model ticket
--
DROP INDEX IF EXISTS "ticket_unitName";
--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';
COMMIT;

    `)
}
