// auto generated by kmigrator
// KMIGRATOR:0495_auto_20251124_0740:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjUtMTEtMjQgMDc6NDAKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0OTRfYjJiYXBwX2FkZGl0aW9uYWxkb21haW5zX2IyYmFwcF9vaWRjY2xpZW50X2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbnVzZXJzZXR0aW5nJywKICAgICAgICAgICAgbmFtZT0ndXNlcicsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0ndXNlcicsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uQ0FTQ0FERSwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9udXNlcnNldHRpbmcnLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5DaGVja0NvbnN0cmFpbnQoY2hlY2s9bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIEZhbHNlKSwgbW9kZWxzLlEoKCd1c2VyX19pc251bGwnLCBUcnVlKSwgbW9kZWxzLlEoKCdtZXNzYWdlVHlwZV9faXNudWxsJywgVHJ1ZSksICgnbWVzc2FnZVRyYW5zcG9ydF9faXNudWxsJywgVHJ1ZSksIF9jb25uZWN0b3I9J09SJyksIF9uZWdhdGVkPVRydWUpLCBfY29ubmVjdG9yPSdPUicpLCBuYW1lPSdnbG9iYWxfc2V0dGluZ19yZXF1aXJlc19tZXNzYWdlVHlwZV9hbmRfbWVzc2FnZVRyYW5zcG9ydCcpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field user on notificationusersetting
--
SET CONSTRAINTS "NotificationUserSetting_user_fd06883d_fk_User_id" IMMEDIATE; ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id";
ALTER TABLE "NotificationUserSetting" ALTER COLUMN "user" DROP NOT NULL;
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id" FOREIGN KEY ("user") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Create constraint global_setting_requires_messageType_and_messageTransport on model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "global_setting_requires_messageType_and_messageTransport" CHECK (("deletedAt" IS NOT NULL OR NOT ("user" IS NULL AND ("messageType" IS NULL OR "messageTransport" IS NULL))));
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint global_setting_requires_messageType_and_messageTransport on model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "global_setting_requires_messageType_and_messageTransport";
--
-- Alter field user on notificationusersetting
--
SET CONSTRAINTS "NotificationUserSetting_user_fd06883d_fk_User_id" IMMEDIATE; ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id";
ALTER TABLE "NotificationUserSetting" ALTER COLUMN "user" SET NOT NULL;
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id" FOREIGN KEY ("user") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
COMMIT;

    `)
}
