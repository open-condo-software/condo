// auto generated by kmigrator
// KMIGRATOR:0039_auto_20210810_1218:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjEtMDgtMTAgMTI6MTgKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwMzhfYXV0b18yMDIxMDgwOV8xMjIyJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlJywKICAgICAgICAgICAgbmFtZT0naWQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlJywKICAgICAgICAgICAgbmFtZT0nbmV3SWQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2hpc3RvcnlfaWQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
        CREATE EXTENSION if not exists "uuid-ossp";
    COMMIT;

    --
    -- Alter field id on organizationemployee
    --
    ALTER TABLE "OrganizationEmployee" ADD COLUMN new_id UUID NULL;
    COMMIT;
    UPDATE "OrganizationEmployee" SET new_id = uuid_generate_v4();
    ALTER TABLE "OrganizationEmployee" DROP COLUMN id;
    ALTER TABLE "OrganizationEmployee" RENAME COLUMN new_id TO id;
    ALTER TABLE "OrganizationEmployee" ALTER COLUMN id SET NOT NULL;
    DROP SEQUENCE IF EXISTS "OrganizationEmployee_id_seq" CASCADE;
    COMMIT;

    --
    -- Alter field newId on organizationemployee
    --
    ALTER TABLE "OrganizationEmployee" ADD COLUMN "new_newId" UUID NULL;
    UPDATE "OrganizationEmployee" SET "new_newId" = uuid_generate_v4();
    ALTER TABLE "OrganizationEmployee" DROP COLUMN "newId";
    ALTER TABLE "OrganizationEmployee" RENAME COLUMN "new_newId" TO "newId";
    ALTER TABLE "OrganizationEmployee" ALTER COLUMN "newId" SET NOT NULL;
    COMMIT;

    --
    -- Alter field history_id on organizationemployeehistoryrecord
    --
    ALTER TABLE "OrganizationEmployeeHistoryRecord" ADD COLUMN "new_history_id" UUID NULL;
    COMMIT;
    UPDATE "OrganizationEmployeeHistoryRecord" SET "new_history_id" = uuid_generate_v4();
    ALTER TABLE "OrganizationEmployeeHistoryRecord" DROP COLUMN "history_id";
    ALTER TABLE "OrganizationEmployeeHistoryRecord" RENAME COLUMN "new_history_id" TO "history_id";
    ALTER TABLE "OrganizationEmployeeHistoryRecord" ALTER COLUMN "history_id" SET NOT NULL;
    COMMIT;

    `)
}

exports.down = async (knex) => {
    return
}
