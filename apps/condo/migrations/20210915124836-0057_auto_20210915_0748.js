// auto generated by kmigrator
// KMIGRATOR:0057_auto_20210915_0748:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjEtMDktMTUgMDc6NDgKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwNTZfYXV0b18yMDIxMDkxM18xNDU0JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb24nLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRJZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbicsCiAgICAgICAgICAgIG5hbWU9J2ltcG9ydFJlbW90ZVN5c3RlbScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRJZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRSZW1vdGVTeXN0ZW0nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd1c2VyJywKICAgICAgICAgICAgbmFtZT0naW1wb3J0UmVtb3RlU3lzdGVtJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRSZW1vdGVTeXN0ZW0nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXInLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRJZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChmaWVsZHM9KCdpbXBvcnRJZCcsICdpbXBvcnRSZW1vdGVTeXN0ZW0nKSwgbmFtZT0ndW5pcXVlX29yZ2FuaXphdGlvbl9pbXBvcnRpZF9hbmRfaW1wb3J0cmVtb3Rlc3lzdGVtJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXInLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGZpZWxkcz0oJ2ltcG9ydElkJywgJ2ltcG9ydFJlbW90ZVN5c3RlbScpLCBuYW1lPSd1bmlxdWVfdXNlcl9pbXBvcnRpZF9hbmRfaW1wb3J0cmVtb3Rlc3lzdGVtJyksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field importId to organization
--
ALTER TABLE "Organization" ADD COLUMN "importId" text NULL;
--
-- Add field importRemoteSystem to organization
--
ALTER TABLE "Organization" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Add field importId to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" ADD COLUMN "importId" text NULL;
--
-- Add field importRemoteSystem to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Add field importRemoteSystem to user
--
ALTER TABLE "User" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Add field importRemoteSystem to userhistoryrecord
--
ALTER TABLE "UserHistoryRecord" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Alter field importId on user
--
ALTER TABLE "User" DROP CONSTRAINT "User_importId_key";
--
-- Create constraint unique_organization_importid_and_importremotesystem on model organization
--
ALTER TABLE "Organization" ADD CONSTRAINT "unique_organization_importid_and_importremotesystem" UNIQUE ("importId", "importRemoteSystem");
--
-- Create constraint unique_user_importid_and_importremotesystem on model user
--
ALTER TABLE "User" ADD CONSTRAINT "unique_user_importid_and_importremotesystem" UNIQUE ("importId", "importRemoteSystem");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint unique_user_importid_and_importremotesystem on model user
--
ALTER TABLE "User" DROP CONSTRAINT "unique_user_importid_and_importremotesystem";
--
-- Create constraint unique_organization_importid_and_importremotesystem on model organization
--
ALTER TABLE "Organization" DROP CONSTRAINT "unique_organization_importid_and_importremotesystem";
--
-- Alter field importId on user
--
ALTER TABLE "User" ADD CONSTRAINT "User_importId_1ba44fc8_uniq" UNIQUE ("importId");
--
-- Add field importRemoteSystem to userhistoryrecord
--
ALTER TABLE "UserHistoryRecord" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importRemoteSystem to user
--
ALTER TABLE "User" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importRemoteSystem to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importId to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" DROP COLUMN "importId" CASCADE;
--
-- Add field importRemoteSystem to organization
--
ALTER TABLE "Organization" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importId to organization
--
ALTER TABLE "Organization" DROP COLUMN "importId" CASCADE;
COMMIT;

    `)
}
