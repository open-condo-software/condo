// auto generated by kmigrator
// KMIGRATOR:0445_auto_20241219_1249:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjQtMTItMTkgMTI6NDkKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0NDRfYXV0b18yMDI0MTIxOV8xMjI4JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUNvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FwcG1lc3NhZ2VzZXR0aW5nJywKICAgICAgICAgICAgbmFtZT0nYjJjX2FwcF9tZXNzYWdlX3NldHRpbmdfdW5pcXVlX2FwcF9hbmRfdHlwZScsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbmFtZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhcHBtZXNzYWdlc2V0dGluZ2hpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBvbGRfbmFtZT0nYXBwJywKICAgICAgICAgICAgbmV3X25hbWU9J2IyYkFwcCcsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhcHBtZXNzYWdlc2V0dGluZycsCiAgICAgICAgICAgIG5hbWU9J2FwcCcsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhcHBtZXNzYWdlc2V0dGluZycsCiAgICAgICAgICAgIG5hbWU9J2IyYkFwcCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nYjJiQXBwJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuYjJiYXBwJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhcHBtZXNzYWdlc2V0dGluZycsCiAgICAgICAgICAgIG5hbWU9J2IyY0FwcCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nYjJjQXBwJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuYjJjYXBwJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhcHBtZXNzYWdlc2V0dGluZ2hpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdiMmNBcHAnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FwcG1lc3NhZ2VzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgnYjJjQXBwJywgJ2IyYkFwcCcsICd0eXBlJyksIG5hbWU9J2FwcF9tZXNzYWdlX3NldHRpbmdfdW5pcXVlX2FwcF9hbmRfdHlwZScpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove constraint b2c_app_message_setting_unique_app_and_type from model appmessagesetting
--
DROP INDEX IF EXISTS "b2c_app_message_setting_unique_app_and_type";
--
-- Rename field app on appmessagesettinghistoryrecord to b2bApp
--
ALTER TABLE "AppMessageSettingHistoryRecord" RENAME COLUMN "app" TO "b2bApp";
--
-- Remove field app from appmessagesetting
--
SET CONSTRAINTS "B2CAppMessageSetting_app_6d573f2e_fk_B2CApp_id" IMMEDIATE; ALTER TABLE "AppMessageSetting" DROP CONSTRAINT "B2CAppMessageSetting_app_6d573f2e_fk_B2CApp_id";
ALTER TABLE "AppMessageSetting" DROP COLUMN "app" CASCADE;
--
-- Add field b2bApp to appmessagesetting
--
ALTER TABLE "AppMessageSetting" ADD COLUMN "b2bApp" uuid NULL CONSTRAINT "AppMessageSetting_b2bApp_715730ec_fk_B2BApp_id" REFERENCES "B2BApp"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "AppMessageSetting_b2bApp_715730ec_fk_B2BApp_id" IMMEDIATE;
--
-- Add field b2cApp to appmessagesetting
--
ALTER TABLE "AppMessageSetting" ADD COLUMN "b2cApp" uuid NULL CONSTRAINT "AppMessageSetting_b2cApp_4bb405c2_fk_B2CApp_id" REFERENCES "B2CApp"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "AppMessageSetting_b2cApp_4bb405c2_fk_B2CApp_id" IMMEDIATE;
--
-- Add field b2cApp to appmessagesettinghistoryrecord
--
ALTER TABLE "AppMessageSettingHistoryRecord" ADD COLUMN "b2cApp" uuid NULL;
--
-- Create constraint app_message_setting_unique_app_and_type on model appmessagesetting
--
CREATE UNIQUE INDEX "app_message_setting_unique_app_and_type" ON "AppMessageSetting" ("b2cApp", "b2bApp", "type") WHERE "deletedAt" IS NULL;
CREATE INDEX "AppMessageSetting_b2bApp_715730ec" ON "AppMessageSetting" ("b2bApp");
CREATE INDEX "AppMessageSetting_b2cApp_4bb405c2" ON "AppMessageSetting" ("b2cApp");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint app_message_setting_unique_app_and_type on model appmessagesetting
--
DROP INDEX IF EXISTS "app_message_setting_unique_app_and_type";
--
-- Add field b2cApp to appmessagesettinghistoryrecord
--
ALTER TABLE "AppMessageSettingHistoryRecord" DROP COLUMN "b2cApp" CASCADE;
--
-- Add field b2cApp to appmessagesetting
--
ALTER TABLE "AppMessageSetting" DROP COLUMN "b2cApp" CASCADE;
--
-- Add field b2bApp to appmessagesetting
--
ALTER TABLE "AppMessageSetting" DROP COLUMN "b2bApp" CASCADE;
--
-- Remove field app from appmessagesetting
--
ALTER TABLE "AppMessageSetting" ADD COLUMN "app" uuid NULL CONSTRAINT "AppMessageSetting_app_ca0dd502_fk_B2CApp_id" REFERENCES "B2CApp"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "AppMessageSetting_app_ca0dd502_fk_B2CApp_id" IMMEDIATE;
--
-- Rename field app on appmessagesettinghistoryrecord to b2bApp
--
ALTER TABLE "AppMessageSettingHistoryRecord" RENAME COLUMN "b2bApp" TO "app";
--
-- Remove constraint b2c_app_message_setting_unique_app_and_type from model appmessagesetting
--
CREATE UNIQUE INDEX "b2c_app_message_setting_unique_app_and_type" ON "AppMessageSetting" ("app", "type") WHERE "deletedAt" IS NULL;
CREATE INDEX "AppMessageSetting_app_ca0dd502" ON "AppMessageSetting" ("app");
COMMIT;

    `)
}
