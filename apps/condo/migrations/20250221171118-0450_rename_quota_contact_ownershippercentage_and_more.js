// auto generated by kmigrator
// KMIGRATOR:0450_rename_quota_contact_ownershippercentage_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMS40IG9uIDIwMjUtMDItMjEgMTI6MTEKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwNDQ5X2F1dG9fMjAyNTAyMjBfMTAxMycpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5SZW5hbWVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nY29udGFjdCcsCiAgICAgICAgICAgIG9sZF9uYW1lPSdxdW90YScsCiAgICAgICAgICAgIG5ld19uYW1lPSdvd25lcnNoaXBQZXJjZW50YWdlJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVuYW1lRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2NvbnRhY3RoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgb2xkX25hbWU9J3F1b3RhJywKICAgICAgICAgICAgbmV3X25hbWU9J293bmVyc2hpcFBlcmNlbnRhZ2UnLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;

--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';

-- 
-- [CUSTOM] Add new column ownershipPercentage to Contact table
-- 
ALTER TABLE "Contact" ADD COLUMN "ownershipPercentage" numeric(18, 8) NULL;
    
--
-- [CUSTOM] Copy data from quota to ownershipPercentage in Contact table
-- 
UPDATE "Contact" SET "ownershipPercentage" = "quota";
    
--
-- [CUSTOM] Add new column ownershipPercentage to ContactHistoryRecord table
-- 
ALTER TABLE "ContactHistoryRecord" ADD COLUMN "ownershipPercentage" numeric(18, 8) NULL;

--
-- [CUSTOM] Copy data from quota to ownershipPercentage in ContactHistoryRecord table
--
UPDATE "ContactHistoryRecord" SET "ownershipPercentage" = "quota";

--
-- [CUSTOM] Set statement timeout back to 10s
--
SET statement_timeout = '10s';

COMMIT;
    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Rename field quota on contacthistoryrecord to ownershipPercentage
--
ALTER TABLE "ContactHistoryRecord" DROP COLUMN "ownershipPercentage";
--
-- [CUSTOM] Rename field quota on contact to ownershipPercentage
--
ALTER TABLE "Contact" DROP COLUMN "ownershipPercentage";
COMMIT;

    `)
}
