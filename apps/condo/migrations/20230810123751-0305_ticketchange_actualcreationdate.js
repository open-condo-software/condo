// auto generated by kmigrator
// KMIGRATOR:0305_ticketchange_actualcreationdate:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMSBvbiAyMDIzLTA4LTEwIDA3OjM3Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMzA0X2IyYmFwcGFjY2Vzc3JpZ2h0c2V0X2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRjaGFuZ2UnLAogICAgICAgICAgICBuYW1lPSdhY3R1YWxDcmVhdGlvbkRhdGUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';

--
-- Add field actualCreationDate to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "actualCreationDate" timestamp with time zone NULL;


--
-- [CUSTOM] Set actualCreationDate = TicketChange.createdAt where actualCreationDate is null
--
UPDATE "TicketChange"
SET "actualCreationDate" = "createdAt"
WHERE "actualCreationDate" IS NULL;

--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field actualCreationDate to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "actualCreationDate" CASCADE;
COMMIT;

    `)
}
