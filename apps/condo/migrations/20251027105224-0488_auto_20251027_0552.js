// auto generated by kmigrator
// KMIGRATOR:0488_auto_20251027_0552:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjUtMTAtMjcgMDU6NTIKCmltcG9ydCBkamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5pbmRleGVzCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwNDg3X2ZpbGVyZWNvcmRoaXN0b3J5cmVjb3JkX2ZpbGVyZWNvcmQnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlSW5kZXgoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J21lc3NhZ2UnLAogICAgICAgICAgICBuYW1lPSdtZXNzYWdlX3VzZXJfdHlwZV9vcmcnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRJbmRleCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbWVzc2FnZScsCiAgICAgICAgICAgIGluZGV4PWRqYW5nby5jb250cmliLnBvc3RncmVzLmluZGV4ZXMuQlRyZWVJbmRleChmaWVsZHM9Wyd1c2VyJywgJ3R5cGUnLCAnb3JnYW5pemF0aW9uJywgJy1jcmVhdGVkQXQnXSwgbmFtZT0nbWVzc2FnZV91c2VyX3R5cGVfb3JnX2NyZWF0ZWRhdCcpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
SET statement_timeout = '1500s';
--
-- Remove index message_user_type_org from message
--
DROP INDEX IF EXISTS "message_user_type_org";
--
-- Create index message_user_type_org_createdat on field(s) user, type, organization, -createdAt of model message
--
CREATE INDEX IF NOT EXISTS "message_user_type_org_createdat" 
ON "Message" USING btree ("user", "type", "organization", "createdAt" DESC) 
WHERE "deletedAt" IS NULL;

SET statement_timeout = '10s';
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
SET statement_timeout = '1500s';
--
-- Create index message_user_type_org_createdat on field(s) user, type, organization, -createdAt of model message
--
DROP INDEX IF EXISTS "message_user_type_org_createdat";
--
-- Remove index message_user_type_org from message
--
CREATE INDEX IF NOT EXISTS "message_user_type_org" 
ON "Message" USING btree ("user", "type", "organization");

SET statement_timeout = '10s';
COMMIT;

    `)
}
