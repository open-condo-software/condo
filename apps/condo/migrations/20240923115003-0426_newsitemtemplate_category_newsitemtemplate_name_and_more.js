// auto generated by kmigrator
// KMIGRATOR:0426_newsitemtemplate_category_newsitemtemplate_name_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMC43IG9uIDIwMjQtMDktMjMgMDY6NTAKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0MjVfbWVzc2FnZV9tZXNzYWdlX3VzZXJfc3RhdHVzX3NlbnRhdCcpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbmV3c2l0ZW10ZW1wbGF0ZScsCiAgICAgICAgICAgIG5hbWU9J2NhdGVnb3J5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkNoYXJGaWVsZChibGFuaz1UcnVlLCBjaG9pY2VzPVsoJ3dhdGVyJywgJ3dhdGVyJyksICgnaGVhdGluZycsICdoZWF0aW5nJyksICgnZWxlY3RyaWNpdHknLCAnZWxlY3RyaWNpdHknKSwgKCdhbGxVdGlsaXRpZXMnLCAnYWxsVXRpbGl0aWVzJyksICgnZWxlY3RyaWNpdHlBbmRXYXRlcicsICdlbGVjdHJpY2l0eUFuZFdhdGVyJyksICgnbGlnaHQnLCAnbGlnaHQnKSwgKCdlbGV2YXRvcnMnLCAnZWxldmF0b3JzJyksICgndGVsZXBob25lJywgJ3RlbGVwaG9uZScpLCAoJ21ldGVycycsICdtZXRlcnMnKSwgKCdnYXMnLCAnZ2FzJyksICgnaW50ZXJjb20nLCAnaW50ZXJjb20nKSwgKCdjbGVhbmluZycsICdjbGVhbmluZycpLCAoJ3Nub3cnLCAnc25vdycpLCAoJ290aGVyJywgJ290aGVyJyldLCBtYXhfbGVuZ3RoPTUwLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbmV3c2l0ZW10ZW1wbGF0ZScsCiAgICAgICAgICAgIG5hbWU9J25hbWUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGRlZmF1bHQ9J1RlbXAnKSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25ld3NpdGVtdGVtcGxhdGVoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2F0ZWdvcnknLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSduZXdzaXRlbXRlbXBsYXRlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J25hbWUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field category to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" ADD COLUMN "category" varchar(50) NULL;
--
-- Add field name to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" ADD COLUMN "name" text DEFAULT 'Temp' NOT NULL;
ALTER TABLE "NewsItemTemplate" ALTER COLUMN "name" DROP DEFAULT;
--
-- [CUSTOM] The value of the "name" field for old records must be dynamic. Therefore, the required "name" field in old records is set to "Temp".
-- [CUSTOM] Then the static value of "Temp" is overwritten and the dynamic value name = title is set.
--
UPDATE "NewsItemTemplate" SET name = title WHERE name = 'Temp';
--
-- Add field category to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" ADD COLUMN "category" text NULL;
--
-- Add field name to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" ADD COLUMN "name" text NULL;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field name to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" DROP COLUMN "name" CASCADE;
--
-- Add field category to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" DROP COLUMN "category" CASCADE;
--
-- Add field name to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" DROP COLUMN "name" CASCADE;
--
-- Add field category to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" DROP COLUMN "category" CASCADE;
COMMIT;

    `)
}
