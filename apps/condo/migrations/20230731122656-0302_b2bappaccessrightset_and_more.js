// auto generated by kmigrator
// KMIGRATOR:0302_b2bappaccessrightset_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC41IG9uIDIwMjMtMDctMzEgMDc6MjYKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzMDFfYjJiYXBwcGVybWlzc2lvbmhpc3RvcnlyZWNvcmRfYW5kX21vcmUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0JywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2NhblJlYWRPcmdhbml6YXRpb25zJywgbW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ2Nhbk1hbmFnZU9yZ2FuaXphdGlvbnMnLCBtb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnY2FuUmVhZFByb3BlcnRpZXMnLCBtb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnY2FuTWFuYWdlUHJvcGVydGllcycsIG1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCdjYW5SZWFkQ29udGFjdHMnLCBtb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnY2FuTWFuYWdlQ29udGFjdHMnLCBtb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQjJCQXBwQWNjZXNzUmlnaHRTZXQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgnYXBwJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfZGF0ZScsIG1vZGVscy5EYXRlVGltZUZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2FjdGlvbicsIG1vZGVscy5DaGFyRmllbGQoY2hvaWNlcz1bKCdjJywgJ2MnKSwgKCd1JywgJ3UnKSwgKCdkJywgJ2QnKV0sIG1heF9sZW5ndGg9NTApKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9pZCcsIG1vZGVscy5VVUlERmllbGQoZGJfaW5kZXg9VHJ1ZSkpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdCMkJBcHBBY2Nlc3NSaWdodFNldEhpc3RvcnlSZWNvcmQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nYWNjZXNzUmlnaHRTZXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0JywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgnYXBwJywpLCBuYW1lPSdiMmJfYXBwX2FjY2Vzc19yaWdodF91bmlxdWVfYXBwJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyY2FwcGFjY2Vzc3JpZ2h0JywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgnYXBwJywpLCBuYW1lPSdiMtGBX2FwcF9hY2Nlc3NfcmlnaHRfdW5pcXVlX2FwcCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXQnLAogICAgICAgICAgICBuYW1lPSdhcHAnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J2FwcCcsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5iMmJhcHAnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0JywKICAgICAgICAgICAgbmFtZT0nY3JlYXRlZEJ5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjcmVhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXQnLAogICAgICAgICAgICBuYW1lPSd1cGRhdGVkQnknLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VwZGF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBhY2Nlc3NyaWdodCcsCiAgICAgICAgICAgIG5hbWU9J2FjY2Vzc1JpZ2h0U2V0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdhY2Nlc3NSaWdodFNldCcsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5iMmJhcHBhY2Nlc3NyaWdodHNldCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBhY2Nlc3NyaWdodHNldCcsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ2FwcCcsKSwgbmFtZT0nYjJiX2FwcF9hY2Nlc3NfcmlnaHRfc2V0X3VuaXF1ZV9hcHAnKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model b2bappaccessrightset
--
CREATE TABLE "B2BAppAccessRightSet" ("id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "canReadOrganizations" boolean NOT NULL, "canManageOrganizations" boolean NOT NULL, "canReadProperties" boolean NOT NULL, "canManageProperties" boolean NOT NULL, "canReadContacts" boolean NOT NULL, "canManageContacts" boolean NOT NULL);
--
-- Create model b2bappaccessrightsethistoryrecord
--
CREATE TABLE "B2BAppAccessRightSetHistoryRecord" ("app" uuid NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field accessRightSet to b2bappaccessrighthistoryrecord
--
ALTER TABLE "B2BAppAccessRightHistoryRecord" ADD COLUMN "accessRightSet" uuid NULL;
--
-- Create constraint b2b_app_access_right_unique_app on model b2bappaccessright
--
CREATE UNIQUE INDEX "b2b_app_access_right_unique_app" ON "B2BAppAccessRight" ("app") WHERE "deletedAt" IS NULL;
--
-- Create constraint b2с_app_access_right_unique_app on model b2cappaccessright
--
CREATE UNIQUE INDEX "b2с_app_access_right_unique_app" ON "B2CAppAccessRight" ("app") WHERE "deletedAt" IS NULL;
--
-- Add field app to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "app" uuid NOT NULL CONSTRAINT "B2BAppAccessRightSet_app_672f83d8_fk_B2BApp_id" REFERENCES "B2BApp"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAppAccessRightSet_app_672f83d8_fk_B2BApp_id" IMMEDIATE;
--
-- Add field createdBy to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "createdBy" uuid NULL CONSTRAINT "B2BAppAccessRightSet_createdBy_0f9eb897_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAppAccessRightSet_createdBy_0f9eb897_fk_User_id" IMMEDIATE;
--
-- Add field updatedBy to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "updatedBy" uuid NULL CONSTRAINT "B2BAppAccessRightSet_updatedBy_01ad0760_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAppAccessRightSet_updatedBy_01ad0760_fk_User_id" IMMEDIATE;
--
-- Add field accessRightSet to b2bappaccessright
--
ALTER TABLE "B2BAppAccessRight" ADD COLUMN "accessRightSet" uuid NULL CONSTRAINT "B2BAppAccessRight_accessRightSet_d66bc7b6_fk_B2BAppAcc" REFERENCES "B2BAppAccessRightSet"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAppAccessRight_accessRightSet_d66bc7b6_fk_B2BAppAcc" IMMEDIATE;
--
-- Create constraint b2b_app_access_right_set_unique_app on model b2bappaccessrightset
--
CREATE UNIQUE INDEX "b2b_app_access_right_set_unique_app" ON "B2BAppAccessRightSet" ("app") WHERE "deletedAt" IS NULL;
CREATE INDEX "B2BAppAccessRightSet_createdAt_24ed3c65" ON "B2BAppAccessRightSet" ("createdAt");
CREATE INDEX "B2BAppAccessRightSet_updatedAt_582f7052" ON "B2BAppAccessRightSet" ("updatedAt");
CREATE INDEX "B2BAppAccessRightSet_deletedAt_91406a83" ON "B2BAppAccessRightSet" ("deletedAt");
CREATE INDEX "B2BAppAccessRightSetHistoryRecord_history_id_3b79446c" ON "B2BAppAccessRightSetHistoryRecord" ("history_id");
CREATE INDEX "B2BAppAccessRightSet_app_672f83d8" ON "B2BAppAccessRightSet" ("app");
CREATE INDEX "B2BAppAccessRightSet_createdBy_0f9eb897" ON "B2BAppAccessRightSet" ("createdBy");
CREATE INDEX "B2BAppAccessRightSet_updatedBy_01ad0760" ON "B2BAppAccessRightSet" ("updatedBy");
CREATE INDEX "B2BAppAccessRight_accessRightSet_d66bc7b6" ON "B2BAppAccessRight" ("accessRightSet");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint b2b_app_access_right_set_unique_app on model b2bappaccessrightset
--
DROP INDEX IF EXISTS "b2b_app_access_right_set_unique_app";
--
-- Add field accessRightSet to b2bappaccessright
--
ALTER TABLE "B2BAppAccessRight" DROP COLUMN "accessRightSet" CASCADE;
--
-- Add field updatedBy to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "updatedBy" CASCADE;
--
-- Add field createdBy to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "createdBy" CASCADE;
--
-- Add field app to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "app" CASCADE;
--
-- Create constraint b2с_app_access_right_unique_app on model b2cappaccessright
--
DROP INDEX IF EXISTS "b2с_app_access_right_unique_app";
--
-- Create constraint b2b_app_access_right_unique_app on model b2bappaccessright
--
DROP INDEX IF EXISTS "b2b_app_access_right_unique_app";
--
-- Add field accessRightSet to b2bappaccessrighthistoryrecord
--
ALTER TABLE "B2BAppAccessRightHistoryRecord" DROP COLUMN "accessRightSet" CASCADE;
--
-- Create model b2bappaccessrightsethistoryrecord
--
DROP TABLE "B2BAppAccessRightSetHistoryRecord" CASCADE;
--
-- Create model b2bappaccessrightset
--
DROP TABLE "B2BAppAccessRightSet" CASCADE;
COMMIT;

    `)
}
