// auto generated by kmigrator
// KMIGRATOR:0491_auto_20251106_0646:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjUtMTEtMDYgMDY6NDYKCmltcG9ydCBkamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5pbmRleGVzCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwNDkwX2IyYmFwcGFjY2Vzc3JpZ2h0c2V0X2Nhbm1hbmFnZWJpbGxpbmdyZWNpcGllbnRzX2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUluZGV4KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdtZXNzYWdlJywKICAgICAgICAgICAgbmFtZT0nbWVzc2FnZV91c2VyX3R5cGVfb3JnX2NyZWF0ZWRhdCcsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEluZGV4KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdtZXNzYWdlJywKICAgICAgICAgICAgaW5kZXg9ZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuaW5kZXhlcy5CVHJlZUluZGV4KGZpZWxkcz1bJ3VzZXInLCAnb3JnYW5pemF0aW9uJywgJy1jcmVhdGVkQXQnXSwgbmFtZT0nbWVzc2FnZV91c2VyX29yZ19jcmVhdGVkYXQnKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
SET statement_timeout = '1500s';

--
-- Remove index message_user_type_org_createdat from message
--
DROP INDEX IF EXISTS "message_user_type_org_createdat";
--
-- Create index message_user_org_createdat on field(s) user, organization, -createdAt of model message
--
CREATE INDEX IF NOT EXISTS "message_user_org_createdat" 
ON "Message" USING btree ("user", "organization", "createdAt" DESC)
WHERE "deletedAt" IS NULL;

SET statement_timeout = '10s';
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
SET statement_timeout = '1500s';

--
-- Create index message_user_org_createdat on field(s) user, organization, -createdAt of model message
--
DROP INDEX IF EXISTS "message_user_org_createdat";
--
-- Remove index message_user_type_org_createdat from message
--
CREATE INDEX IF NOT EXISTS "message_user_type_org_createdat" 
ON "Message" USING btree ("user", "type", "organization", "createdAt" DESC)
WHERE "deletedAt" IS NULL;

SET statement_timeout = '10s';
COMMIT;

    `)
}
