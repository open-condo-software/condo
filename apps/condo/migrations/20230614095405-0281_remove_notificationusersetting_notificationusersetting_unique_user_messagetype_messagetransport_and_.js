// auto generated by kmigrator
// KMIGRATOR:0281_remove_notificationusersetting_notificationusersetting_unique_user_messagetype_messagetransport_and_:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC4xIG9uIDIwMjMtMDYtMTQgMDQ6NTQKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAyODBfYWx0ZXJfdXNlcmV4dGVybmFsaWRlbnRpdHlfaWRlbnRpdHl0eXBlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUNvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbnVzZXJzZXR0aW5nJywKICAgICAgICAgICAgbmFtZT0nTm90aWZpY2F0aW9uVXNlclNldHRpbmdfdW5pcXVlX3VzZXJfbWVzc2FnZVR5cGVfbWVzc2FnZVRyYW5zcG9ydCcsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbnVzZXJzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgndXNlcicsICdtZXNzYWdlVHlwZScsICdtZXNzYWdlVHJhbnNwb3J0JyksIG5hbWU9J05vdGlmaWNhdGlvblVzZXJTZXR0aW5nX3VuaXF1ZV91c2VyX21lc3NhZ2VUeXBlX21lc3NhZ2VUcmFuc3BvcnQnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9udXNlcnNldHRpbmcnLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSksICgnbWVzc2FnZVRyYW5zcG9ydF9faXNudWxsJywgVHJ1ZSkpLCBmaWVsZHM9KCd1c2VyJywgJ21lc3NhZ2VUeXBlJyksIG5hbWU9J05vdGlmaWNhdGlvblVzZXJTZXR0aW5nX3VuaXF1ZV91c2VyX21lc3NhZ2VUeXBlJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbnVzZXJzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpLCAoJ21lc3NhZ2VUeXBlX19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3VzZXInLCAnbWVzc2FnZVRyYW5zcG9ydCcpLCBuYW1lPSdOb3RpZmljYXRpb25Vc2VyU2V0dGluZ191bmlxdWVfdXNlcl9tZXNzYWdlVHJhbnNwb3J0JyksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove constraint NotificationUserSetting_unique_user_messageType_messageTransport from model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "NotificationUserSetting_unique_user_messageType_messageTransport";
--
-- Create constraint NotificationUserSetting_unique_user_messageType_messageTransport on model notificationusersetting
--
CREATE UNIQUE INDEX "NotificationUserSetting_unique_user_messageType_messageTransport" ON "NotificationUserSetting" ("user", "messageType", "messageTransport") WHERE "deletedAt" IS NULL;
--
-- Create constraint NotificationUserSetting_unique_user_messageType on model notificationusersetting
--
CREATE UNIQUE INDEX "NotificationUserSetting_unique_user_messageType" ON "NotificationUserSetting" ("user", "messageType") WHERE ("deletedAt" IS NULL AND "messageTransport" IS NULL);
--
-- Create constraint NotificationUserSetting_unique_user_messageTransport on model notificationusersetting
--
CREATE UNIQUE INDEX "NotificationUserSetting_unique_user_messageTransport" ON "NotificationUserSetting" ("user", "messageTransport") WHERE ("deletedAt" IS NULL AND "messageType" IS NULL);
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint NotificationUserSetting_unique_user_messageTransport on model notificationusersetting
--
DROP INDEX IF EXISTS "NotificationUserSetting_unique_user_messageTransport";
--
-- Create constraint NotificationUserSetting_unique_user_messageType on model notificationusersetting
--
DROP INDEX IF EXISTS "NotificationUserSetting_unique_user_messageType";
--
-- Create constraint NotificationUserSetting_unique_user_messageType_messageTransport on model notificationusersetting
--
DROP INDEX IF EXISTS "NotificationUserSetting_unique_user_messageType_messageTransport";
--
-- Remove constraint NotificationUserSetting_unique_user_messageType_messageTransport from model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "NotificationUserSetting_unique_user_messageType_messageTransport" UNIQUE ("user", "messageType", "messageTransport");
COMMIT;

    `)
}
