// auto generated by kmigrator
// KMIGRATOR:0264_bankintegrationorganizationcontext_enabled_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMS43IG9uIDIwMjMtMDQtMjcgMTA6NDEKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAyNjNfaW5jaWRlbnRleHBvcnR0YXNraGlzdG9yeXJlY29yZF9pbmNpZGVudGV4cG9ydHRhc2snKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2JhbmtpbnRlZ3JhdGlvbm9yZ2FuaXphdGlvbmNvbnRleHQnLAogICAgICAgICAgICBuYW1lPSdlbmFibGVkJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PVRydWUpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmFua2ludGVncmF0aW9ub3JnYW5pemF0aW9uY29udGV4dGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdlbmFibGVkJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiYW5rc3luY3Rhc2snLAogICAgICAgICAgICBuYW1lPSdvcHRpb25zJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkpTT05GaWVsZChkZWZhdWx0PXt9KSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field enabled to bankintegrationorganizationcontext
--
ALTER TABLE "BankIntegrationOrganizationContext" ADD COLUMN "enabled" boolean DEFAULT true NOT NULL;
ALTER TABLE "BankIntegrationOrganizationContext" ALTER COLUMN "enabled" DROP DEFAULT;
--
-- Add field enabled to bankintegrationorganizationcontexthistoryrecord
--
ALTER TABLE "BankIntegrationOrganizationContextHistoryRecord" ADD COLUMN "enabled" boolean NULL;
--
-- Alter field options on banksynctask
--
ALTER TABLE "BankSyncTask" ALTER COLUMN "options" SET DEFAULT '{}';
UPDATE "BankSyncTask" SET "options" = '{}' WHERE "options" IS NULL; SET CONSTRAINTS ALL IMMEDIATE;
ALTER TABLE "BankSyncTask" ALTER COLUMN "options" SET NOT NULL;
ALTER TABLE "BankSyncTask" ALTER COLUMN "options" DROP DEFAULT;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field options on banksynctask
--
ALTER TABLE "BankSyncTask" ALTER COLUMN "options" DROP NOT NULL;
--
-- Add field enabled to bankintegrationorganizationcontexthistoryrecord
--
ALTER TABLE "BankIntegrationOrganizationContextHistoryRecord" DROP COLUMN "enabled" CASCADE;
--
-- Add field enabled to bankintegrationorganizationcontext
--
ALTER TABLE "BankIntegrationOrganizationContext" DROP COLUMN "enabled" CASCADE;
COMMIT;

    `)
}
