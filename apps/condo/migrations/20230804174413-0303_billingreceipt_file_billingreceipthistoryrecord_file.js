// auto generated by kmigrator
// KMIGRATOR:0303_billingreceipt_file_billingreceipthistoryrecord_file:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC40IG9uIDIwMjMtMDgtMDQgMTI6NDQKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzMDJfc2VydmljZWNvbnN1bWVyX2lzZGlzY292ZXJlZF9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ3JlY2VpcHQnLAogICAgICAgICAgICBuYW1lPSdmaWxlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdmaWxlJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmJpbGxpbmdyZWNlaXB0ZmlsZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ3JlY2VpcHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nZmlsZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s'; 

--
-- Add field file to billingreceipt
--
ALTER TABLE "BillingReceipt" ADD COLUMN "file" uuid NULL CONSTRAINT "BillingReceipt_file_24115686_fk_BillingReceiptFile_id" REFERENCES "BillingReceiptFile"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "BillingReceipt_file_24115686_fk_BillingReceiptFile_id" IMMEDIATE;
--
-- Add field file to billingreceipthistoryrecord
--
ALTER TABLE "BillingReceiptHistoryRecord" ADD COLUMN "file" uuid NULL;
CREATE INDEX "BillingReceipt_file_24115686" ON "BillingReceipt" ("file");
COMMIT;

SET statement_timeout = '10s';
    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field file to billingreceipthistoryrecord
--
ALTER TABLE "BillingReceiptHistoryRecord" DROP COLUMN "file" CASCADE;
--
-- Add field file to billingreceipt
--
ALTER TABLE "BillingReceipt" DROP COLUMN "file" CASCADE;
COMMIT;

    `)
}
