// auto generated by kmigrator
// KMIGRATOR:0120_auto_20220414_0752:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi43IG9uIDIwMjItMDQtMTQgMDc6NTIKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAxMTlfdGlja2V0Y29tbWVudF90eXBlX3RpY2tldGNvbW1lbnRoaXN0b3J5cmVjb3JkX3R5cGUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J21lc3NhZ2UnLAogICAgICAgICAgICBuYW1lPSdyZWFkQXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbWVzc2FnZScsCiAgICAgICAgICAgIG5hbWU9J3NlbnRBdCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdtZXNzYWdlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J3JlYWRBdCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdtZXNzYWdlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J3NlbnRBdCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J21lc3NhZ2UnLAogICAgICAgICAgICBuYW1lPSdzdGF0dXMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQ2hhckZpZWxkKGNob2ljZXM9Wygnc2VuZGluZycsICdzZW5kaW5nJyksICgncmVzZW5kaW5nJywgJ3Jlc2VuZGluZycpLCAoJ3Byb2Nlc3NpbmcnLCAncHJvY2Vzc2luZycpLCAoJ2Vycm9yJywgJ2Vycm9yJyksICgnc2VudCcsICdzZW50JyksICgnZGVsaXZlcmVkJywgJ2RlbGl2ZXJlZCcpLCAoJ3JlYWQnLCAncmVhZCcpLCAoJ2NhbmNlbGVkJywgJ2NhbmNlbGVkJyldLCBtYXhfbGVuZ3RoPTUwKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Rename field deliveredAt on message to sentAt
--
ALTER TABLE "Message" RENAME COLUMN "deliveredAt" TO "sentAt";
--
-- Rename field deliveredAt on messagehistoryrecord to sentAt
--
ALTER TABLE "MessageHistoryRecord" RENAME COLUMN "deliveredAt" TO "sentAt";
--
-- Add field readAt to message
--
ALTER TABLE "Message" ADD COLUMN "readAt" timestamp with time zone NULL;
--
-- Add field deliveredAt to message
--
ALTER TABLE "Message" ADD COLUMN "deliveredAt" timestamp with time zone NULL;
--
-- Add field readAt to messagehistoryrecord
--
ALTER TABLE "MessageHistoryRecord" ADD COLUMN "readAt" timestamp with time zone NULL;
--
-- Add field deliveredAt to messagehistoryrecord
--
ALTER TABLE "MessageHistoryRecord" ADD COLUMN "deliveredAt" timestamp with time zone NULL;
--
-- Alter field status on message
--
CREATE INDEX IF NOT EXISTS "Message_sentAt_abc2e26c" ON "Message" ("sentAt");
CREATE INDEX IF NOT EXISTS "Message_deliveredAt_abc2e26c" ON "Message" ("deliveredAt");
CREATE INDEX IF NOT EXISTS "Message_readAt_abc2e26c" ON "Message" ("readAt");

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field status on message
--
DROP INDEX IF EXISTS "Message_sentAt_abc2e26c";
DROP INDEX IF EXISTS "Message_deliveredAt_abc2e26c";
DROP INDEX IF EXISTS "Message_readAt_abc2e26c";
--
-- Add field sentAt to messagehistoryrecord
--
ALTER TABLE "MessageHistoryRecord" DROP COLUMN "deliveredAt" CASCADE;
--
-- Add field readAt to messagehistoryrecord
--
ALTER TABLE "MessageHistoryRecord" DROP COLUMN "readAt" CASCADE;
--
-- Add field sentAt to message
--
ALTER TABLE "Message" DROP COLUMN "deliveredAt" CASCADE;
--
-- Add field readAt to message
--
ALTER TABLE "Message" DROP COLUMN "readAt" CASCADE;

--
-- Rename field sentAt on message to deliveredAt
--
ALTER TABLE "Message" RENAME COLUMN "sentAt" TO "deliveredAt";
--
-- Rename field sentAt on messagehistoryrecord to deliveredAt
--
ALTER TABLE "MessageHistoryRecord" RENAME COLUMN "sentAt" TO "deliveredAt";

COMMIT;

    `)
}
