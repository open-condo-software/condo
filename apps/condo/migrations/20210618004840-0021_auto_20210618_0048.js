// auto generated by kmigrator
// KMIGRATOR:0021_auto_20210618_0048:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi4zIG9uIDIwMjEtMDYtMTggMDA6NDgKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwMjBfYXV0b18yMDIxMDYxMV8xMjUwJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXQnLAogICAgICAgICAgICBuYW1lPSdjb250YWN0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjb250YWN0JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmNvbnRhY3QnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2NvbnRhY3REaXNwbGF5TmFtZUZyb20nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRjaGFuZ2UnLAogICAgICAgICAgICBuYW1lPSdjb250YWN0RGlzcGxheU5hbWVUbycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2NvbnRhY3RJZEZyb20nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRjaGFuZ2UnLAogICAgICAgICAgICBuYW1lPSdjb250YWN0SWRUbycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdjb250YWN0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field contact to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "contact" uuid NULL CONSTRAINT "Ticket_contact_33a1e141_fk_Contact_id" REFERENCES "Contact"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Ticket_contact_33a1e141_fk_Contact_id" IMMEDIATE;
--
-- Add field contactDisplayNameFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "contactDisplayNameFrom" text NULL;
--
-- Add field contactDisplayNameTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "contactDisplayNameTo" text NULL;
--
-- Add field contactIdFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "contactIdFrom" uuid NULL;
--
-- Add field contactIdTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "contactIdTo" uuid NULL;
--
-- Add field contact to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "contact" uuid NULL;
CREATE INDEX "Ticket_contact_33a1e141" ON "Ticket" ("contact");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field contact to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "contact" CASCADE;
--
-- Add field contactIdTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "contactIdTo" CASCADE;
--
-- Add field contactIdFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "contactIdFrom" CASCADE;
--
-- Add field contactDisplayNameTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "contactDisplayNameTo" CASCADE;
--
-- Add field contactDisplayNameFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "contactDisplayNameFrom" CASCADE;
--
-- Add field contact to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "contact" CASCADE;
COMMIT;

    `)
}
