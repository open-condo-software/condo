// auto generated by kmigrator
// KMIGRATOR:0388_auto_20240419_1527:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjQtMDQtMTkgMTU6MjcKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzODdfYWx0ZXJfbWVzc2FnZV90eXBlX2FsdGVyX21lc3NhZ2VhcHBibGFja2xpc3RfdHlwZV9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nZG9jdW1lbnRjYXRlZ29yeWhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCduYW1lJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfZGF0ZScsIG1vZGVscy5EYXRlVGltZUZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2FjdGlvbicsIG1vZGVscy5DaGFyRmllbGQoY2hvaWNlcz1bKCdjJywgJ2MnKSwgKCd1JywgJ3UnKSwgKCdkJywgJ2QnKV0sIG1heF9sZW5ndGg9NTApKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9pZCcsIG1vZGVscy5VVUlERmllbGQoZGJfaW5kZXg9VHJ1ZSkpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdEb2N1bWVudENhdGVnb3J5SGlzdG9yeVJlY29yZCcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdkb2N1bWVudGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdvcmdhbml6YXRpb24nLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdwcm9wZXJ0eScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NhdGVnb3J5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmFtZScsIG1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2ZpbGUnLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9kYXRlJywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfYWN0aW9uJywgbW9kZWxzLkNoYXJGaWVsZChjaG9pY2VzPVsoJ2MnLCAnYycpLCAoJ3UnLCAndScpLCAoJ2QnLCAnZCcpXSwgbWF4X2xlbmd0aD01MCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2lkJywgbW9kZWxzLlVVSURGaWVsZChkYl9pbmRleD1UcnVlKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ0RvY3VtZW50SGlzdG9yeVJlY29yZCcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGUnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VEb2N1bWVudHMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVyb2xlJywKICAgICAgICAgICAgbmFtZT0nY2FuUmVhZERvY3VtZW50cycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1UcnVlKSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlcm9sZWhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VEb2N1bWVudHMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGVoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2FuUmVhZERvY3VtZW50cycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2RvY3VtZW50Y2F0ZWdvcnknLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCduYW1lJywgbW9kZWxzLlRleHRGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY3JlYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0ndXBkYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ0RvY3VtZW50Q2F0ZWdvcnknLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nZG9jdW1lbnQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCduYW1lJywgbW9kZWxzLlRleHRGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnZmlsZScsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoZGVmYXVsdD0xKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdjYXRlZ29yeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY2F0ZWdvcnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuZG9jdW1lbnRjYXRlZ29yeScpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjcmVhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgICAgICgnb3JnYW5pemF0aW9uJywgbW9kZWxzLkZvcmVpZ25LZXkoZGJfY29sdW1uPSdvcmdhbml6YXRpb24nLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEub3JnYW5pemF0aW9uJykpLAogICAgICAgICAgICAgICAgKCdwcm9wZXJ0eScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0ncHJvcGVydHknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5wcm9wZXJ0eScpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnRG9jdW1lbnQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
    
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';


--
-- Create model documentcategoryhistoryrecord
--
CREATE TABLE "DocumentCategoryHistoryRecord" ("name" text NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Create model documenthistoryrecord
--
CREATE TABLE "DocumentHistoryRecord" ("organization" uuid NULL, "property" uuid NULL, "category" uuid NULL, "name" text NULL, "file" jsonb NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field canManageDocuments to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" ADD COLUMN "canManageDocuments" boolean DEFAULT false NOT NULL;
ALTER TABLE "OrganizationEmployeeRole" ALTER COLUMN "canManageDocuments" DROP DEFAULT;
--
-- Add field canReadDocuments to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" ADD COLUMN "canReadDocuments" boolean DEFAULT true NOT NULL;
ALTER TABLE "OrganizationEmployeeRole" ALTER COLUMN "canReadDocuments" DROP DEFAULT;
--
-- Add field canManageDocuments to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" ADD COLUMN "canManageDocuments" boolean NULL;
--
-- Add field canReadDocuments to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" ADD COLUMN "canReadDocuments" boolean NULL;
--
-- Create model documentcategory
--
CREATE TABLE "DocumentCategory" ("name" text NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
--
-- Create model document
--
CREATE TABLE "Document" ("name" text NOT NULL, "file" jsonb NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "category" uuid NULL, "createdBy" uuid NULL, "organization" uuid NOT NULL, "property" uuid NULL, "updatedBy" uuid NULL);
CREATE INDEX "DocumentCategoryHistoryRecord_history_id_86c11a36" ON "DocumentCategoryHistoryRecord" ("history_id");
CREATE INDEX "DocumentHistoryRecord_history_id_b1da8322" ON "DocumentHistoryRecord" ("history_id");
ALTER TABLE "DocumentCategory" ADD CONSTRAINT "DocumentCategory_createdBy_4e48136e_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "DocumentCategory" ADD CONSTRAINT "DocumentCategory_updatedBy_0d429d68_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "DocumentCategory_createdAt_c8b1b811" ON "DocumentCategory" ("createdAt");
CREATE INDEX "DocumentCategory_updatedAt_3f3516cb" ON "DocumentCategory" ("updatedAt");
CREATE INDEX "DocumentCategory_deletedAt_969e3b65" ON "DocumentCategory" ("deletedAt");
CREATE INDEX "DocumentCategory_createdBy_4e48136e" ON "DocumentCategory" ("createdBy");
CREATE INDEX "DocumentCategory_updatedBy_0d429d68" ON "DocumentCategory" ("updatedBy");
ALTER TABLE "Document" ADD CONSTRAINT "Document_category_760d72ff_fk_DocumentCategory_id" FOREIGN KEY ("category") REFERENCES "DocumentCategory" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Document" ADD CONSTRAINT "Document_createdBy_57173a26_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Document" ADD CONSTRAINT "Document_organization_ba7c6576_fk_Organization_id" FOREIGN KEY ("organization") REFERENCES "Organization" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Document" ADD CONSTRAINT "Document_property_fb12a0cf_fk_Property_id" FOREIGN KEY ("property") REFERENCES "Property" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Document" ADD CONSTRAINT "Document_updatedBy_ec6bc064_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Document_createdAt_3cde854e" ON "Document" ("createdAt");
CREATE INDEX "Document_updatedAt_899088c5" ON "Document" ("updatedAt");
CREATE INDEX "Document_deletedAt_ab2f8c95" ON "Document" ("deletedAt");
CREATE INDEX "Document_category_760d72ff" ON "Document" ("category");
CREATE INDEX "Document_createdBy_57173a26" ON "Document" ("createdBy");
CREATE INDEX "Document_organization_ba7c6576" ON "Document" ("organization");
CREATE INDEX "Document_property_fb12a0cf" ON "Document" ("property");
CREATE INDEX "Document_updatedBy_ec6bc064" ON "Document" ("updatedBy");


---
--- [CUSTOM] Set default values "canReadDocuments" to existed roles (all roles)
---

UPDATE "OrganizationEmployeeRole"
SET "canReadDocuments" = true
WHERE "name" = 'employee.role.Administrator.name'
    OR "name" = 'employee.role.Dispatcher.name'
    OR "name" = 'employee.role.Manager.name'
    OR "name" = 'employee.role.Foreman.name'
    OR "name" = 'employee.role.Technician.name'
    OR "name" = 'employee.role.Contractor.name';
    
---
--- [CUSTOM] Set default values "canManageDocuments" to existed roles (all without Contractor)
---

UPDATE "OrganizationEmployeeRole"
SET "canManageDocuments" = true
WHERE "name" = 'employee.role.Administrator.name'
    OR "name" = 'employee.role.Dispatcher.name'
    OR "name" = 'employee.role.Manager.name'
    OR "name" = 'employee.role.Foreman.name'
    OR "name" = 'employee.role.Technician.name';

INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.DefectActs.name', 'ef4f855d-a52d-4a22-b8fe-28711ce861db', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.InspectionActs.name', '4d972bb9-e9fb-4924-9031-5a7e6065fb67', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.AutumnInspections.name', '7732e530-98ba-464d-a4fc-9e7fa0471fe3', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.SpringInspections.name', '5c9c9751-b5a5-4ae9-a75b-0a11c7133203', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.CleaningActs.name', '86848a7d-19b6-4f6f-96d1-2e9a991973b8', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.CompletedWorksActs.name', '996d6cc4-7c14-4f82-86c0-b5fd897c046d', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.GeneralMeetings.name', '044e2c73-c0f5-471a-b395-8c744f174f54', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.Encumbrances.name', 'a0890069-a3ff-4f98-8975-c21f5dd002f1', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.WorkPlans.name', '12828df1-5146-45e9-a0ae-c805f9a0df8b', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.ProjectDocumentation.name', '9f7fbea2-3aff-46ec-9881-53c6ae07b995', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.TechnicalDocumentation.name', 'd106c8f0-c5fd-4c18-8cd0-b2b5477e9799', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.ContainerSites.name', 'b1cdd059-5b71-4915-997c-d5fad0857627', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
INSERT INTO "DocumentCategory" (name, id, v, "createdAt", "updatedAt", "deletedAt", "newId", dv, sender, "createdBy", "updatedBy") VALUES ('document.category.OtherDocuments.name', 'b9a35f9d-370a-4c35-959d-83d6ec39b7e4', 1, now(), now(), null, null, 1, '{"dv": 1, "fingerprint": "migration-initial-create"}', null, null);
        
--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model document
--
DROP TABLE "Document" CASCADE;
--
-- Create model documentcategory
--
DROP TABLE "DocumentCategory" CASCADE;
--
-- Add field canReadDocuments to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" DROP COLUMN "canReadDocuments" CASCADE;
--
-- Add field canManageDocuments to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" DROP COLUMN "canManageDocuments" CASCADE;
--
-- Add field canReadDocuments to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" DROP COLUMN "canReadDocuments" CASCADE;
--
-- Add field canManageDocuments to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" DROP COLUMN "canManageDocuments" CASCADE;
--
-- Create model documenthistoryrecord
--
DROP TABLE "DocumentHistoryRecord" CASCADE;
--
-- Create model documentcategoryhistoryrecord
--
DROP TABLE "DocumentCategoryHistoryRecord" CASCADE;
COMMIT;

    `)
}
