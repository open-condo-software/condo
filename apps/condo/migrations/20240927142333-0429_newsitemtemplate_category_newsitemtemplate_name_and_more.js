// auto generated by kmigrator
// KMIGRATOR:0429_newsitemtemplate_category_newsitemtemplate_name_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMC43IG9uIDIwMjQtMDktMjcgMDk6MjQKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0MjhfY29udGFjdF9jb250YWN0X3Bob25lX2lzdmVyaWZpZWQnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25ld3NpdGVtdGVtcGxhdGUnLAogICAgICAgICAgICBuYW1lPSdjYXRlZ29yeScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5DaGFyRmllbGQoYmxhbms9VHJ1ZSwgY2hvaWNlcz1bKCdXQVRFUicsICdXQVRFUicpLCAoJ0hFQVRJTkcnLCAnSEVBVElORycpLCAoJ0VMRUNUUklDSVRZJywgJ0VMRUNUUklDSVRZJyksICgnVVRJTElUSUVTJywgJ1VUSUxJVElFUycpLCAoJ0VMRUNUUklDSVRZX0FORF9FTEVWQVRPUlMnLCAnRUxFQ1RSSUNJVFlfQU5EX0VMRVZBVE9SUycpLCAoJ0VMRVZBVE9SUycsICdFTEVWQVRPUlMnKSwgKCdURUxFUEhPTkUnLCAnVEVMRVBIT05FJyksICgnTUVURVJTJywgJ01FVEVSUycpLCAoJ0dBUycsICdHQVMnKSwgKCdDTEVBTklORycsICdDTEVBTklORycpLCAoJ0lOVEVSQ09NJywgJ0lOVEVSQ09NJyksICgnU05PVycsICdTTk9XJyksICgnT1RIRVInLCAnT1RIRVInKV0sIG1heF9sZW5ndGg9NTAsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSduZXdzaXRlbXRlbXBsYXRlJywKICAgICAgICAgICAgbmFtZT0nbmFtZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoZGVmYXVsdD0nJyksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSduZXdzaXRlbXRlbXBsYXRlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2NhdGVnb3J5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbmV3c2l0ZW10ZW1wbGF0ZWhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSduYW1lJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field category to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" ADD COLUMN "category" varchar(50) NULL;
--
-- Add field name to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" ADD COLUMN "name" text DEFAULT '' NOT NULL;
ALTER TABLE "NewsItemTemplate" ALTER COLUMN "name" DROP DEFAULT;
--
-- [CUSTOM] The value of the "name" field for old records must be dynamic. Therefore, the required "name" field in old records is set to "".
-- [CUSTOM] Then the static value of "" is overwritten and the dynamic value name = title is set.
--
UPDATE "NewsItemTemplate" SET name = title;
--
-- Add field category to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" ADD COLUMN "category" text NULL;
--
-- Add field name to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" ADD COLUMN "name" text NULL;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field name to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" DROP COLUMN "name" CASCADE;
--
-- Add field category to newsitemtemplatehistoryrecord
--
ALTER TABLE "NewsItemTemplateHistoryRecord" DROP COLUMN "category" CASCADE;
--
-- Add field name to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" DROP COLUMN "name" CASCADE;
--
-- Add field category to newsitemtemplate
--
ALTER TABLE "NewsItemTemplate" DROP COLUMN "category" CASCADE;
COMMIT;

    `)
}
