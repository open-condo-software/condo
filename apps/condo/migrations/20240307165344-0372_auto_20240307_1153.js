// auto generated by kmigrator
// KMIGRATOR:0372_auto_20240307_1153:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC41IG9uIDIwMjQtMDMtMDcgMTE6NTMKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMzcxX2FsdGVyX25vdGlmaWNhdGlvbmFub255bW91c3NldHRpbmdfbWVzc2FnZXR5cGVfYW5kX21vcmUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
        BEGIN;
        
        SET statement_timeout = '1500s';
        
        --
        -- [CUSTOM] Set unitType to NULL in Tickets and Contacts which have unitName null and not null unitType 
        --
        UPDATE "Ticket"
        SET "unitType" = NULL
        WHERE "unitName" IS NULL AND "unitType" IS NOT NULL;
        
        UPDATE "Contact"
        SET "unitType" = NULL
        WHERE "unitName" IS NULL AND "unitType" IS NOT NULL;
        
        --
        -- [CUSTOM] Set unitType to 'flat' in Tickets and Contacts which have unitName not null and null unitType 
        --
        UPDATE "Ticket"
        SET "unitType" = 'flat'
        WHERE "unitName" IS NOT NULL AND "unitType" IS NULL;
        
        UPDATE "Contact"
        SET "unitType" = 'flat'
        WHERE "unitName" IS NOT NULL AND "unitType" IS NULL;
        
        --
        -- [CUSTOM] Set sectionType to NULL in Tickets which have unitName null and not null unitType 
        --
        UPDATE "Ticket"
        SET "sectionType" = NULL
        WHERE "sectionName" IS NULL AND "sectionType" IS NOT NULL;
        
        --
        -- [CUSTOM] Set sectionType to 'section' in Tickets which have unitName not null and null unitType 
        --
        UPDATE "Ticket"
        SET "sectionType" = 'section'
        WHERE "sectionName" IS NOT NULL AND "sectionType" IS NULL;
        
        SET statement_timeout = '10s';
        
        COMMIT;
    `)
}

exports.down = async (knex) => {
    await knex.raw(`
        BEGIN;
        COMMIT;
    `)
}
