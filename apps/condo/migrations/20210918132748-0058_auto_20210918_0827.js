// auto generated by kmigrator
// KMIGRATOR:0058_auto_20210918_0827:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi40IG9uIDIwMjEtMDktMTggMDg6MjcKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwNTdfcmVzaWRlbnRoaXN0b3J5cmVjb3JkX29yZ2FuaXphdGlvbmZlYXR1cmVzJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2JpbGxpbmdhY2NvdW50JywKICAgICAgICAgICAgbmFtZT0nZ2xvYmFsSWQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2JpbGxpbmdwcm9wZXJ0eScsCiAgICAgICAgICAgIG5hbWU9J2dsb2JhbElkJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZCgpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiaWxsaW5nYWNjb3VudCcsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoZmllbGRzPSgnY29udGV4dCcsICdnbG9iYWxJZCcpLCBuYW1lPSd1bmlxdWVfY29udGV4dF9hbmRfaWQnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ3Byb3BlcnR5JywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChmaWVsZHM9KCdjb250ZXh0JywgJ2dsb2JhbElkJyksIG5hbWU9J3VuaXF1ZV9jb250ZXh0X2FuZF9maWFzX2lkJyksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field globalId on billingaccount
--
ALTER TABLE "BillingAccount" DROP CONSTRAINT "BillingAccount_bindingId_key";
DROP INDEX IF EXISTS "BillingAccount_globalId_e29b5e61_like";
--
-- Alter field globalId on billingproperty
--
ALTER TABLE "BillingProperty" DROP CONSTRAINT "BillingProperty_bindingId_key";
DROP INDEX IF EXISTS "BillingProperty_globalId_31075b81_like";
--
-- Create constraint unique_context_and_id on model billingaccount
--
ALTER TABLE "BillingAccount" ADD CONSTRAINT "unique_context_and_id" UNIQUE ("context", "globalId");
--
-- Create constraint unique_context_and_fias_id on model billingproperty
--
ALTER TABLE "BillingProperty" ADD CONSTRAINT "unique_context_and_fias_id" UNIQUE ("context", "globalId");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint unique_context_and_fias_id on model billingproperty
--
ALTER TABLE "BillingProperty" DROP CONSTRAINT "unique_context_and_fias_id";
--
-- Create constraint unique_context_and_id on model billingaccount
--
ALTER TABLE "BillingAccount" DROP CONSTRAINT "unique_context_and_id";
--
-- Alter field globalId on billingproperty
--
ALTER TABLE "BillingProperty" ADD CONSTRAINT "BillingProperty_globalId_31075b81_uniq" UNIQUE ("globalId");
CREATE INDEX "BillingProperty_globalId_31075b81_like" ON "BillingProperty" ("globalId" text_pattern_ops);
--
-- Alter field globalId on billingaccount
--
ALTER TABLE "BillingAccount" ADD CONSTRAINT "BillingAccount_globalId_e29b5e61_uniq" UNIQUE ("globalId");
CREATE INDEX "BillingAccount_globalId_e29b5e61_like" ON "BillingAccount" ("globalId" text_pattern_ops);
COMMIT;

    `)
}
