// auto generated by kmigrator
// KMIGRATOR:0049_auto_20210826_1135:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjEtMDgtMjYgMTE6MzUKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwNDhfYXV0b18yMDIxMDgyNV8xNDI5JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb24nLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRJZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbicsCiAgICAgICAgICAgIG5hbWU9J2ltcG9ydFJlbW90ZVN5c3RlbScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRJZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRSZW1vdGVTeXN0ZW0nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd1c2VyJywKICAgICAgICAgICAgbmFtZT0naW1wb3J0UmVtb3RlU3lzdGVtJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbXBvcnRSZW1vdGVTeXN0ZW0nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXInLAogICAgICAgICAgICBuYW1lPSdlbWFpbCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcicsCiAgICAgICAgICAgIG5hbWU9J2ltcG9ydElkJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field importId to organization
--
ALTER TABLE "Organization" ADD COLUMN "importId" text NULL;
--
-- Add field importRemoteSystem to organization
--
ALTER TABLE "Organization" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Add field importId to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" ADD COLUMN "importId" text NULL;
--
-- Add field importRemoteSystem to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Add field importRemoteSystem to user
--
ALTER TABLE "User" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Add field importRemoteSystem to userhistoryrecord
--
ALTER TABLE "UserHistoryRecord" ADD COLUMN "importRemoteSystem" text NULL;
--
-- Alter field email on user
--
ALTER TABLE "User" DROP CONSTRAINT "User_email_key";
DROP INDEX IF EXISTS "User_email_667201b5_like";
--
-- Alter field importId on user
--
ALTER TABLE "User" DROP CONSTRAINT "User_importId_key";
DROP INDEX IF EXISTS "User_importId_1ba44fc8_like";
--
-- Create uniq pairs of fields indexes
--
ALTER TABLE "User" ADD CONSTRAINT "user_importId_importRemoteSystem_key" UNIQUE ("importId", "importRemoteSystem");
ALTER TABLE "User" ADD CONSTRAINT "user_phone_type_key" UNIQUE ("phone", "type");
ALTER TABLE "User" ADD CONSTRAINT "user_email_type_key" UNIQUE ("email", "type");
ALTER TABLE "Organization" ADD CONSTRAINT "organization_importId_importRemoteSystem_key" UNIQUE ("importId", "importRemoteSystem");

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field importId on user
--
ALTER TABLE "User" ADD CONSTRAINT "User_importId_1ba44fc8_uniq" UNIQUE ("importId");
CREATE INDEX "User_importId_1ba44fc8_like" ON "User" ("importId" text_pattern_ops);
--
-- Alter field email on user
--
ALTER TABLE "User" ADD CONSTRAINT "User_email_667201b5_uniq" UNIQUE ("email");
CREATE INDEX "User_email_667201b5_like" ON "User" ("email" text_pattern_ops);
--
-- Add field importRemoteSystem to userhistoryrecord
--
ALTER TABLE "UserHistoryRecord" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importRemoteSystem to user
--
ALTER TABLE "User" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importRemoteSystem to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importId to organizationhistoryrecord
--
ALTER TABLE "OrganizationHistoryRecord" DROP COLUMN "importId" CASCADE;
--
-- Add field importRemoteSystem to organization
--
ALTER TABLE "Organization" DROP COLUMN "importRemoteSystem" CASCADE;
--
-- Add field importId to organization
--
ALTER TABLE "Organization" DROP COLUMN "importId" CASCADE;
--
-- Drop uniq pairs of fields indexes
--
ALTER TABLE "User" DROP CONSTRAINT "user_importId_importRemoteSystem_key";
ALTER TABLE "User" DROP CONSTRAINT "user_phone_type_key";
ALTER TABLE "User" DROP CONSTRAINT "user_email_type_key";
ALTER TABLE "Organization" DROP CONSTRAINT "organization_importId_importRemoteSystem_key";

COMMIT;


    `)
}
