// auto generated by kmigrator
// KMIGRATOR:0040_auto_20210810_1947:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjEtMDgtMTAgMTQ6NDcNCg0KZnJvbSBkamFuZ28uZGIgaW1wb3J0IG1pZ3JhdGlvbnMsIG1vZGVscw0KDQoNCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6DQoNCiAgICBkZXBlbmRlbmNpZXMgPSBbDQogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDAzOV9hdXRvXzIwMjEwODEwXzA5MTgnKSwNCiAgICBdDQoNCiAgICBvcGVyYXRpb25zID0gWw0KICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoDQogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZScsDQogICAgICAgICAgICBuYW1lPSdpZCcsDQogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSksDQogICAgICAgICksDQogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJGaWVsZCgNCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlJywNCiAgICAgICAgICAgIG5hbWU9J25ld0lkJywNCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwNCiAgICAgICAgKSwNCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKA0KICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVoaXN0b3J5cmVjb3JkJywNCiAgICAgICAgICAgIG5hbWU9J2hpc3RvcnlfaWQnLA0KICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlVVSURGaWVsZChkYl9pbmRleD1UcnVlKSwNCiAgICAgICAgKSwNCiAgICBdDQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
    CREATE EXTENSION if not exists "uuid-ossp";
    COMMIT;

    --
    -- Alter field id on organizationemployee
    --
    ALTER TABLE "OrganizationEmployee" ADD COLUMN new_id UUID NULL;
    COMMIT;
    UPDATE "OrganizationEmployee" SET new_id = uuid_generate_v4();
    ALTER TABLE "OrganizationEmployee" DROP COLUMN id;
    ALTER TABLE "OrganizationEmployee" RENAME COLUMN new_id TO id;
    ALTER TABLE "OrganizationEmployee" ALTER COLUMN id SET NOT NULL;
    DROP SEQUENCE IF EXISTS "OrganizationEmployee_id_seq" CASCADE;
    COMMIT;

    --
    -- Alter field newId on organizationemployee
    --
    ALTER TABLE "OrganizationEmployee" ADD COLUMN "new_newId" UUID NULL;
    UPDATE "OrganizationEmployee" SET "new_newId" = uuid_generate_v4();
    ALTER TABLE "OrganizationEmployee" DROP COLUMN "newId";
    ALTER TABLE "OrganizationEmployee" RENAME COLUMN "new_newId" TO "newId";
    COMMIT;

    --
    -- Alter field history_id on organizationemployeehistoryrecord
    --
    ALTER TABLE "OrganizationEmployeeHistoryRecord" ADD COLUMN "new_history_id" UUID NULL;
    COMMIT;
    UPDATE "OrganizationEmployeeHistoryRecord" SET "new_history_id" = uuid_generate_v4();
    ALTER TABLE "OrganizationEmployeeHistoryRecord" DROP COLUMN "history_id";
    ALTER TABLE "OrganizationEmployeeHistoryRecord" RENAME COLUMN "new_history_id" TO "history_id";
    ALTER TABLE "OrganizationEmployeeHistoryRecord" ALTER COLUMN "history_id" SET NOT NULL;
    COMMIT;
    `)
}

exports.down = async (knex) => {
    return
}
