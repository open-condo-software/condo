// auto generated by kmigrator
// KMIGRATOR:0331_payment_frozeninvoice_payment_invoice_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMi40IG9uIDIwMjMtMTAtMjQgMDU6NTQKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzMzBfYXV0b18yMDIzMTAyM18wNTUzJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdwYXltZW50JywKICAgICAgICAgICAgbmFtZT0nZnJvemVuSW52b2ljZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3BheW1lbnQnLAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdpbnZvaWNlJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmludm9pY2UnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3BheW1lbnRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nZnJvemVuSW52b2ljZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3BheW1lbnRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0naW52b2ljZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
    


--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';



--
-- Add field frozenInvoice to payment
--
ALTER TABLE "Payment" ADD COLUMN "frozenInvoice" jsonb NULL;
--
-- Add field invoice to payment
--
ALTER TABLE "Payment" ADD COLUMN "invoice" uuid NULL CONSTRAINT "Payment_invoice_1740b735_fk_Invoice_id" REFERENCES "Invoice"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Payment_invoice_1740b735_fk_Invoice_id" IMMEDIATE;
--
-- Add field frozenInvoice to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" ADD COLUMN "frozenInvoice" jsonb NULL;
--
-- Add field invoice to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" ADD COLUMN "invoice" uuid NULL;
CREATE INDEX "Payment_invoice_1740b735" ON "Payment" ("invoice");



--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';



COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field invoice to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" DROP COLUMN "invoice" CASCADE;
--
-- Add field frozenInvoice to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" DROP COLUMN "frozenInvoice" CASCADE;
--
-- Add field invoice to payment
--
ALTER TABLE "Payment" DROP COLUMN "invoice" CASCADE;
--
-- Add field frozenInvoice to payment
--
ALTER TABLE "Payment" DROP COLUMN "frozenInvoice" CASCADE;
COMMIT;

    `)
}
