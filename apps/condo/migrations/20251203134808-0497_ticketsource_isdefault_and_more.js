// auto generated by kmigrator
// KMIGRATOR:0497_ticketsource_isdefault_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC41IG9uIDIwMjUtMTItMDMgMDg6NDgKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0OTZfdGlja2V0X3NlbnR0b2F1dGhvcml0aWVzYXRfYW5kX21vcmUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldHNvdXJjZScsCiAgICAgICAgICAgIG5hbWU9J2lzRGVmYXVsdCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1GYWxzZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRzb3VyY2VoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0naXNEZWZhdWx0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field isDefault to ticketsource
--
ALTER TABLE "TicketSource" ADD COLUMN "isDefault" boolean DEFAULT false NOT NULL;
ALTER TABLE "TicketSource" ALTER COLUMN "isDefault" DROP DEFAULT;
--
-- Add field isDefault to ticketsourcehistoryrecord
--
ALTER TABLE "TicketSourceHistoryRecord" ADD COLUMN "isDefault" boolean NULL;

--
-- MANUAL. Set default ticket sources 
--

UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '0e9af80b-b5f0-4667-9f8e-577f1cab1a21';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '3068d49a-a45c-4c3a-a02d-ea1a53e1febb';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '69067480-e117-4e4d-8875-3970c79d6da3'; 
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '779d7bb6-b194-4d2c-a967-1f7321b2787f';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '7da1e3be-06ba-4c9e-bba6-f97f278ac6e4';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '8e12e1c4-3911-4cdb-acce-4c20f19d4f9b';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = 'a6737b2f-0e48-45e3-bd94-71952668666a';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = 'afb00440-25f8-4508-8f9f-4edc1dc47de7';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = 'b2e93f41-fa8a-40a0-8748-d404e1a46639';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = 'e5946771-2b04-498d-a600-5bed68a2d751';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '291e093c-050b-4dbd-96d1-da67c5826b6d';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '830d1d89-2d17-4c5b-96d1-21b5cd01a6d3';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = '92cfa7b1-b793-4c22-ae03-ea2aae1e1315';
UPDATE "TicketSource" SET "isDefault" = TRUE WHERE id = 'f77e732c-cef4-4e89-9275-a8db83c798f9';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field isDefault to ticketsourcehistoryrecord
--
ALTER TABLE "TicketSourceHistoryRecord" DROP COLUMN "isDefault" CASCADE;
--
-- Add field isDefault to ticketsource
--
ALTER TABLE "TicketSource" DROP COLUMN "isDefault" CASCADE;
COMMIT;

    `)
}
