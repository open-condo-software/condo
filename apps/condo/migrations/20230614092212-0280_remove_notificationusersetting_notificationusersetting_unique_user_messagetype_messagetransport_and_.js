// auto generated by kmigrator
// KMIGRATOR:0280_remove_notificationusersetting_notificationusersetting_unique_user_messagetype_messagetransport_and_:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC4xIG9uIDIwMjMtMDYtMTQgMDQ6MjIKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAyNzlfbmV3c2l0ZW1fbnVtYmVyX25ld3NpdGVtaGlzdG9yeXJlY29yZF9udW1iZXInKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9udXNlcnNldHRpbmcnLAogICAgICAgICAgICBuYW1lPSdOb3RpZmljYXRpb25Vc2VyU2V0dGluZ191bmlxdWVfdXNlcl9tZXNzYWdlVHlwZV9tZXNzYWdlVHJhbnNwb3J0JywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9udXNlcnNldHRpbmcnLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSkpLCBmaWVsZHM9KCd1c2VyJywgJ21lc3NhZ2VUeXBlJywgJ21lc3NhZ2VUcmFuc3BvcnQnKSwgbmFtZT0nTm90aWZpY2F0aW9uVXNlclNldHRpbmdfdW5pcXVlX3VzZXJfbWVzc2FnZVR5cGVfbWVzc2FnZVRyYW5zcG9ydCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdub3RpZmljYXRpb251c2Vyc2V0dGluZycsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSwgKCdtZXNzYWdlVHJhbnNwb3J0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3VzZXInLCAnbWVzc2FnZVR5cGUnKSwgbmFtZT0nTm90aWZpY2F0aW9uVXNlclNldHRpbmdfdW5pcXVlX3VzZXJfbWVzc2FnZVR5cGUnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9udXNlcnNldHRpbmcnLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSksICgnbWVzc2FnZVR5cGVfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgndXNlcicsICdtZXNzYWdlVHJhbnNwb3J0JyksIG5hbWU9J05vdGlmaWNhdGlvblVzZXJTZXR0aW5nX3VuaXF1ZV91c2VyX21lc3NhZ2VUcmFuc3BvcnQnKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove constraint NotificationUserSetting_unique_user_messageType_messageTransport from model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "NotificationUserSetting_unique_user_messageType_messageTransport";
--
-- Create constraint NotificationUserSetting_unique_user_messageType_messageTransport on model notificationusersetting
--
CREATE UNIQUE INDEX "NotificationUserSetting_unique_user_messageType_messageTransport" ON "NotificationUserSetting" ("user", "messageType", "messageTransport") WHERE "deletedAt" IS NULL;
--
-- Create constraint NotificationUserSetting_unique_user_messageType on model notificationusersetting
--
CREATE UNIQUE INDEX "NotificationUserSetting_unique_user_messageType" ON "NotificationUserSetting" ("user", "messageType") WHERE ("deletedAt" IS NULL AND "messageTransport" IS NULL);
--
-- Create constraint NotificationUserSetting_unique_user_messageTransport on model notificationusersetting
--
CREATE UNIQUE INDEX "NotificationUserSetting_unique_user_messageTransport" ON "NotificationUserSetting" ("user", "messageTransport") WHERE ("deletedAt" IS NULL AND "messageType" IS NULL);
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint NotificationUserSetting_unique_user_messageTransport on model notificationusersetting
--
DROP INDEX IF EXISTS "NotificationUserSetting_unique_user_messageTransport";
--
-- Create constraint NotificationUserSetting_unique_user_messageType on model notificationusersetting
--
DROP INDEX IF EXISTS "NotificationUserSetting_unique_user_messageType";
--
-- Create constraint NotificationUserSetting_unique_user_messageType_messageTransport on model notificationusersetting
--
DROP INDEX IF EXISTS "NotificationUserSetting_unique_user_messageType_messageTransport";
--
-- Remove constraint NotificationUserSetting_unique_user_messageType_messageTransport from model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "NotificationUserSetting_unique_user_messageType_messageTransport" UNIQUE ("user", "messageType", "messageTransport");
COMMIT;

    `)
}
