// auto generated by kmigrator
// KMIGRATOR:0177_assigneescope_assigneescopehistoryrecord_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMSBvbiAyMDIyLTEwLTEzIDA3OjE2Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCmltcG9ydCBkamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMTc2X2FsdGVyX3RpY2tldHNvdXJjZV90eXBlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdhc3NpZ25lZXNjb3BlJywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY3JlYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgICAgICAoJ3RpY2tldCcsIG1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0ndGlja2V0Jywgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uQ0FTQ0FERSwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnRpY2tldCcpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgICAgICgndXNlcicsIG1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0ndXNlcicsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdBc3NpZ25lZVNjb3BlJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2Fzc2lnbmVlc2NvcGVoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgndXNlcicsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3RpY2tldCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2RhdGUnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9hY3Rpb24nLCBtb2RlbHMuQ2hhckZpZWxkKGNob2ljZXM9WygnYycsICdjJyksICgndScsICd1JyksICgnZCcsICdkJyldLCBtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQXNzaWduZWVTY29wZUhpc3RvcnlSZWNvcmQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVzcGVjaWFsaXphdGlvbicsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoZGVmYXVsdD0xKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQnknLCBtb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J2NyZWF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdPcmdhbml6YXRpb25FbXBsb3llZVNwZWNpYWxpemF0aW9uJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlc3BlY2lhbGl6YXRpb25oaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgnZW1wbG95ZWUnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzcGVjaWFsaXphdGlvbicsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2RhdGUnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9hY3Rpb24nLCBtb2RlbHMuQ2hhckZpZWxkKGNob2ljZXM9WygnYycsICdjJyksICgndScsICd1JyksICgnZCcsICdkJyldLCBtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnT3JnYW5pemF0aW9uRW1wbG95ZWVTcGVjaWFsaXphdGlvbkhpc3RvcnlSZWNvcmQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0ncHJvcGVydHlzY29wZScsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ25hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdoYXNBbGxQcm9wZXJ0aWVzJywgbW9kZWxzLkJvb2xlYW5GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaGFzQWxsRW1wbG95ZWVzJywgbW9kZWxzLkJvb2xlYW5GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY3JlYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgICAgICAoJ29yZ2FuaXphdGlvbicsIG1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0nb3JnYW5pemF0aW9uJywgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uQ0FTQ0FERSwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLm9yZ2FuaXphdGlvbicpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnUHJvcGVydHlTY29wZScsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdwcm9wZXJ0eXNjb3BlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ25hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdvcmdhbml6YXRpb24nLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdoYXNBbGxQcm9wZXJ0aWVzJywgbW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGFzQWxsRW1wbG95ZWVzJywgbW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfZGF0ZScsIG1vZGVscy5EYXRlVGltZUZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2FjdGlvbicsIG1vZGVscy5DaGFyRmllbGQoY2hvaWNlcz1bKCdjJywgJ2MnKSwgKCd1JywgJ3UnKSwgKCdkJywgJ2QnKV0sIG1heF9sZW5ndGg9NTApKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9pZCcsIG1vZGVscy5VVUlERmllbGQoZGJfaW5kZXg9VHJ1ZSkpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdQcm9wZXJ0eVNjb3BlSGlzdG9yeVJlY29yZCcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdwcm9wZXJ0eXNjb3Blb3JnYW5pemF0aW9uZW1wbG95ZWUnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGRlZmF1bHQ9MSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjcmVhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnUHJvcGVydHlTY29wZU9yZ2FuaXphdGlvbkVtcGxveWVlJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J3Byb3BlcnR5c2NvcGVvcmdhbml6YXRpb25lbXBsb3llZWhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdwcm9wZXJ0eVNjb3BlJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZW1wbG95ZWUnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9kYXRlJywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfYWN0aW9uJywgbW9kZWxzLkNoYXJGaWVsZChjaG9pY2VzPVsoJ2MnLCAnYycpLCAoJ3UnLCAndScpLCAoJ2QnLCAnZCcpXSwgbWF4X2xlbmd0aD01MCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2lkJywgbW9kZWxzLlVVSURGaWVsZChkYl9pbmRleD1UcnVlKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ1Byb3BlcnR5U2NvcGVPcmdhbml6YXRpb25FbXBsb3llZUhpc3RvcnlSZWNvcmQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0ncHJvcGVydHlzY29wZXByb3BlcnR5JywKICAgICAgICAgICAgZmllbGRzPVsKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY3JlYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgICAgICAoJ3Byb3BlcnR5JywgbW9kZWxzLkZvcmVpZ25LZXkoZGJfY29sdW1uPSdwcm9wZXJ0eScsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5wcm9wZXJ0eScpKSwKICAgICAgICAgICAgICAgICgncHJvcGVydHlTY29wZScsIG1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0ncHJvcGVydHlTY29wZScsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5wcm9wZXJ0eXNjb3BlJykpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VwZGF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdQcm9wZXJ0eVNjb3BlUHJvcGVydHknLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0ncHJvcGVydHlzY29wZXByb3BlcnR5aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ3Byb3BlcnR5U2NvcGUnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdwcm9wZXJ0eScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2RhdGUnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9hY3Rpb24nLCBtb2RlbHMuQ2hhckZpZWxkKGNob2ljZXM9WygnYycsICdjJyksICgndScsICd1JyksICgnZCcsICdkJyldLCBtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnUHJvcGVydHlTY29wZVByb3BlcnR5SGlzdG9yeVJlY29yZCcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKIyAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKIyAgICAgICAgICAgIG1vZGVsX25hbWU9J2RpdmlzaW9uJywKIyAgICAgICAgICAgIG5hbWU9J2NyZWF0ZWRCeScsCiMgICAgICAgICksCiMgICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiMgICAgICAgICAgICBtb2RlbF9uYW1lPSdkaXZpc2lvbicsCiMgICAgICAgICAgICBuYW1lPSdvcmdhbml6YXRpb24nLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nZGl2aXNpb24nLAojICAgICAgICAgICAgbmFtZT0ncmVzcG9uc2libGUnLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nZGl2aXNpb24nLAojICAgICAgICAgICAgbmFtZT0ndXBkYXRlZEJ5JywKIyAgICAgICAgKSwKIyAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKIyAgICAgICAgICAgIG1vZGVsX25hbWU9J2RpdmlzaW9uX2V4ZWN1dG9yc19tYW55JywKIyAgICAgICAgICAgIG5hbWU9J0RpdmlzaW9uX2xlZnRfaWQnLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nZGl2aXNpb25fZXhlY3V0b3JzX21hbnknLAojICAgICAgICAgICAgbmFtZT0nT3JnYW5pemF0aW9uRW1wbG95ZWVfcmlnaHRfaWQnLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nZGl2aXNpb25fcHJvcGVydGllc19tYW55JywKIyAgICAgICAgICAgIG5hbWU9J0RpdmlzaW9uX2xlZnRfaWQnLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nZGl2aXNpb25fcHJvcGVydGllc19tYW55JywKIyAgICAgICAgICAgIG5hbWU9J1Byb3BlcnR5X3JpZ2h0X2lkJywKIyAgICAgICAgKSwKIyAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKIyAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlX3NwZWNpYWxpemF0aW9uc19tYW55JywKIyAgICAgICAgICAgIG5hbWU9J09yZ2FuaXphdGlvbkVtcGxveWVlX2xlZnRfaWQnLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVfc3BlY2lhbGl6YXRpb25zX21hbnknLAojICAgICAgICAgICAgbmFtZT0nVGlja2V0Q2F0ZWdvcnlDbGFzc2lmaWVyX3JpZ2h0X2lkJywKIyAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZScsCiAgICAgICAgICAgIG5hbWU9J2hhc0FsbFNwZWNpYWxpemF0aW9ucycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1GYWxzZSksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZWhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdoYXNBbGxTcGVjaWFsaXphdGlvbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGUnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VQcm9wZXJ0eVNjb3BlcycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1GYWxzZSksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGUnLAogICAgICAgICAgICBuYW1lPSd0aWNrZXRWaXNpYmlsaXR5VHlwZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoZGVmYXVsdD0nb3JnYW5pemF0aW9uJyksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGVoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2FuTWFuYWdlUHJvcGVydHlTY29wZXMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGVoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0ndGlja2V0VmlzaWJpbGl0eVR5cGUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdwcm9wZXJ0eXNjb3Blb3JnYW5pemF0aW9uZW1wbG95ZWUnLAogICAgICAgICAgICBuYW1lPSdlbXBsb3llZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0nZW1wbG95ZWUnLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEub3JnYW5pemF0aW9uZW1wbG95ZWUnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3Byb3BlcnR5c2NvcGVvcmdhbml6YXRpb25lbXBsb3llZScsCiAgICAgICAgICAgIG5hbWU9J3Byb3BlcnR5U2NvcGUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J3Byb3BlcnR5U2NvcGUnLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEucHJvcGVydHlzY29wZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ncHJvcGVydHlzY29wZW9yZ2FuaXphdGlvbmVtcGxveWVlJywKICAgICAgICAgICAgbmFtZT0ndXBkYXRlZEJ5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVzcGVjaWFsaXphdGlvbicsCiAgICAgICAgICAgIG5hbWU9J2VtcGxveWVlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoZGJfY29sdW1uPSdlbXBsb3llZScsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5vcmdhbml6YXRpb25lbXBsb3llZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVzcGVjaWFsaXphdGlvbicsCiAgICAgICAgICAgIG5hbWU9J3NwZWNpYWxpemF0aW9uJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoZGJfY29sdW1uPSdzcGVjaWFsaXphdGlvbicsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS50aWNrZXRjYXRlZ29yeWNsYXNzaWZpZXInKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlc3BlY2lhbGl6YXRpb24nLAogICAgICAgICAgICBuYW1lPSd1cGRhdGVkQnknLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VwZGF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3Byb3BlcnR5c2NvcGVwcm9wZXJ0eScsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3Byb3BlcnR5U2NvcGUnLCAncHJvcGVydHknKSwgbmFtZT0ncHJvcGVydHlfc2NvcGVfcHJvcGVydHlfdW5pcXVlX3Byb3BlcnR5U2NvcGVfYW5kX3Byb3BlcnR5JyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3Byb3BlcnR5c2NvcGVvcmdhbml6YXRpb25lbXBsb3llZScsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3Byb3BlcnR5U2NvcGUnLCAnZW1wbG95ZWUnKSwgbmFtZT0ncHJvcGVydHlfc2NvcGVfb3JnYW5pemF0aW9uX2VtcGxveWVlX3VuaXF1ZV9wcm9wZXJ0eVNjb3BlX2FuZF9lbXBsb3llZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXNwZWNpYWxpemF0aW9uJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgnZW1wbG95ZWUnLCAnc3BlY2lhbGl6YXRpb24nKSwgbmFtZT0nb3JnYW5pemF0aW9uX2VtcGxveWVlX3NwZWNpYWxpemF0aW9uX3VuaXF1ZV9lbXBsb3llZV9hbmRfc3BlY2lhbGl6YXRpb24nKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYXNzaWduZWVzY29wZScsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3VzZXInLCAndGlja2V0JyksIG5hbWU9J2Fzc2lnbmVlX3Njb3BlX3VuaXF1ZV91c2VyX2FuZF90aWNrZXQnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuRGVsZXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlX3NwZWNpYWxpemF0aW9uc19tYW55JywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuRGVsZXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2RpdmlzaW9uX3Byb3BlcnRpZXNfbWFueScsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkRlbGV0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdkaXZpc2lvbl9leGVjdXRvcnNfbWFueScsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkRlbGV0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdkaXZpc2lvbicsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkRlbGV0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdkaXZpc2lvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';

--
-- [CUSTOM]
--
CREATE EXTENSION if not exists pgcrypto;

--
-- Create model assigneescope
--
CREATE TABLE "AssigneeScope" ("id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "ticket" uuid NOT NULL, "updatedBy" uuid NULL, "user" uuid NOT NULL);
--
-- Create model assigneescopehistoryrecord
--
CREATE TABLE "AssigneeScopeHistoryRecord" ("user" uuid NULL, "ticket" uuid NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Create model organizationemployeespecialization
--
CREATE TABLE "OrganizationEmployeeSpecialization" ("id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL);
--
-- Create model organizationemployeespecializationhistoryrecord
--
CREATE TABLE "OrganizationEmployeeSpecializationHistoryRecord" ("employee" uuid NULL, "specialization" uuid NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Create model propertyscope
--
CREATE TABLE "PropertyScope" ("name" text NOT NULL, "hasAllProperties" boolean NOT NULL, "hasAllEmployees" boolean NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "organization" uuid NOT NULL, "updatedBy" uuid NULL);
--
-- Create model propertyscopehistoryrecord
--
CREATE TABLE "PropertyScopeHistoryRecord" ("name" text NULL, "organization" uuid NULL, "hasAllProperties" boolean NULL, "hasAllEmployees" boolean NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Create model propertyscopeorganizationemployee
--
CREATE TABLE "PropertyScopeOrganizationEmployee" ("id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL);
--
-- Create model propertyscopeorganizationemployeehistoryrecord
--
CREATE TABLE "PropertyScopeOrganizationEmployeeHistoryRecord" ("propertyScope" uuid NULL, "employee" uuid NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Create model propertyscopeproperty
--
CREATE TABLE "PropertyScopeProperty" ("id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "property" uuid NOT NULL, "propertyScope" uuid NOT NULL, "updatedBy" uuid NULL);
--
-- Create model propertyscopepropertyhistoryrecord
--
CREATE TABLE "PropertyScopePropertyHistoryRecord" ("propertyScope" uuid NULL, "property" uuid NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field hasAllSpecializations to organizationemployee
--
ALTER TABLE "OrganizationEmployee" ADD COLUMN "hasAllSpecializations" boolean DEFAULT false NOT NULL;
ALTER TABLE "OrganizationEmployee" ALTER COLUMN "hasAllSpecializations" DROP DEFAULT;
--
-- Add field hasAllSpecializations to organizationemployeehistoryrecord
--
ALTER TABLE "OrganizationEmployeeHistoryRecord" ADD COLUMN "hasAllSpecializations" boolean NULL;
--
-- Add field canManagePropertyScopes to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" ADD COLUMN "canManagePropertyScopes" boolean DEFAULT false NOT NULL;
ALTER TABLE "OrganizationEmployeeRole" ALTER COLUMN "canManagePropertyScopes" DROP DEFAULT;
--
-- Add field ticketVisibilityType to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" ADD COLUMN "ticketVisibilityType" text DEFAULT 'organization' NOT NULL;
ALTER TABLE "OrganizationEmployeeRole" ALTER COLUMN "ticketVisibilityType" DROP DEFAULT;
--
-- Add field canManagePropertyScopes to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" ADD COLUMN "canManagePropertyScopes" boolean NULL;
--
-- Add field ticketVisibilityType to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" ADD COLUMN "ticketVisibilityType" text NULL;
--
-- Add field employee to propertyscopeorganizationemployee
--
ALTER TABLE "PropertyScopeOrganizationEmployee" ADD COLUMN "employee" uuid NOT NULL CONSTRAINT "PropertyScopeOrganiz_employee_118907dc_fk_Organizat" REFERENCES "OrganizationEmployee"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "PropertyScopeOrganiz_employee_118907dc_fk_Organizat" IMMEDIATE;
--
-- Add field propertyScope to propertyscopeorganizationemployee
--
ALTER TABLE "PropertyScopeOrganizationEmployee" ADD COLUMN "propertyScope" uuid NOT NULL CONSTRAINT "PropertyScopeOrganiz_propertyScope_076ec80d_fk_PropertyS" REFERENCES "PropertyScope"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "PropertyScopeOrganiz_propertyScope_076ec80d_fk_PropertyS" IMMEDIATE;
--
-- Add field updatedBy to propertyscopeorganizationemployee
--
ALTER TABLE "PropertyScopeOrganizationEmployee" ADD COLUMN "updatedBy" uuid NULL CONSTRAINT "PropertyScopeOrganizationEmployee_updatedBy_6914815c_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "PropertyScopeOrganizationEmployee_updatedBy_6914815c_fk_User_id" IMMEDIATE;
--
-- Add field employee to organizationemployeespecialization
--
ALTER TABLE "OrganizationEmployeeSpecialization" ADD COLUMN "employee" uuid NOT NULL CONSTRAINT "OrganizationEmployee_employee_28b84077_fk_Organizat" REFERENCES "OrganizationEmployee"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "OrganizationEmployee_employee_28b84077_fk_Organizat" IMMEDIATE;
--
-- Add field specialization to organizationemployeespecialization
--
ALTER TABLE "OrganizationEmployeeSpecialization" ADD COLUMN "specialization" uuid NOT NULL CONSTRAINT "OrganizationEmployee_specialization_9be30a04_fk_TicketCat" REFERENCES "TicketCategoryClassifier"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "OrganizationEmployee_specialization_9be30a04_fk_TicketCat" IMMEDIATE;
--
-- Add field updatedBy to organizationemployeespecialization
--
ALTER TABLE "OrganizationEmployeeSpecialization" ADD COLUMN "updatedBy" uuid NULL CONSTRAINT "OrganizationEmployeeS_updatedBy_273238b6_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "OrganizationEmployeeS_updatedBy_273238b6_fk_User_id" IMMEDIATE;
--
-- Create constraint property_scope_property_unique_propertyScope_and_property on model propertyscopeproperty
--
CREATE UNIQUE INDEX "property_scope_property_unique_propertyScope_and_property" ON "PropertyScopeProperty" ("propertyScope", "property") WHERE "deletedAt" IS NULL;
--
-- Create constraint property_scope_organization_employee_unique_propertyScope_and_employee on model propertyscopeorganizationemployee
--
CREATE UNIQUE INDEX "property_scope_organization_employee_unique_propertyScope_and_employee" ON "PropertyScopeOrganizationEmployee" ("propertyScope", "employee") WHERE "deletedAt" IS NULL;
--
-- Create constraint organization_employee_specialization_unique_employee_and_specialization on model organizationemployeespecialization
--
CREATE UNIQUE INDEX "organization_employee_specialization_unique_employee_and_specialization" ON "OrganizationEmployeeSpecialization" ("employee", "specialization") WHERE "deletedAt" IS NULL;
--
-- Create constraint assignee_scope_unique_user_and_ticket on model assigneescope
--
CREATE UNIQUE INDEX "assignee_scope_unique_user_and_ticket" ON "AssigneeScope" ("user", "ticket") WHERE "deletedAt" IS NULL;


--
-- [CUSTOM] Move data from "OrganizationEmployee_specializations_many" to "OrganizationEmployeeSpecialization"
--
INSERT INTO "OrganizationEmployeeSpecialization" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "employee", "specialization")
SELECT gen_random_uuid(), 1, 1, '{"dv": 1, "fingerprint": "migration"}'::json, now(), now(), specs."OrganizationEmployee_left_id", specs."TicketCategoryClassifier_right_id"
FROM "OrganizationEmployee_specializations_many" as specs;

--
-- [CUSTOM] Move data from Division to PropertyScope
--
INSERT INTO "PropertyScope" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "createdBy", "updatedBy", "deletedAt", "name", "organization", "hasAllProperties", "hasAllEmployees")
SELECT "id", "dv", "v", "sender", "createdAt", "updatedAt", "createdBy", "updatedBy", "deletedAt", "name", "organization", false, false
FROM "Division" WHERE id NOT IN (SELECT id FROM "PropertyScope");

--
-- [CUSTOM] Move data from Division_properties_many to PropertyScopeProperty
--
INSERT INTO "PropertyScopeProperty" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "propertyScope", "property")
SELECT gen_random_uuid(), 1, 1, '{"dv": 1, "fingerprint": "migration"}'::json, now(), now(), "Division_left_id", "Property_right_id"
FROM "Division_properties_many" WHERE (SELECT count(*) FROM "PropertyScopeProperty" WHERE "propertyScope" = "Division_left_id" AND "property" = "Property_right_id") = 0;

--
-- [CUSTOM] Move data from Division_executors_many (not responsible employees) to PropertyScopeOrganizationEmployee
--
INSERT INTO "PropertyScopeOrganizationEmployee" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "propertyScope", "employee")
SELECT gen_random_uuid(), 1, 1, '{"dv": 1, "fingerprint": "migration"}'::json, now(), now(), t."Division_left_id", t."OrganizationEmployee_right_id"
FROM (
    SELECT * FROM "Division_executors_many"
    WHERE "OrganizationEmployee_right_id" NOT IN (SELECT "responsible" FROM "Division")
    AND (SELECT count(*) FROM "PropertyScopeOrganizationEmployee" WHERE "propertyScope" = "Division_left_id" AND "employee" = "OrganizationEmployee_right_id") = 0
    ) as t;

--
-- [CUSTOM] Move data from Division.responsible to PropertyScopeOrganizationEmployee
--
INSERT INTO "PropertyScopeOrganizationEmployee" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "propertyScope", "employee")
SELECT gen_random_uuid(), 1, 1, '{"dv": 1, "fingerprint": "migration"}'::json, now(), now(), "Division"."id",  "Division"."responsible"
FROM "Division" WHERE (SELECT count(*) FROM "PropertyScopeOrganizationEmployee" WHERE "propertyScope" = "Division".id AND "employee" = "responsible") = 0;


--
-- Delete model organizationemployee_specializations_many
--
DROP TABLE "OrganizationEmployee_specializations_many" CASCADE;
--
-- Delete model division_properties_many
--
DROP TABLE "Division_properties_many" CASCADE;
--
-- Delete model division_executors_many
--
DROP TABLE "Division_executors_many" CASCADE;
--
-- Delete model division
--
DROP TABLE "Division" CASCADE;
--
-- Delete model divisionhistoryrecord
--
DROP TABLE "DivisionHistoryRecord" CASCADE;
ALTER TABLE "AssigneeScope" ADD CONSTRAINT "AssigneeScope_createdBy_4605faa4_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AssigneeScope" ADD CONSTRAINT "AssigneeScope_ticket_e8a38c15_fk_Ticket_id" FOREIGN KEY ("ticket") REFERENCES "Ticket" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AssigneeScope" ADD CONSTRAINT "AssigneeScope_updatedBy_3e164999_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AssigneeScope" ADD CONSTRAINT "AssigneeScope_user_30b38706_fk_User_id" FOREIGN KEY ("user") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "AssigneeScope_createdAt_f0087a85" ON "AssigneeScope" ("createdAt");
CREATE INDEX "AssigneeScope_updatedAt_fd0fda5f" ON "AssigneeScope" ("updatedAt");
CREATE INDEX "AssigneeScope_deletedAt_521af26a" ON "AssigneeScope" ("deletedAt");
CREATE INDEX "AssigneeScope_createdBy_4605faa4" ON "AssigneeScope" ("createdBy");
CREATE INDEX "AssigneeScope_ticket_e8a38c15" ON "AssigneeScope" ("ticket");
CREATE INDEX "AssigneeScope_updatedBy_3e164999" ON "AssigneeScope" ("updatedBy");
CREATE INDEX "AssigneeScope_user_30b38706" ON "AssigneeScope" ("user");
CREATE INDEX "AssigneeScopeHistoryRecord_history_id_f722994a" ON "AssigneeScopeHistoryRecord" ("history_id");
ALTER TABLE "OrganizationEmployeeSpecialization" ADD CONSTRAINT "OrganizationEmployeeS_createdBy_cffba65e_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "OrganizationEmployeeSpecialization_createdAt_2ae20681" ON "OrganizationEmployeeSpecialization" ("createdAt");
CREATE INDEX "OrganizationEmployeeSpecialization_updatedAt_89f07260" ON "OrganizationEmployeeSpecialization" ("updatedAt");
CREATE INDEX "OrganizationEmployeeSpecialization_deletedAt_54693db7" ON "OrganizationEmployeeSpecialization" ("deletedAt");
CREATE INDEX "OrganizationEmployeeSpecialization_createdBy_cffba65e" ON "OrganizationEmployeeSpecialization" ("createdBy");
CREATE INDEX "OrganizationEmployeeSpecia_history_id_2c49c804" ON "OrganizationEmployeeSpecializationHistoryRecord" ("history_id");
ALTER TABLE "PropertyScope" ADD CONSTRAINT "PropertyScope_createdBy_3fb69231_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PropertyScope" ADD CONSTRAINT "PropertyScope_organization_329d9730_fk_Organization_id" FOREIGN KEY ("organization") REFERENCES "Organization" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PropertyScope" ADD CONSTRAINT "PropertyScope_updatedBy_1b952ecf_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "PropertyScope_createdAt_16cb5372" ON "PropertyScope" ("createdAt");
CREATE INDEX "PropertyScope_updatedAt_56f8ae59" ON "PropertyScope" ("updatedAt");
CREATE INDEX "PropertyScope_deletedAt_a961c518" ON "PropertyScope" ("deletedAt");
CREATE INDEX "PropertyScope_createdBy_3fb69231" ON "PropertyScope" ("createdBy");
CREATE INDEX "PropertyScope_organization_329d9730" ON "PropertyScope" ("organization");
CREATE INDEX "PropertyScope_updatedBy_1b952ecf" ON "PropertyScope" ("updatedBy");
CREATE INDEX "PropertyScopeHistoryRecord_history_id_ed94ad04" ON "PropertyScopeHistoryRecord" ("history_id");
ALTER TABLE "PropertyScopeOrganizationEmployee" ADD CONSTRAINT "PropertyScopeOrganizationEmployee_createdBy_c1b8bfe8_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "PropertyScopeOrganizationEmployee_createdAt_c7985f5b" ON "PropertyScopeOrganizationEmployee" ("createdAt");
CREATE INDEX "PropertyScopeOrganizationEmployee_updatedAt_e953bf13" ON "PropertyScopeOrganizationEmployee" ("updatedAt");
CREATE INDEX "PropertyScopeOrganizationEmployee_deletedAt_4276a425" ON "PropertyScopeOrganizationEmployee" ("deletedAt");
CREATE INDEX "PropertyScopeOrganizationEmployee_createdBy_c1b8bfe8" ON "PropertyScopeOrganizationEmployee" ("createdBy");
CREATE INDEX "PropertyScopeOrganizationE_history_id_16e45b61" ON "PropertyScopeOrganizationEmployeeHistoryRecord" ("history_id");
ALTER TABLE "PropertyScopeProperty" ADD CONSTRAINT "PropertyScopeProperty_createdBy_ce29b95a_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PropertyScopeProperty" ADD CONSTRAINT "PropertyScopeProperty_property_74dbfc06_fk_Property_id" FOREIGN KEY ("property") REFERENCES "Property" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PropertyScopeProperty" ADD CONSTRAINT "PropertyScopePropert_propertyScope_0938a3e1_fk_PropertyS" FOREIGN KEY ("propertyScope") REFERENCES "PropertyScope" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PropertyScopeProperty" ADD CONSTRAINT "PropertyScopeProperty_updatedBy_91fcf616_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "PropertyScopeProperty_createdAt_bbb39a06" ON "PropertyScopeProperty" ("createdAt");
CREATE INDEX "PropertyScopeProperty_updatedAt_904a0d96" ON "PropertyScopeProperty" ("updatedAt");
CREATE INDEX "PropertyScopeProperty_deletedAt_07315922" ON "PropertyScopeProperty" ("deletedAt");
CREATE INDEX "PropertyScopeProperty_createdBy_ce29b95a" ON "PropertyScopeProperty" ("createdBy");
CREATE INDEX "PropertyScopeProperty_property_74dbfc06" ON "PropertyScopeProperty" ("property");
CREATE INDEX "PropertyScopeProperty_propertyScope_0938a3e1" ON "PropertyScopeProperty" ("propertyScope");
CREATE INDEX "PropertyScopeProperty_updatedBy_91fcf616" ON "PropertyScopeProperty" ("updatedBy");
CREATE INDEX "PropertyScopePropertyHistoryRecord_history_id_cdae15fe" ON "PropertyScopePropertyHistoryRecord" ("history_id");
CREATE INDEX "PropertyScopeOrganizationEmployee_employee_118907dc" ON "PropertyScopeOrganizationEmployee" ("employee");
CREATE INDEX "PropertyScopeOrganizationEmployee_propertyScope_076ec80d" ON "PropertyScopeOrganizationEmployee" ("propertyScope");
CREATE INDEX "PropertyScopeOrganizationEmployee_updatedBy_6914815c" ON "PropertyScopeOrganizationEmployee" ("updatedBy");
CREATE INDEX "OrganizationEmployeeSpecialization_employee_28b84077" ON "OrganizationEmployeeSpecialization" ("employee");
CREATE INDEX "OrganizationEmployeeSpecialization_specialization_9be30a04" ON "OrganizationEmployeeSpecialization" ("specialization");
CREATE INDEX "OrganizationEmployeeSpecialization_updatedBy_273238b6" ON "OrganizationEmployeeSpecialization" ("updatedBy");

-- 
-- [CUSTOM] Set all specializations to employees who has not any specialization 
--
UPDATE "OrganizationEmployee" as e
SET "hasAllSpecializations" = true
WHERE "hasAllSpecializations" = false AND
      e."deletedAt" is null AND
      (SELECT count(*) FROM "OrganizationEmployeeSpecialization" WHERE "employee" = e."id" AND "OrganizationEmployeeSpecialization"."deletedAt" is null) = 0;

--
-- [CUSTOM] Create default PropertyScope for all organizations
--
INSERT INTO "PropertyScope" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "createdBy", "updatedBy", "deletedAt", "name", "organization", "hasAllProperties", "hasAllEmployees")
SELECT "id", "dv", "v", "sender", "createdAt", "updatedAt", "createdBy", "updatedBy", "deletedAt", 'pages.condo.settings.propertyScope.default.name', "id", true, true
FROM "Organization"
WHERE "deletedAt" is null;

--
-- [CUSTOM] Create AssigneeScope for already assigned as assignee users
--
INSERT INTO "AssigneeScope" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "user", "ticket")
SELECT gen_random_uuid(), "dv", "v", "sender", "createdAt", "updatedAt", "assignee", "id"
FROM "Ticket" as t
WHERE "assignee" is not null AND
      (SELECT count(*) FROM "AssigneeScope" as s WHERE s."user" = t.assignee AND s."ticket" = t."id" AND s."deletedAt" is null) = 0
;

--
-- [CUSTOM] Create AssigneeScope for already assigned as executor users
--
INSERT INTO "AssigneeScope" ("id", "dv", "v", "sender", "createdAt", "updatedAt", "user", "ticket")
SELECT gen_random_uuid(), "dv", "v", "sender", "createdAt", "updatedAt", "executor", "id"
FROM "Ticket" as t
WHERE "executor" is not null AND
      (SELECT count(*) FROM "AssigneeScope" as s WHERE s."user" = t."executor" AND s."ticket" = t."id" AND s."deletedAt" is null) = 0
;

--
-- [CUSTOM] Added Contractor role
--
INSERT INTO "OrganizationEmployeeRole" (
    id, dv, v, sender, organization, "createdAt", "updatedAt",
    name,
    description,
    "canManageTickets",
    "canManageTicketComments",
    "canShareTickets",
    "canBeAssignedAsExecutor",
    "canBeAssignedAsResponsible",
    "canManageContacts",
    "canManageEmployees",
    "canManageRoles",
    "canManageIntegrations",
    "canManageProperties",
    "canManageContactRoles",
    "canManageDivisions",
    "canManageMeters",
    "canManageMeterReadings",
    "canReadPayments",
    "canReadBillingReceipts",
    "canReadEntitiesOnlyInScopeOfDivision",
    "canManageTicketPropertyHints",
    "canManagePropertyScopes",
    "canManageOrganization",
    "ticketVisibilityType"
)
SELECT
    gen_random_uuid(), 1, v, '{"dv": 1, "fingerprint": "migration"}'::json, org.id, now(), now(),
    'employee.role.Contractor.name',
    'employee.role.Contractor.description',
    true,
    true,
    true,
    true,
    true,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    'assigned'
FROM "Organization" AS org;

--
-- [CUSTOM] Added canManagePropertyScopes to administrator role
--
UPDATE "OrganizationEmployeeRole"
SET "canManagePropertyScopes" = true
WHERE name = 'employee.role.Administrator.name';

--
-- [CUSTOM] Set ticketVisibilityType to existing roles
--
UPDATE "OrganizationEmployeeRole" 
SET "ticketVisibilityType" = 'organization' 
WHERE "name" = 'employee.role.Administrator';
        
UPDATE "OrganizationEmployeeRole" 
SET "ticketVisibilityType" = 'property'
WHERE "name" = ANY(ARRAY['employee.role.Dispatcher.name', 'employee.role.Manager.name']);

UPDATE "OrganizationEmployeeRole" 
SET "ticketVisibilityType" = 'propertyAndSpecialization'
WHERE "name" = ANY(ARRAY['employee.role.Foreman.name', 'employee.role.Technician.name']);

--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Delete model divisionhistoryrecord
--
CREATE TABLE "DivisionHistoryRecord" ("dv" integer NULL, "sender" jsonb NULL, "name" text NULL, "organization" uuid NULL, "responsible" uuid NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Delete model division
--
CREATE TABLE "Division" ("dv" integer NOT NULL, "sender" jsonb NOT NULL, "name" text NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "createdBy" uuid NULL, "organization" uuid NOT NULL, "responsible" uuid NOT NULL, "updatedBy" uuid NULL);
--
-- Delete model division_executors_many
--
CREATE TABLE "Division_executors_many" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "Division_left_id" uuid NOT NULL, "OrganizationEmployee_right_id" uuid NOT NULL);
--
-- Delete model division_properties_many
--
CREATE TABLE "Division_properties_many" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "Division_left_id" uuid NOT NULL, "Property_right_id" uuid NOT NULL);
--
-- Delete model organizationemployee_specializations_many
--
CREATE TABLE "OrganizationEmployee_specializations_many" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "OrganizationEmployee_left_id" uuid NOT NULL, "TicketCategoryClassifier_right_id" uuid NOT NULL);
--
-- Create constraint assignee_scope_unique_user_and_ticket on model assigneescope
--
DROP INDEX IF EXISTS "assignee_scope_unique_user_and_ticket";
--
-- Create constraint organization_employee_specialization_unique_employee_and_specialization on model organizationemployeespecialization
--
DROP INDEX IF EXISTS "organization_employee_specialization_unique_employee_and_specialization";
--
-- Create constraint property_scope_organization_employee_unique_propertyScope_and_employee on model propertyscopeorganizationemployee
--
DROP INDEX IF EXISTS "property_scope_organization_employee_unique_propertyScope_and_employee";
--
-- Create constraint property_scope_property_unique_propertyScope_and_property on model propertyscopeproperty
--
DROP INDEX IF EXISTS "property_scope_property_unique_propertyScope_and_property";
--
-- Add field updatedBy to organizationemployeespecialization
--
ALTER TABLE "OrganizationEmployeeSpecialization" DROP COLUMN "updatedBy" CASCADE;
--
-- Add field specialization to organizationemployeespecialization
--
ALTER TABLE "OrganizationEmployeeSpecialization" DROP COLUMN "specialization" CASCADE;
--
-- Add field employee to organizationemployeespecialization
--
ALTER TABLE "OrganizationEmployeeSpecialization" DROP COLUMN "employee" CASCADE;
--
-- Add field updatedBy to propertyscopeorganizationemployee
--
ALTER TABLE "PropertyScopeOrganizationEmployee" DROP COLUMN "updatedBy" CASCADE;
--
-- Add field propertyScope to propertyscopeorganizationemployee
--
ALTER TABLE "PropertyScopeOrganizationEmployee" DROP COLUMN "propertyScope" CASCADE;
--
-- Add field employee to propertyscopeorganizationemployee
--
ALTER TABLE "PropertyScopeOrganizationEmployee" DROP COLUMN "employee" CASCADE;
--
-- Add field ticketVisibilityType to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" DROP COLUMN "ticketVisibilityType" CASCADE;
--
-- Add field canManagePropertyScopes to organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" DROP COLUMN "canManagePropertyScopes" CASCADE;
--
-- Add field ticketVisibilityType to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" DROP COLUMN "ticketVisibilityType" CASCADE;
--
-- Add field canManagePropertyScopes to organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" DROP COLUMN "canManagePropertyScopes" CASCADE;
--
-- Add field hasAllSpecializations to organizationemployeehistoryrecord
--
ALTER TABLE "OrganizationEmployeeHistoryRecord" DROP COLUMN "hasAllSpecializations" CASCADE;
--
-- Add field hasAllSpecializations to organizationemployee
--
ALTER TABLE "OrganizationEmployee" DROP COLUMN "hasAllSpecializations" CASCADE;
--
-- Create model propertyscopepropertyhistoryrecord
--
DROP TABLE "PropertyScopePropertyHistoryRecord" CASCADE;
--
-- Create model propertyscopeproperty
--
DROP TABLE "PropertyScopeProperty" CASCADE;
--
-- Create model propertyscopeorganizationemployeehistoryrecord
--
DROP TABLE "PropertyScopeOrganizationEmployeeHistoryRecord" CASCADE;
--
-- Create model propertyscopeorganizationemployee
--
DROP TABLE "PropertyScopeOrganizationEmployee" CASCADE;
--
-- Create model propertyscopehistoryrecord
--
DROP TABLE "PropertyScopeHistoryRecord" CASCADE;
--
-- Create model propertyscope
--
DROP TABLE "PropertyScope" CASCADE;
--
-- Create model organizationemployeespecializationhistoryrecord
--
DROP TABLE "OrganizationEmployeeSpecializationHistoryRecord" CASCADE;
--
-- Create model organizationemployeespecialization
--
DROP TABLE "OrganizationEmployeeSpecialization" CASCADE;
--
-- Create model assigneescopehistoryrecord
--
DROP TABLE "AssigneeScopeHistoryRecord" CASCADE;
--
-- Create model assigneescope
--
DROP TABLE "AssigneeScope" CASCADE;
CREATE INDEX "DivisionHistoryRecord_history_id_1aa20471" ON "DivisionHistoryRecord" ("history_id");
ALTER TABLE "Division" ADD CONSTRAINT "Division_createdBy_1de184f0_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Division" ADD CONSTRAINT "Division_organization_12c63234_fk_Organization_id" FOREIGN KEY ("organization") REFERENCES "Organization" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Division" ADD CONSTRAINT "Division_responsible_eed68a68_fk_OrganizationEmployee_id" FOREIGN KEY ("responsible") REFERENCES "OrganizationEmployee" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Division" ADD CONSTRAINT "Division_updatedBy_6ebd4c94_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Division_createdAt_e7ed3456" ON "Division" ("createdAt");
CREATE INDEX "Division_updatedAt_2af80235" ON "Division" ("updatedAt");
CREATE INDEX "Division_deletedAt_a5c80e2a" ON "Division" ("deletedAt");
CREATE INDEX "Division_createdBy_1de184f0" ON "Division" ("createdBy");
CREATE INDEX "Division_organization_12c63234" ON "Division" ("organization");
CREATE INDEX "Division_responsible_eed68a68" ON "Division" ("responsible");
CREATE INDEX "Division_updatedBy_6ebd4c94" ON "Division" ("updatedBy");
ALTER TABLE "Division_executors_many" ADD CONSTRAINT "Division_executors_m_Division_left_id_b50a2677_fk_Division_" FOREIGN KEY ("Division_left_id") REFERENCES "Division" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Division_executors_many" ADD CONSTRAINT "Division_executors_m_OrganizationEmployee_67cbc5c6_fk_Organizat" FOREIGN KEY ("OrganizationEmployee_right_id") REFERENCES "OrganizationEmployee" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Division_executors_many_Division_left_id_b50a2677" ON "Division_executors_many" ("Division_left_id");
CREATE INDEX "Division_executors_many_OrganizationEmployee_right_id_67cbc5c6" ON "Division_executors_many" ("OrganizationEmployee_right_id");
ALTER TABLE "Division_properties_many" ADD CONSTRAINT "Division_properties__Division_left_id_32c0aab5_fk_Division_" FOREIGN KEY ("Division_left_id") REFERENCES "Division" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Division_properties_many" ADD CONSTRAINT "Division_properties__Property_right_id_9e298cb9_fk_Property_" FOREIGN KEY ("Property_right_id") REFERENCES "Property" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Division_properties_many_Division_left_id_32c0aab5" ON "Division_properties_many" ("Division_left_id");
CREATE INDEX "Division_properties_many_Property_right_id_9e298cb9" ON "Division_properties_many" ("Property_right_id");
ALTER TABLE "OrganizationEmployee_specializations_many" ADD CONSTRAINT "OrganizationEmployee_OrganizationEmployee_cb80e37b_fk_Organizat" FOREIGN KEY ("OrganizationEmployee_left_id") REFERENCES "OrganizationEmployee" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "OrganizationEmployee_specializations_many" ADD CONSTRAINT "OrganizationEmployee_TicketCategoryClassi_ee1eb7bd_fk_TicketCat" FOREIGN KEY ("TicketCategoryClassifier_right_id") REFERENCES "TicketCategoryClassifier" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "OrganizationEmployee_speci_OrganizationEmployee_left__cb80e37b" ON "OrganizationEmployee_specializations_many" ("OrganizationEmployee_left_id");
CREATE INDEX "OrganizationEmployee_speci_TicketCategoryClassifier_r_ee1eb7bd" ON "OrganizationEmployee_specializations_many" ("TicketCategoryClassifier_right_id");
COMMIT;

    `)
}
