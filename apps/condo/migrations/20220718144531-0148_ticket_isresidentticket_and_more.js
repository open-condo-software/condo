// auto generated by kmigrator
// KMIGRATOR:0148_ticket_isresidentticket_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMCBvbiAyMDIyLTA3LTE4IDA5OjQ1Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMTQ3X3RpY2tldF9zZWN0aW9udHlwZV90aWNrZXRjaGFuZ2Vfc2VjdGlvbnR5cGVmcm9tX2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXQnLAogICAgICAgICAgICBuYW1lPSdpc1Jlc2lkZW50VGlja2V0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PUZhbHNlKSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2lzUmVzaWRlbnRUaWNrZXRGcm9tJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0naXNSZXNpZGVudFRpY2tldFRvJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2lzUmVzaWRlbnRUaWNrZXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field isResidentTicket to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "isResidentTicket" boolean DEFAULT false NOT NULL;
ALTER TABLE "Ticket" ALTER COLUMN "isResidentTicket" DROP DEFAULT;
--
-- Add field isResidentTicketFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "isResidentTicketFrom" boolean NULL;
--
-- Add field isResidentTicketTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "isResidentTicketTo" boolean NULL;
--
-- Add field isResidentTicket to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "isResidentTicket" boolean NULL;

--
UPDATE "Ticket"
SET "isResidentTicket" = true
WHERE "contact" is not null;
--
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field isResidentTicket to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "isResidentTicket" CASCADE;
--
-- Add field isResidentTicketTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "isResidentTicketTo" CASCADE;
--
-- Add field isResidentTicketFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "isResidentTicketFrom" CASCADE;
--
-- Add field isResidentTicket to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "isResidentTicket" CASCADE;
COMMIT;

    `)
}
