// auto generated by kmigrator
// KMIGRATOR:0077_auto_20211108_0900:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi44IG9uIDIwMjEtMTEtMDggMDk6MDAKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwNzZfYXV0b18yMDIxMTEwMV8xMjQ4JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbmFtZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbicsCiAgICAgICAgICAgIG9sZF9uYW1lPSdmZWVDYWxjdWxhdGlvblVybCcsCiAgICAgICAgICAgIG5ld19uYW1lPSdob3N0VXJsJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVuYW1lRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG9sZF9uYW1lPSdmZWVDYWxjdWxhdGlvblVybCcsCiAgICAgICAgICAgIG5ld19uYW1lPSdob3N0VXJsJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uJywKICAgICAgICAgICAgbmFtZT0ncGF5bWVudFVybCcsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdwYXltZW50VXJsJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3BheW1lbnQnLAogICAgICAgICAgICBuYW1lPSdvcmdhbml6YXRpb24nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J29yZ2FuaXphdGlvbicsIGRlZmF1bHQ9MSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uUFJPVEVDVCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLm9yZ2FuaXphdGlvbicpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ncGF5bWVudCcsCiAgICAgICAgICAgIG5hbWU9J3BlcmlvZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EYXRlRmllbGQoZGVmYXVsdD0nMjAyMS0xMS0wMScpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ncGF5bWVudGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdvcmdhbml6YXRpb24nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdwYXltZW50aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J3BlcmlvZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EYXRlRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ncGF5bWVudCcsCiAgICAgICAgICAgIG5hbWU9J2FkdmFuY2VkQXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdwYXltZW50JywKICAgICAgICAgICAgbmFtZT0nY29udGV4dCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY29udGV4dCcsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uUFJPVEVDVCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmFjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdwYXltZW50JywKICAgICAgICAgICAgbmFtZT0nZnJvemVuUmVjZWlwdCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ncGF5bWVudCcsCiAgICAgICAgICAgIG5hbWU9J3JlY2VpcHQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3JlY2VpcHQnLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlBST1RFQ1QsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5iaWxsaW5ncmVjZWlwdCcpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Rename field feeCalculationUrl on acquiringintegration to hostUrl
--
ALTER TABLE "AcquiringIntegration" RENAME COLUMN "feeCalculationUrl" TO "hostUrl";
--
-- Rename field feeCalculationUrl on acquiringintegrationhistoryrecord to hostUrl
--
ALTER TABLE "AcquiringIntegrationHistoryRecord" RENAME COLUMN "feeCalculationUrl" TO "hostUrl";
--
-- Remove field paymentUrl from acquiringintegration
--
ALTER TABLE "AcquiringIntegration" DROP COLUMN "paymentUrl" CASCADE;
--
-- Remove field paymentUrl from acquiringintegrationhistoryrecord
--
ALTER TABLE "AcquiringIntegrationHistoryRecord" DROP COLUMN "paymentUrl" CASCADE;
--
-- Add field organization to payment
--
ALTER TABLE "Payment" ADD COLUMN "organization" uuid DEFAULT '00000000-0000-0000-0000-000000000001'::uuid NOT NULL CONSTRAINT "Payment_organization_64e36db3_fk_Organization_id" REFERENCES "Organization"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Payment_organization_64e36db3_fk_Organization_id" IMMEDIATE;
ALTER TABLE "Payment" ALTER COLUMN "organization" DROP DEFAULT;
--
-- Add field period to payment
--
ALTER TABLE "Payment" ADD COLUMN "period" date DEFAULT '2021-11-01'::date NOT NULL;
ALTER TABLE "Payment" ALTER COLUMN "period" DROP DEFAULT;
--
-- Add field organization to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" ADD COLUMN "organization" uuid NULL;
--
-- Add field period to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" ADD COLUMN "period" date NULL;
--
-- Alter field advancedAt on payment
--
ALTER TABLE "Payment" ALTER COLUMN "advancedAt" DROP NOT NULL;
--
-- Alter field context on payment
--
SET CONSTRAINTS "Payment_context_cd5413bf_fk_AcquiringIntegrationContext_id" IMMEDIATE; ALTER TABLE "Payment" DROP CONSTRAINT "Payment_context_cd5413bf_fk_AcquiringIntegrationContext_id";
ALTER TABLE "Payment" ALTER COLUMN "context" DROP NOT NULL;
ALTER TABLE "Payment" ADD CONSTRAINT "Payment_context_cd5413bf_fk_AcquiringIntegrationContext_id" FOREIGN KEY ("context") REFERENCES "AcquiringIntegrationContext" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field frozenReceipt on payment
--
ALTER TABLE "Payment" ALTER COLUMN "frozenReceipt" DROP NOT NULL;
--
-- Alter field receipt on payment
--
SET CONSTRAINTS "Payment_receipt_38ac3560_fk_BillingReceipt_id" IMMEDIATE; ALTER TABLE "Payment" DROP CONSTRAINT "Payment_receipt_38ac3560_fk_BillingReceipt_id";
ALTER TABLE "Payment" ALTER COLUMN "receipt" DROP NOT NULL;
ALTER TABLE "Payment" ADD CONSTRAINT "Payment_receipt_38ac3560_fk_BillingReceipt_id" FOREIGN KEY ("receipt") REFERENCES "BillingReceipt" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Payment_organization_64e36db3" ON "Payment" ("organization");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field receipt on payment
--
SET CONSTRAINTS "Payment_receipt_38ac3560_fk_BillingReceipt_id" IMMEDIATE; ALTER TABLE "Payment" DROP CONSTRAINT "Payment_receipt_38ac3560_fk_BillingReceipt_id";
ALTER TABLE "Payment" ALTER COLUMN "receipt" SET NOT NULL;
ALTER TABLE "Payment" ADD CONSTRAINT "Payment_receipt_38ac3560_fk_BillingReceipt_id" FOREIGN KEY ("receipt") REFERENCES "BillingReceipt" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field frozenReceipt on payment
--
ALTER TABLE "Payment" ALTER COLUMN "frozenReceipt" SET NOT NULL;
--
-- Alter field context on payment
--
SET CONSTRAINTS "Payment_context_cd5413bf_fk_AcquiringIntegrationContext_id" IMMEDIATE; ALTER TABLE "Payment" DROP CONSTRAINT "Payment_context_cd5413bf_fk_AcquiringIntegrationContext_id";
ALTER TABLE "Payment" ALTER COLUMN "context" SET NOT NULL;
ALTER TABLE "Payment" ADD CONSTRAINT "Payment_context_cd5413bf_fk_AcquiringIntegrationContext_id" FOREIGN KEY ("context") REFERENCES "AcquiringIntegrationContext" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field advancedAt on payment
--
ALTER TABLE "Payment" ALTER COLUMN "advancedAt" SET NOT NULL;
--
-- Add field period to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" DROP COLUMN "period" CASCADE;
--
-- Add field organization to paymenthistoryrecord
--
ALTER TABLE "PaymentHistoryRecord" DROP COLUMN "organization" CASCADE;
--
-- Add field period to payment
--
ALTER TABLE "Payment" DROP COLUMN "period" CASCADE;
--
-- Add field organization to payment
--
ALTER TABLE "Payment" DROP COLUMN "organization" CASCADE;
--
-- Remove field paymentUrl from acquiringintegrationhistoryrecord
--
ALTER TABLE "AcquiringIntegrationHistoryRecord" ADD COLUMN "paymentUrl" text NULL;
--
-- Remove field paymentUrl from acquiringintegration
--
ALTER TABLE "AcquiringIntegration" ADD COLUMN "paymentUrl" text NOT NULL;
--
-- Rename field feeCalculationUrl on acquiringintegrationhistoryrecord to hostUrl
--
ALTER TABLE "AcquiringIntegrationHistoryRecord" RENAME COLUMN "hostUrl" TO "feeCalculationUrl";
--
-- Rename field feeCalculationUrl on acquiringintegration to hostUrl
--
ALTER TABLE "AcquiringIntegration" RENAME COLUMN "hostUrl" TO "feeCalculationUrl";
COMMIT;

    `)
}
