// auto generated by kmigrator
// KMIGRATOR:0498_auto_20251208_0712:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjUtMTItMDggMDc6MTIKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0OTdfdGlja2V0c291cmNlX2lzZGVmYXVsdF9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdub3RpZmljYXRpb251c2Vyc2V0dGluZycsCiAgICAgICAgICAgIG5hbWU9J3VzZXInLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VzZXInLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbnVzZXJzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuQ2hlY2tDb25zdHJhaW50KGNoZWNrPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBGYWxzZSksIG1vZGVscy5RKCgndXNlcl9faXNudWxsJywgVHJ1ZSksIG1vZGVscy5RKCgnbWVzc2FnZVR5cGVfX2lzbnVsbCcsIFRydWUpLCAoJ21lc3NhZ2VUcmFuc3BvcnRfX2lzbnVsbCcsIFRydWUpLCBfY29ubmVjdG9yPSdPUicpLCBfbmVnYXRlZD1UcnVlKSwgX2Nvbm5lY3Rvcj0nT1InKSwgbmFtZT0nZ2xvYmFsX3NldHRpbmdfcmVxdWlyZXNfbWVzc2FnZVR5cGVfYW5kX21lc3NhZ2VUcmFuc3BvcnQnKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field user on notificationusersetting
--
SET CONSTRAINTS "NotificationUserSetting_user_fd06883d_fk_User_id" IMMEDIATE; ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id";
ALTER TABLE "NotificationUserSetting" ALTER COLUMN "user" DROP NOT NULL;
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id" FOREIGN KEY ("user") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Create constraint global_setting_requires_messageType_and_messageTransport on model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "global_setting_requires_messageType_and_messageTransport" CHECK (("deletedAt" IS NOT NULL OR NOT ("user" IS NULL AND ("messageType" IS NULL OR "messageTransport" IS NULL))));
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint global_setting_requires_messageType_and_messageTransport on model notificationusersetting
--
ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "global_setting_requires_messageType_and_messageTransport";
--
-- Delete all global settings (user IS NULL) before adding NOT NULL constraint
--
DELETE FROM "NotificationUserSetting" WHERE "user" IS NULL;
--
-- Alter field user on notificationusersetting
--
SET CONSTRAINTS "NotificationUserSetting_user_fd06883d_fk_User_id" IMMEDIATE; ALTER TABLE "NotificationUserSetting" DROP CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id";
ALTER TABLE "NotificationUserSetting" ALTER COLUMN "user" SET NOT NULL;
ALTER TABLE "NotificationUserSetting" ADD CONSTRAINT "NotificationUserSetting_user_fd06883d_fk_User_id" FOREIGN KEY ("user") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
COMMIT;

    `)
}
