// auto generated by kmigrator
// KMIGRATOR:0095_auto_20220202_0949:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi43IG9uIDIwMjItMDItMDIgMDk6NDkKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwOTRfYXV0b18yMDIyMDIwMl8wNjU5JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUNvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2RldmljZScsCiAgICAgICAgICAgIG5hbWU9J2RldmljZUlkX3B1c2hUcmFuc3BvcnRfdW5pcXVlX2NvbnRleHRfZ2xvYmFsSWQnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdkZXZpY2UnLAogICAgICAgICAgICBuYW1lPSdkZXZpY2VJZCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgdW5pcXVlPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdkZXZpY2UnLAogICAgICAgICAgICBuYW1lPSdwdXNoVHJhbnNwb3J0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkNoYXJGaWVsZChibGFuaz1UcnVlLCBjaG9pY2VzPVsoJ2ZpcmViYXNlJywgJ2ZpcmViYXNlJyksICgnYXBwbGUnLCAnYXBwbGUnKSwgKCdodWF3ZWknLCAnaHVhd2VpJyldLCBtYXhfbGVuZ3RoPTUwLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove constraint deviceId_pushTransport_unique_context_globalId from model device
--
ALTER TABLE "Device" DROP CONSTRAINT "deviceId_pushTransport_unique_context_globalId";
--
-- Alter field deviceId on device
--
ALTER TABLE "Device" ADD CONSTRAINT "Device_deviceId_dcfed0de_uniq" UNIQUE ("deviceId");
CREATE INDEX "Device_deviceId_dcfed0de_like" ON "Device" ("deviceId" text_pattern_ops);
--
-- Alter field pushTransport on device
--
ALTER TABLE "Device" ALTER COLUMN "pushTransport" DROP NOT NULL;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Set default pushTransport value for all nullish instances because of NOT NULL constraint in previous version
--
UPDATE "Device" SET "pushTransport" = 'firebase' WHERE "pushTransport"IS NULL;
--
-- Alter field pushTransport on device
--
ALTER TABLE "Device" ALTER COLUMN "pushTransport" SET DEFAULT '', ALTER COLUMN "pushTransport" SET NOT NULL;
ALTER TABLE "Device" ALTER COLUMN "pushTransport" DROP DEFAULT;
--
-- Alter field deviceId on device
--
ALTER TABLE "Device" DROP CONSTRAINT "Device_deviceId_dcfed0de_uniq";
DROP INDEX IF EXISTS "Device_deviceId_dcfed0de_like";
--
-- Remove constraint deviceId_pushTransport_unique_context_globalId from model device
--
ALTER TABLE "Device" ADD CONSTRAINT "deviceId_pushTransport_unique_context_globalId" UNIQUE ("deviceId", "pushTransport");
COMMIT;

    `)
}
