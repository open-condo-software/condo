// auto generated by kmigrator
// KMIGRATOR:0267_remove_banktransaction_bank_transaction_unique_number_date_organization_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMSBvbiAyMDIzLTA1LTEwIDA1OjI5Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMjY2X3JlbW92ZV9vcmdhbml6YXRpb25fdW5pcXVlX29yZ2FuaXphdGlvbl9pbXBvcnRpZF9hbmRfaW1wb3J0cmVtb3Rlc3lzdGVtX2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUNvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2Jhbmt0cmFuc2FjdGlvbicsCiAgICAgICAgICAgIG5hbWU9J0JhbmtfdHJhbnNhY3Rpb25fdW5pcXVlX251bWJlcl9kYXRlX29yZ2FuaXphdGlvbicsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUNvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2Jhbmt0cmFuc2FjdGlvbicsCiAgICAgICAgICAgIG5hbWU9J0JhbmtfdHJhbnNhY3Rpb25fdW5pcXVlX2ltcG9ydElkX2ltcG9ydFJlbW90ZVN5c3RlbV9vcmdhbml6YXRpb24nLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiYW5rdHJhbnNhY3Rpb24nLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSkpLCBmaWVsZHM9KCdvcmdhbml6YXRpb24nLCAnaW1wb3J0UmVtb3RlU3lzdGVtJywgJ2ltcG9ydElkJyksIG5hbWU9J0JhbmtfdHJhbnNhY3Rpb25fdW5pcXVlX29yZ2FuaXphdGlvbl9pbXBvcnRSZW1vdGVTeXN0ZW1faW1wb3J0SWQnKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove constraint Bank_transaction_unique_number_date_organization from model banktransaction
--
DROP INDEX IF EXISTS "Bank_transaction_unique_number_date_organization";
--
-- Remove constraint Bank_transaction_unique_importId_importRemoteSystem_organization from model banktransaction
--
DROP INDEX IF EXISTS "Bank_transaction_unique_importId_importRemoteSystem_organization";
--
-- Create constraint Bank_transaction_unique_organization_importRemoteSystem_importId on model banktransaction
--
CREATE UNIQUE INDEX "Bank_transaction_unique_organization_importRemoteSystem_importId" ON "BankTransaction" ("organization", "importRemoteSystem", "importId") WHERE "deletedAt" IS NULL;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint Bank_transaction_unique_organization_importRemoteSystem_importId on model banktransaction
--
DROP INDEX IF EXISTS "Bank_transaction_unique_organization_importRemoteSystem_importId";
--
-- Remove constraint Bank_transaction_unique_importId_importRemoteSystem_organization from model banktransaction
--
CREATE UNIQUE INDEX "Bank_transaction_unique_importId_importRemoteSystem_organization" ON "BankTransaction" ("importId", "importRemoteSystem", "organization") WHERE "deletedAt" IS NULL;
--
-- Remove constraint Bank_transaction_unique_number_date_organization from model banktransaction
--
CREATE UNIQUE INDEX "Bank_transaction_unique_number_date_organization" ON "BankTransaction" ("number", "date", "organization") WHERE "deletedAt" IS NULL;
COMMIT;

    `)
}
