// auto generated by kmigrator
// KMIGRATOR:0339_b2bappnewssharingconfighistoryrecord_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMi4xIG9uIDIwMjMtMTEtMDggMTE6NTcKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzMzhfdXNlcnJpZ2h0c3NldF9jYW5tYW5hZ2VpbnZvaWNlY29udGV4dHNfYW5kX21vcmUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2IyYmFwcG5ld3NzaGFyaW5nY29uZmlnaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ25hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdwdWJsaXNoVXJsJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgncHJldmlld1VybCcsIG1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2dldFJlY2lwaWVudHNVcmwnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9kYXRlJywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfYWN0aW9uJywgbW9kZWxzLkNoYXJGaWVsZChjaG9pY2VzPVsoJ2MnLCAnYycpLCAoJ3UnLCAndScpLCAoJ2QnLCAnZCcpXSwgbWF4X2xlbmd0aD01MCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2lkJywgbW9kZWxzLlVVSURGaWVsZChkYl9pbmRleD1UcnVlKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ0IyQkFwcE5ld3NTaGFyaW5nQ29uZmlnSGlzdG9yeVJlY29yZCcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbmFtZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBjb250ZXh0JywKICAgICAgICAgICAgb2xkX25hbWU9J3NldHRpbmdzJywKICAgICAgICAgICAgbmV3X25hbWU9J21ldGEnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW5hbWVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwY29udGV4dGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBvbGRfbmFtZT0nc2V0dGluZ3MnLAogICAgICAgICAgICBuZXdfbmFtZT0nbWV0YScsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBjb250ZXh0JywKICAgICAgICAgICAgbmFtZT0nc3RhdGUnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwY29udGV4dGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdzdGF0ZScsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nbmV3c1NoYXJpbmdDb25maWcnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd1c2VycmlnaHRzc2V0JywKICAgICAgICAgICAgbmFtZT0nY2FuTWFuYWdlQjJCQXBwTmV3c1NoYXJpbmdDb25maWdzJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PUZhbHNlKSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXJyaWdodHNzZXQnLAogICAgICAgICAgICBuYW1lPSdjYW5SZWFkQjJCQXBwTmV3c1NoYXJpbmdDb25maWdzJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PVRydWUpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcnJpZ2h0c3NldGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VCMkJBcHBOZXdzU2hhcmluZ0NvbmZpZ3MnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd1c2VycmlnaHRzc2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRCMkJBcHBOZXdzU2hhcmluZ0NvbmZpZ3MnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdiMmJhcHBuZXdzc2hhcmluZ2NvbmZpZycsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ25hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdwdWJsaXNoVXJsJywgbW9kZWxzLlRleHRGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgncHJldmlld1VybCcsIG1vZGVscy5UZXh0RmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2dldFJlY2lwaWVudHNVcmwnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGRlZmF1bHQ9MSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjcmVhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQjJCQXBwTmV3c1NoYXJpbmdDb25maWcnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwJywKICAgICAgICAgICAgbmFtZT0nbmV3c1NoYXJpbmdDb25maWcnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J25ld3NTaGFyaW5nQ29uZmlnJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmIyYmFwcG5ld3NzaGFyaW5nY29uZmlnJyksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model b2bappnewssharingconfighistoryrecord
--
CREATE TABLE "B2BAppNewsSharingConfigHistoryRecord" ("name" text NULL, "publishUrl" text NULL, "previewUrl" text NULL, "getRecipientsUrl" text NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Rename field settings on b2bappcontext to meta
--
ALTER TABLE "B2BAppContext" RENAME COLUMN "settings" TO "meta";
--
-- Rename field settings on b2bappcontexthistoryrecord to meta
--
ALTER TABLE "B2BAppContextHistoryRecord" RENAME COLUMN "settings" TO "meta";
--
-- Remove field state from b2bappcontext
--
ALTER TABLE "B2BAppContext" DROP COLUMN "state" CASCADE;
--
-- Remove field state from b2bappcontexthistoryrecord
--
ALTER TABLE "B2BAppContextHistoryRecord" DROP COLUMN "state" CASCADE;
--
-- Add field newsSharingConfig to b2bapphistoryrecord
--
ALTER TABLE "B2BAppHistoryRecord" ADD COLUMN "newsSharingConfig" uuid NULL;
--
-- Add field canManageB2BAppNewsSharingConfigs to userrightsset
--
ALTER TABLE "UserRightsSet" ADD COLUMN "canManageB2BAppNewsSharingConfigs" boolean DEFAULT false NOT NULL;
ALTER TABLE "UserRightsSet" ALTER COLUMN "canManageB2BAppNewsSharingConfigs" DROP DEFAULT;
--
-- Add field canReadB2BAppNewsSharingConfigs to userrightsset
--
ALTER TABLE "UserRightsSet" ADD COLUMN "canReadB2BAppNewsSharingConfigs" boolean DEFAULT true NOT NULL;
ALTER TABLE "UserRightsSet" ALTER COLUMN "canReadB2BAppNewsSharingConfigs" DROP DEFAULT;
--
-- Add field canManageB2BAppNewsSharingConfigs to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" ADD COLUMN "canManageB2BAppNewsSharingConfigs" boolean NULL;
--
-- Add field canReadB2BAppNewsSharingConfigs to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" ADD COLUMN "canReadB2BAppNewsSharingConfigs" boolean NULL;
--
-- Create model b2bappnewssharingconfig
--
CREATE TABLE "B2BAppNewsSharingConfig" ("name" text NOT NULL, "publishUrl" text NOT NULL, "previewUrl" text NOT NULL, "getRecipientsUrl" text NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
--
-- Add field newsSharingConfig to b2bapp
--
ALTER TABLE "B2BApp" ADD COLUMN "newsSharingConfig" uuid NULL CONSTRAINT "B2BApp_newsSharingConfig_d803d285_fk_B2BAppNewsSharingConfig_id" REFERENCES "B2BAppNewsSharingConfig"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BApp_newsSharingConfig_d803d285_fk_B2BAppNewsSharingConfig_id" IMMEDIATE;
CREATE INDEX "B2BAppNewsSharingConfigHistoryRecord_history_id_80bf22fa" ON "B2BAppNewsSharingConfigHistoryRecord" ("history_id");
ALTER TABLE "B2BAppNewsSharingConfig" ADD CONSTRAINT "B2BAppNewsSharingConfig_createdBy_22b5eb2e_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "B2BAppNewsSharingConfig" ADD CONSTRAINT "B2BAppNewsSharingConfig_updatedBy_3218ae93_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "B2BAppNewsSharingConfig_createdAt_95a800ee" ON "B2BAppNewsSharingConfig" ("createdAt");
CREATE INDEX "B2BAppNewsSharingConfig_updatedAt_3fbf37d0" ON "B2BAppNewsSharingConfig" ("updatedAt");
CREATE INDEX "B2BAppNewsSharingConfig_deletedAt_293fe60c" ON "B2BAppNewsSharingConfig" ("deletedAt");
CREATE INDEX "B2BAppNewsSharingConfig_createdBy_22b5eb2e" ON "B2BAppNewsSharingConfig" ("createdBy");
CREATE INDEX "B2BAppNewsSharingConfig_updatedBy_3218ae93" ON "B2BAppNewsSharingConfig" ("updatedBy");
CREATE INDEX "B2BApp_newsSharingConfig_d803d285" ON "B2BApp" ("newsSharingConfig");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field newsSharingConfig to b2bapp
--
ALTER TABLE "B2BApp" DROP COLUMN "newsSharingConfig" CASCADE;
--
-- Create model b2bappnewssharingconfig
--
DROP TABLE "B2BAppNewsSharingConfig" CASCADE;
--
-- Add field canReadB2BAppNewsSharingConfigs to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" DROP COLUMN "canReadB2BAppNewsSharingConfigs" CASCADE;
--
-- Add field canManageB2BAppNewsSharingConfigs to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" DROP COLUMN "canManageB2BAppNewsSharingConfigs" CASCADE;
--
-- Add field canReadB2BAppNewsSharingConfigs to userrightsset
--
ALTER TABLE "UserRightsSet" DROP COLUMN "canReadB2BAppNewsSharingConfigs" CASCADE;
--
-- Add field canManageB2BAppNewsSharingConfigs to userrightsset
--
ALTER TABLE "UserRightsSet" DROP COLUMN "canManageB2BAppNewsSharingConfigs" CASCADE;
--
-- Add field newsSharingConfig to b2bapphistoryrecord
--
ALTER TABLE "B2BAppHistoryRecord" DROP COLUMN "newsSharingConfig" CASCADE;
--
-- Remove field state from b2bappcontexthistoryrecord
--
ALTER TABLE "B2BAppContextHistoryRecord" ADD COLUMN "state" jsonb NULL;
--
-- Remove field state from b2bappcontext
--
ALTER TABLE "B2BAppContext" ADD COLUMN "state" jsonb NULL;
--
-- Rename field settings on b2bappcontexthistoryrecord to meta
--
ALTER TABLE "B2BAppContextHistoryRecord" RENAME COLUMN "meta" TO "settings";
--
-- Rename field settings on b2bappcontext to meta
--
ALTER TABLE "B2BAppContext" RENAME COLUMN "meta" TO "settings";
--
-- Create model b2bappnewssharingconfighistoryrecord
--
DROP TABLE "B2BAppNewsSharingConfigHistoryRecord" CASCADE;
COMMIT;

    `)
}
