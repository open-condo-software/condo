// auto generated by kmigrator
// KMIGRATOR:0353_remove_invoicecontext_createdby_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMi40IG9uIDIwMjMtMTItMTUgMDk6NTgKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzNTJfYXV0b18yMDIzMTIxNF8wNDI0JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKIyAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKIyAgICAgICAgICAgIG1vZGVsX25hbWU9J2ludm9pY2Vjb250ZXh0JywKIyAgICAgICAgICAgIG5hbWU9J2NyZWF0ZWRCeScsCiMgICAgICAgICksCiMgICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiMgICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlY29udGV4dCcsCiMgICAgICAgICAgICBuYW1lPSdpbnRlZ3JhdGlvbicsCiMgICAgICAgICksCiMgICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiMgICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlY29udGV4dCcsCiMgICAgICAgICAgICBuYW1lPSdvcmdhbml6YXRpb24nLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0naW52b2ljZWNvbnRleHQnLAojICAgICAgICAgICAgbmFtZT0ndXBkYXRlZEJ5JywKIyAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlJywKICAgICAgICAgICAgbmFtZT0nY29udGV4dCcsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2NvbnRleHQnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVyb2xlJywKICAgICAgICAgICAgbmFtZT0nY2FuTWFuYWdlSW52b2ljZUNvbnRleHRzJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbmVtcGxveWVlcm9sZScsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRJbnZvaWNlQ29udGV4dHMnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nb3JnYW5pemF0aW9uZW1wbG95ZWVyb2xlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2Nhbk1hbmFnZUludm9pY2VDb250ZXh0cycsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdvcmdhbml6YXRpb25lbXBsb3llZXJvbGVoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2FuUmVhZEludm9pY2VDb250ZXh0cycsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd1c2VycmlnaHRzc2V0JywKICAgICAgICAgICAgbmFtZT0nY2FuTWFuYWdlSW52b2ljZUNvbnRleHRzJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXJyaWdodHNzZXQnLAogICAgICAgICAgICBuYW1lPSdjYW5SZWFkSW52b2ljZUNvbnRleHRzJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXJyaWdodHNzZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2FuTWFuYWdlSW52b2ljZUNvbnRleHRzJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXJyaWdodHNzZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2FuUmVhZEludm9pY2VDb250ZXh0cycsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbicsCiAgICAgICAgICAgIG5hbWU9J3ZhdFBlcmNlbnRPcHRpb25zJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWNxdWlyaW5naW50ZWdyYXRpb25jb250ZXh0JywKICAgICAgICAgICAgbmFtZT0naW52b2ljZUVtYWlscycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dCcsCiAgICAgICAgICAgIG5hbWU9J2ludm9pY2VJbXBsaWNpdEZlZURpc3RyaWJ1dGlvblNjaGVtYScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dCcsCiAgICAgICAgICAgIG5hbWU9J2ludm9pY2VSZWFzb24nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbmNvbnRleHQnLAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlUmVjaXBpZW50JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWNxdWlyaW5naW50ZWdyYXRpb25jb250ZXh0JywKICAgICAgICAgICAgbmFtZT0naW52b2ljZVNhbGVzVGF4UGVyY2VudCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EZWNpbWFsRmllbGQoYmxhbms9VHJ1ZSwgZGVjaW1hbF9wbGFjZXM9NCwgbWF4X2RpZ2l0cz0xOCwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dCcsCiAgICAgICAgICAgIG5hbWU9J2ludm9pY2VTdGF0dXMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbmNvbnRleHQnLAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlVGF4UmVnaW1lJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWNxdWlyaW5naW50ZWdyYXRpb25jb250ZXh0JywKICAgICAgICAgICAgbmFtZT0naW52b2ljZVZhdFBlcmNlbnQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGVjaW1hbEZpZWxkKGJsYW5rPVRydWUsIGRlY2ltYWxfcGxhY2VzPTQsIG1heF9kaWdpdHM9MTgsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbmNvbnRleHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0naW52b2ljZUVtYWlscycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlSW1wbGljaXRGZWVEaXN0cmlidXRpb25TY2hlbWEnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbmNvbnRleHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0naW52b2ljZVJlYXNvbicsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlUmVjaXBpZW50JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWNxdWlyaW5naW50ZWdyYXRpb25jb250ZXh0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2ludm9pY2VTYWxlc1RheFBlcmNlbnQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGVjaW1hbEZpZWxkKGJsYW5rPVRydWUsIGRlY2ltYWxfcGxhY2VzPTQsIG1heF9kaWdpdHM9MTgsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhY3F1aXJpbmdpbnRlZ3JhdGlvbmNvbnRleHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0naW52b2ljZVN0YXR1cycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FjcXVpcmluZ2ludGVncmF0aW9uY29udGV4dGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlVGF4UmVnaW1lJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWNxdWlyaW5naW50ZWdyYXRpb25jb250ZXh0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2ludm9pY2VWYXRQZXJjZW50JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkRlY2ltYWxGaWVsZChibGFuaz1UcnVlLCBkZWNpbWFsX3BsYWNlcz00LCBtYXhfZGlnaXRzPTE4LCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYWNxdWlyaW5naW50ZWdyYXRpb25oaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0ndmF0UGVyY2VudE9wdGlvbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlJywKICAgICAgICAgICAgbmFtZT0nb3JnYW5pemF0aW9uJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoZGJfY29sdW1uPSdvcmdhbml6YXRpb24nLCBkZWZhdWx0PScnLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEub3JnYW5pemF0aW9uJyksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J29yZ2FuaXphdGlvbicsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2ludm9pY2VoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0ncmVjaXBpZW50JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5EZWxldGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0naW52b2ljZWNvbnRleHQnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5EZWxldGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0naW52b2ljZWNvbnRleHRoaXN0b3J5cmVjb3JkJywKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;

--
-- Remove field context from invoice
--
ALTER TABLE "Invoice" DROP COLUMN "context" CASCADE;
--
-- Remove field context from invoicehistoryrecord
--
ALTER TABLE "InvoiceHistoryRecord" DROP COLUMN "context" CASCADE;
--
-- Remove field canManageInvoiceContexts from organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" DROP COLUMN "canManageInvoiceContexts" CASCADE;
--
-- Remove field canReadInvoiceContexts from organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" DROP COLUMN "canReadInvoiceContexts" CASCADE;
--
-- Remove field canManageInvoiceContexts from organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" DROP COLUMN "canManageInvoiceContexts" CASCADE;
--
-- Remove field canReadInvoiceContexts from organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" DROP COLUMN "canReadInvoiceContexts" CASCADE;
--
-- Remove field canManageInvoiceContexts from userrightsset
--
ALTER TABLE "UserRightsSet" DROP COLUMN "canManageInvoiceContexts" CASCADE;
--
-- Remove field canReadInvoiceContexts from userrightsset
--
ALTER TABLE "UserRightsSet" DROP COLUMN "canReadInvoiceContexts" CASCADE;
--
-- Remove field canManageInvoiceContexts from userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" DROP COLUMN "canManageInvoiceContexts" CASCADE;
--
-- Remove field canReadInvoiceContexts from userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" DROP COLUMN "canReadInvoiceContexts" CASCADE;
--
-- Add field vatPercentOptions to acquiringintegration
--
ALTER TABLE "AcquiringIntegration" ADD COLUMN "vatPercentOptions" text NULL;
--
-- Add field invoiceEmails to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceEmails" text NULL;
--
-- Add field invoiceImplicitFeeDistributionSchema to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceImplicitFeeDistributionSchema" jsonb NULL;
--
-- Add field invoiceReason to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceReason" text NULL;
--
-- Add field invoiceRecipient to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceRecipient" jsonb NULL;
--
-- Add field invoiceSalesTaxPercent to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceSalesTaxPercent" numeric(18, 4) NULL;
--
-- Add field invoiceStatus to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceStatus" text NULL;
--
-- Add field invoiceTaxRegime to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceTaxRegime" text NULL;
--
-- Add field invoiceVatPercent to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" ADD COLUMN "invoiceVatPercent" numeric(18, 4) NULL;
--
-- Add field invoiceEmails to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceEmails" text NULL;
--
-- Add field invoiceImplicitFeeDistributionSchema to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceImplicitFeeDistributionSchema" jsonb NULL;
--
-- Add field invoiceReason to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceReason" text NULL;
--
-- Add field invoiceRecipient to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceRecipient" jsonb NULL;
--
-- Add field invoiceSalesTaxPercent to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceSalesTaxPercent" numeric(18, 4) NULL;
--
-- Add field invoiceStatus to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceStatus" text NULL;
--
-- Add field invoiceTaxRegime to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceTaxRegime" text NULL;
--
-- Add field invoiceVatPercent to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" ADD COLUMN "invoiceVatPercent" numeric(18, 4) NULL;
--
-- Add field vatPercentOptions to acquiringintegrationhistoryrecord
--
ALTER TABLE "AcquiringIntegrationHistoryRecord" ADD COLUMN "vatPercentOptions" text NULL;
--
-- Add field organization to invoice
--

ALTER TABLE "Invoice" ADD COLUMN "organization" uuid CONSTRAINT "Invoice_organization_d276dcc3_fk_Organization_id" REFERENCES "Organization"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Invoice_organization_d276dcc3_fk_Organization_id" IMMEDIATE;
UPDATE "Invoice" SET "organization" = "Contact".organization FROM "Contact" WHERE "Invoice".contact = "Contact".id;
UPDATE "Invoice" SET "organization" = "Property".organization FROM "Property" WHERE "Invoice".property = "Property".id AND "Invoice".property IS NOT NULL AND "Invoice".organization IS NULL;
UPDATE "Invoice" SET "organization" = "Payment".organization FROM "Payment" WHERE "Invoice".id = "Payment".invoice  AND "Invoice".organization IS NULL;
DELETE FROM "Invoice" WHERE organization IS NULL;
ALTER TABLE "Invoice" ALTER COLUMN "organization" SET NOT NULL;

--
-- Add field organization to invoicehistoryrecord
--
ALTER TABLE "InvoiceHistoryRecord" ADD COLUMN "organization" uuid NULL;
--
-- Add field recipient to invoicehistoryrecord
--
ALTER TABLE "InvoiceHistoryRecord" ADD COLUMN "recipient" jsonb NULL;
--
-- Delete model invoicecontext
--
DROP TABLE "InvoiceContext" CASCADE;
--
-- Delete model invoicecontexthistoryrecord
--
DROP TABLE "InvoiceContextHistoryRecord" CASCADE;
CREATE INDEX "Invoice_organization_d276dcc3" ON "Invoice" ("organization");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Delete model invoicecontexthistoryrecord
--
CREATE TABLE "InvoiceContextHistoryRecord" ("organization" uuid NULL, "recipient" jsonb NULL, "settings" jsonb NULL, "status" text NULL, "implicitFeePercent" numeric(18, 4) NULL, "taxRegime" text NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL, "vatPercent" text NULL, "currencyCode" text NULL, "salesTaxPercent" numeric(18, 4) NULL, "integration" uuid NULL);
--
-- Delete model invoicecontext
--
CREATE TABLE "InvoiceContext" ("recipient" jsonb NULL, "settings" jsonb NULL, "status" text NULL, "implicitFeePercent" numeric(18, 4) NOT NULL, "taxRegime" text NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "organization" uuid NOT NULL, "updatedBy" uuid NULL, "vatPercent" text NULL, "currencyCode" text NOT NULL, "salesTaxPercent" numeric(18, 4) NULL, "integration" uuid NOT NULL);
--
-- Add field recipient to invoicehistoryrecord
--
ALTER TABLE "InvoiceHistoryRecord" DROP COLUMN "recipient" CASCADE;
--
-- Add field organization to invoicehistoryrecord
--
ALTER TABLE "InvoiceHistoryRecord" DROP COLUMN "organization" CASCADE;
--
-- Add field organization to invoice
--
ALTER TABLE "Invoice" DROP COLUMN "organization" CASCADE;
--
-- Add field vatPercentOptions to acquiringintegrationhistoryrecord
--
ALTER TABLE "AcquiringIntegrationHistoryRecord" DROP COLUMN "vatPercentOptions" CASCADE;
--
-- Add field invoiceVatPercent to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceVatPercent" CASCADE;
--
-- Add field invoiceTaxRegime to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceTaxRegime" CASCADE;
--
-- Add field invoiceStatus to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceStatus" CASCADE;
--
-- Add field invoiceSalesTaxPercent to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceSalesTaxPercent" CASCADE;
--
-- Add field invoiceRecipient to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceRecipient" CASCADE;
--
-- Add field invoiceReason to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceReason" CASCADE;
--
-- Add field invoiceImplicitFeeDistributionSchema to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceImplicitFeeDistributionSchema" CASCADE;
--
-- Add field invoiceEmails to acquiringintegrationcontexthistoryrecord
--
ALTER TABLE "AcquiringIntegrationContextHistoryRecord" DROP COLUMN "invoiceEmails" CASCADE;
--
-- Add field invoiceVatPercent to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceVatPercent" CASCADE;
--
-- Add field invoiceTaxRegime to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceTaxRegime" CASCADE;
--
-- Add field invoiceStatus to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceStatus" CASCADE;
--
-- Add field invoiceSalesTaxPercent to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceSalesTaxPercent" CASCADE;
--
-- Add field invoiceRecipient to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceRecipient" CASCADE;
--
-- Add field invoiceReason to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceReason" CASCADE;
--
-- Add field invoiceImplicitFeeDistributionSchema to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceImplicitFeeDistributionSchema" CASCADE;
--
-- Add field invoiceEmails to acquiringintegrationcontext
--
ALTER TABLE "AcquiringIntegrationContext" DROP COLUMN "invoiceEmails" CASCADE;
--
-- Add field vatPercentOptions to acquiringintegration
--
ALTER TABLE "AcquiringIntegration" DROP COLUMN "vatPercentOptions" CASCADE;
--
-- Remove field canReadInvoiceContexts from userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" ADD COLUMN "canReadInvoiceContexts" boolean NULL;
--
-- Remove field canManageInvoiceContexts from userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" ADD COLUMN "canManageInvoiceContexts" boolean NULL;
--
-- Remove field canReadInvoiceContexts from userrightsset
--
ALTER TABLE "UserRightsSet" ADD COLUMN "canReadInvoiceContexts" boolean NOT NULL;
--
-- Remove field canManageInvoiceContexts from userrightsset
--
ALTER TABLE "UserRightsSet" ADD COLUMN "canManageInvoiceContexts" boolean NOT NULL;
--
-- Remove field canReadInvoiceContexts from organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" ADD COLUMN "canReadInvoiceContexts" boolean NULL;
--
-- Remove field canManageInvoiceContexts from organizationemployeerolehistoryrecord
--
ALTER TABLE "OrganizationEmployeeRoleHistoryRecord" ADD COLUMN "canManageInvoiceContexts" boolean NULL;
--
-- Remove field canReadInvoiceContexts from organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" ADD COLUMN "canReadInvoiceContexts" boolean NULL;
--
-- Remove field canManageInvoiceContexts from organizationemployeerole
--
ALTER TABLE "OrganizationEmployeeRole" ADD COLUMN "canManageInvoiceContexts" boolean NULL;
--
-- Remove field context from invoicehistoryrecord
--
ALTER TABLE "InvoiceHistoryRecord" ADD COLUMN "context" uuid NULL;
--
-- Remove field context from invoice
--
ALTER TABLE "Invoice" ADD COLUMN "context" uuid NULL;
CREATE INDEX "InvoiceContextHistoryRecord_history_id_fb1104ef" ON "InvoiceContextHistoryRecord" ("history_id");
ALTER TABLE "InvoiceContext" ADD CONSTRAINT "InvoiceContext_createdBy_1041b794_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "InvoiceContext" ADD CONSTRAINT "InvoiceContext_organization_eac30293_fk_Organization_id" FOREIGN KEY ("organization") REFERENCES "Organization" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "InvoiceContext" ADD CONSTRAINT "InvoiceContext_updatedBy_dd2d2882_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "InvoiceContext" ADD CONSTRAINT "InvoiceContext_integration_cdad2d29_fk_AcquiringIntegration_id" FOREIGN KEY ("integration") REFERENCES "AcquiringIntegration" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE UNIQUE INDEX "invoiceContext_unique_organization" ON "InvoiceContext" ("organization") WHERE "deletedAt" IS NULL;
CREATE INDEX "InvoiceContext_createdAt_0a7a3706" ON "InvoiceContext" ("createdAt");
CREATE INDEX "InvoiceContext_updatedAt_3f822b30" ON "InvoiceContext" ("updatedAt");
CREATE INDEX "InvoiceContext_deletedAt_b9a1c5d5" ON "InvoiceContext" ("deletedAt");
CREATE INDEX "InvoiceContext_createdBy_1041b794" ON "InvoiceContext" ("createdBy");
CREATE INDEX "InvoiceContext_organization_eac30293" ON "InvoiceContext" ("organization");
CREATE INDEX "InvoiceContext_updatedBy_dd2d2882" ON "InvoiceContext" ("updatedBy");
CREATE INDEX "InvoiceContext_integration_cdad2d29" ON "InvoiceContext" ("integration");
CREATE INDEX "Invoice_context_f82e2da9" ON "Invoice" ("context");
COMMIT;

    `)
}
