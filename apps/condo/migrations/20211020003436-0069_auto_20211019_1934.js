// auto generated by kmigrator
// KMIGRATOR:0069_auto_20211019_1934:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi40IG9uIDIwMjEtMTAtMTkgMTk6MzQKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwNjhfYXV0b18yMDIxMTAxOF8yMTA3JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKIyAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKIyAgICAgICAgICAgIG1vZGVsX25hbWU9J2JpbGxpbmdjdXJyZW5jeScsCiMgICAgICAgICAgICBuYW1lPSdjcmVhdGVkQnknLAojICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ2N1cnJlbmN5JywKIyAgICAgICAgICAgIG5hbWU9J3VwZGF0ZWRCeScsCiMgICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ2ludGVncmF0aW9uJywKICAgICAgICAgICAgbmFtZT0nY3VycmVuY3knLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ2ludGVncmF0aW9uaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2N1cnJlbmN5JywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2JpbGxpbmdpbnRlZ3JhdGlvbicsCiAgICAgICAgICAgIG5hbWU9J2N1cnJlbmN5Q29kZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoZGVmYXVsdD0nUlVCJyksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiaWxsaW5naW50ZWdyYXRpb25oaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY3VycmVuY3lDb2RlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiaWxsaW5ncmVjZWlwdCcsCiAgICAgICAgICAgIG5hbWU9J3RvUGF5JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkRlY2ltYWxGaWVsZChkZWNpbWFsX3BsYWNlcz04LCBtYXhfZGlnaXRzPTE4KSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYmlsbGluZ3JlY2VpcHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0ndG9QYXknLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGVjaW1hbEZpZWxkKGJsYW5rPVRydWUsIGRlY2ltYWxfcGxhY2VzPTQsIG1heF9kaWdpdHM9MTgsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkRlbGV0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdiaWxsaW5nY3VycmVuY3knLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5EZWxldGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nYmlsbGluZ2N1cnJlbmN5aGlzdG9yeXJlY29yZCcsCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove field currency from billingintegration
--
SET CONSTRAINTS "BillingIntegration_currency_6dcf6f51_fk_BillingCurrency_id" IMMEDIATE; ALTER TABLE "BillingIntegration" DROP CONSTRAINT "BillingIntegration_currency_6dcf6f51_fk_BillingCurrency_id";
ALTER TABLE "BillingIntegration" DROP COLUMN "currency" CASCADE;
--
-- Remove field currency from billingintegrationhistoryrecord
--
ALTER TABLE "BillingIntegrationHistoryRecord" DROP COLUMN "currency" CASCADE;
--
-- Add field currencyCode to billingintegration
--
ALTER TABLE "BillingIntegration" ADD COLUMN "currencyCode" text DEFAULT 'RUB' NOT NULL;
ALTER TABLE "BillingIntegration" ALTER COLUMN "currencyCode" DROP DEFAULT;
--
-- Add field currencyCode to billingintegrationhistoryrecord
--
ALTER TABLE "BillingIntegrationHistoryRecord" ADD COLUMN "currencyCode" text NULL;
--
-- Alter field toPay on billingreceipt
--
ALTER TABLE "BillingReceipt" ALTER COLUMN "toPay" TYPE numeric(18, 8) USING "toPay"::numeric(18, 8);
--
-- Alter field toPay on billingreceipthistoryrecord
--
ALTER TABLE "BillingReceiptHistoryRecord" ALTER COLUMN "toPay" TYPE numeric(18, 4) USING "toPay"::numeric(18, 4);
--
-- Delete model billingcurrency
--
DROP TABLE "BillingCurrency" CASCADE;
--
-- Delete model billingcurrencyhistoryrecord
--
DROP TABLE "BillingCurrencyHistoryRecord" CASCADE;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Delete model billingcurrencyhistoryrecord
--
CREATE TABLE "BillingCurrencyHistoryRecord" ("dv" integer NULL, "sender" jsonb NULL, "code" text NULL, "displayInfo" jsonb NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Delete model billingcurrency
--
CREATE TABLE "BillingCurrency" ("dv" integer NOT NULL, "sender" jsonb NOT NULL, "code" text NOT NULL, "displayInfo" jsonb NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
--
-- Alter field toPay on billingreceipthistoryrecord
--
ALTER TABLE "BillingReceiptHistoryRecord" ALTER COLUMN "toPay" TYPE text USING "toPay"::text;
--
-- Alter field toPay on billingreceipt
--
ALTER TABLE "BillingReceipt" ALTER COLUMN "toPay" TYPE text USING "toPay"::text;
--
-- Add field currencyCode to billingintegrationhistoryrecord
--
ALTER TABLE "BillingIntegrationHistoryRecord" DROP COLUMN "currencyCode" CASCADE;
--
-- Add field currencyCode to billingintegration
--
ALTER TABLE "BillingIntegration" DROP COLUMN "currencyCode" CASCADE;
--
-- Remove field currency from billingintegrationhistoryrecord
--
ALTER TABLE "BillingIntegrationHistoryRecord" ADD COLUMN "currency" uuid NULL;
--
-- Remove field currency from billingintegration
--
ALTER TABLE "BillingIntegration" ADD COLUMN "currency" uuid NULL CONSTRAINT "BillingIntegration_currency_6dcf6f51_fk_BillingCurrency_id" REFERENCES "BillingCurrency"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "BillingIntegration_currency_6dcf6f51_fk_BillingCurrency_id" IMMEDIATE;
CREATE INDEX "BillingCurrencyHistoryRecord_history_id_0f3fff3d" ON "BillingCurrencyHistoryRecord" ("history_id");
ALTER TABLE "BillingCurrency" ADD CONSTRAINT "BillingCurrency_createdBy_937b28e2_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "BillingCurrency" ADD CONSTRAINT "BillingCurrency_updatedBy_4b979af5_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "BillingCurrency_createdAt_07729fc7" ON "BillingCurrency" ("createdAt");
CREATE INDEX "BillingCurrency_updatedAt_61834756" ON "BillingCurrency" ("updatedAt");
CREATE INDEX "BillingCurrency_deletedAt_6502f754" ON "BillingCurrency" ("deletedAt");
CREATE INDEX "BillingCurrency_createdBy_937b28e2" ON "BillingCurrency" ("createdBy");
CREATE INDEX "BillingCurrency_updatedBy_4b979af5" ON "BillingCurrency" ("updatedBy");
CREATE INDEX "BillingIntegration_currency_6dcf6f51" ON "BillingIntegration" ("currency");
COMMIT;

    `)
}
