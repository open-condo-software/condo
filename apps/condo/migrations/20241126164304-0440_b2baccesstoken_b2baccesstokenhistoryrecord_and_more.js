// auto generated by kmigrator
// KMIGRATOR:0440_b2baccesstoken_b2baccesstokenhistoryrecord_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI0LTExLTI2IDExOjQ0CgppbXBvcnQgZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwNDM5X2F1dG9fMjAyNDExMjVfMDcwMicpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nYjJiYWNjZXNzdG9rZW4nLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdzZXNzaW9uSWQnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdleHBpcmVzQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ0IyQkFjY2Vzc1Rva2VuJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2IyYmFjY2Vzc3Rva2VuaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ3Nlc3Npb25JZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NvbnRleHQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1c2VyJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgncmlnaHRTZXQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdleHBpcmVzQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaWQnLCBtb2RlbHMuVVVJREZpZWxkKHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCd2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkZWxldGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbmV3SWQnLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfZGF0ZScsIG1vZGVscy5EYXRlVGltZUZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2FjdGlvbicsIG1vZGVscy5DaGFyRmllbGQobWF4X2xlbmd0aD01MCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2lkJywgbW9kZWxzLlVVSURGaWVsZChkYl9pbmRleD1UcnVlKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ0IyQkFjY2Vzc1Rva2VuSGlzdG9yeVJlY29yZCcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUNvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0JywKICAgICAgICAgICAgbmFtZT0nYjJiX2FwcF9hY2Nlc3NfcmlnaHRfc2V0X3VuaXF1ZV9hcHAnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXQnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VCMkJBY2Nlc3NUb2tlbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXQnLAogICAgICAgICAgICBuYW1lPSdjYW5SZWFkQjJCQWNjZXNzVG9rZW5zJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PUZhbHNlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0JywKICAgICAgICAgICAgbmFtZT0nbmFtZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoZGVmYXVsdD0nZGVmYXVsdCcpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXQnLAogICAgICAgICAgICBuYW1lPSd0eXBlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkNoYXJGaWVsZChkZWZhdWx0PSdHTE9CQUwnLCBtYXhfbGVuZ3RoPTUwKSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2Nhbk1hbmFnZUIyQkFjY2Vzc1Rva2VucycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRCMkJBY2Nlc3NUb2tlbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBhY2Nlc3NyaWdodHNldGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSduYW1lJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0ndHlwZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3VzZXJyaWdodHNzZXQnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VCMkJBY2Nlc3NUb2tlbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcnJpZ2h0c3NldCcsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRCMkJBY2Nlc3NUb2tlbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcnJpZ2h0c3NldGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdjYW5NYW5hZ2VCMkJBY2Nlc3NUb2tlbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd1c2VycmlnaHRzc2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRCMkJBY2Nlc3NUb2tlbnMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0JywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpLCAoJ3R5cGUnLCAnR0xPQkFMJykpLCBmaWVsZHM9KCdhcHAnLCksIG5hbWU9J2IyYl9hcHBfYWNjZXNzX3JpZ2h0X3NldF91bmlxdWVfYXBwJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhY2Nlc3N0b2tlbicsCiAgICAgICAgICAgIG5hbWU9J2NvbnRleHQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J2NvbnRleHQnLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuYjJiYXBwY29udGV4dCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYWNjZXNzdG9rZW4nLAogICAgICAgICAgICBuYW1lPSdjcmVhdGVkQnknLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J2NyZWF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhY2Nlc3N0b2tlbicsCiAgICAgICAgICAgIG5hbWU9J3JpZ2h0U2V0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoZGJfY29sdW1uPSdyaWdodFNldCcsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5iMmJhcHBhY2Nlc3NyaWdodHNldCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYWNjZXNzdG9rZW4nLAogICAgICAgICAgICBuYW1lPSd1cGRhdGVkQnknLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VwZGF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhY2Nlc3N0b2tlbicsCiAgICAgICAgICAgIG5hbWU9J3VzZXInLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J3VzZXInLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model b2baccesstoken
--
CREATE TABLE "B2BAccessToken" ("sessionId" text NOT NULL, "expiresAt" timestamp with time zone NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL);
--
-- Create model b2baccesstokenhistoryrecord
--
CREATE TABLE "B2BAccessTokenHistoryRecord" ("sessionId" jsonb NULL, "context" uuid NULL, "user" uuid NULL, "rightSet" uuid NULL, "expiresAt" timestamp with time zone NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Remove constraint b2b_app_access_right_set_unique_app from model b2bappaccessrightset
--
DROP INDEX IF EXISTS "b2b_app_access_right_set_unique_app";
--
-- Add field canManageB2BAccessTokens to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "canManageB2BAccessTokens" boolean DEFAULT false NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "canManageB2BAccessTokens" DROP DEFAULT;
--
-- Add field canReadB2BAccessTokens to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "canReadB2BAccessTokens" boolean DEFAULT false NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "canReadB2BAccessTokens" DROP DEFAULT;
--
-- Add field name to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "name" text DEFAULT 'default' NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "name" DROP DEFAULT;
--
-- Add field type to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "type" varchar(50) DEFAULT 'GLOBAL' NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "type" DROP DEFAULT;
--
-- Add field canManageB2BAccessTokens to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "canManageB2BAccessTokens" boolean NULL;
--
-- Add field canReadB2BAccessTokens to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "canReadB2BAccessTokens" boolean NULL;
--
-- Add field name to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "name" text NULL;
--
-- Add field type to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "type" text NULL;
--
-- Add field canManageB2BAccessTokens to userrightsset
--
ALTER TABLE "UserRightsSet" ADD COLUMN "canManageB2BAccessTokens" boolean DEFAULT false NOT NULL;
ALTER TABLE "UserRightsSet" ALTER COLUMN "canManageB2BAccessTokens" DROP DEFAULT;
--
-- Add field canReadB2BAccessTokens to userrightsset
--
ALTER TABLE "UserRightsSet" ADD COLUMN "canReadB2BAccessTokens" boolean DEFAULT false NOT NULL;
ALTER TABLE "UserRightsSet" ALTER COLUMN "canReadB2BAccessTokens" DROP DEFAULT;
--
-- Add field canManageB2BAccessTokens to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" ADD COLUMN "canManageB2BAccessTokens" boolean NULL;
--
-- Add field canReadB2BAccessTokens to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" ADD COLUMN "canReadB2BAccessTokens" boolean NULL;
--
-- Create constraint b2b_app_access_right_set_unique_app on model b2bappaccessrightset
--
CREATE UNIQUE INDEX "b2b_app_access_right_set_unique_app" ON "B2BAppAccessRightSet" ("app") WHERE ("deletedAt" IS NULL AND "type" = 'GLOBAL');
--
-- Add field context to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" ADD COLUMN "context" uuid NOT NULL CONSTRAINT "B2BAccessToken_context_701dbbdf_fk_B2BAppContext_id" REFERENCES "B2BAppContext"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAccessToken_context_701dbbdf_fk_B2BAppContext_id" IMMEDIATE;
--
-- Add field createdBy to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" ADD COLUMN "createdBy" uuid NULL CONSTRAINT "B2BAccessToken_createdBy_1db4340e_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAccessToken_createdBy_1db4340e_fk_User_id" IMMEDIATE;
--
-- Add field rightSet to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" ADD COLUMN "rightSet" uuid NOT NULL CONSTRAINT "B2BAccessToken_rightSet_79e1b380_fk_B2BAppAccessRightSet_id" REFERENCES "B2BAppAccessRightSet"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAccessToken_rightSet_79e1b380_fk_B2BAppAccessRightSet_id" IMMEDIATE;
--
-- Add field updatedBy to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" ADD COLUMN "updatedBy" uuid NULL CONSTRAINT "B2BAccessToken_updatedBy_bc9b277b_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAccessToken_updatedBy_bc9b277b_fk_User_id" IMMEDIATE;
--
-- Add field user to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" ADD COLUMN "user" uuid NOT NULL CONSTRAINT "B2BAccessToken_user_e783323b_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2BAccessToken_user_e783323b_fk_User_id" IMMEDIATE;
CREATE INDEX "B2BAccessToken_createdAt_1792b5ef" ON "B2BAccessToken" ("createdAt");
CREATE INDEX "B2BAccessToken_updatedAt_61055ffa" ON "B2BAccessToken" ("updatedAt");
CREATE INDEX "B2BAccessToken_deletedAt_95d14da7" ON "B2BAccessToken" ("deletedAt");
CREATE INDEX "B2BAccessTokenHistoryRecord_history_id_7dfc348c" ON "B2BAccessTokenHistoryRecord" ("history_id");
CREATE INDEX "B2BAccessToken_context_701dbbdf" ON "B2BAccessToken" ("context");
CREATE INDEX "B2BAccessToken_createdBy_1db4340e" ON "B2BAccessToken" ("createdBy");
CREATE INDEX "B2BAccessToken_rightSet_79e1b380" ON "B2BAccessToken" ("rightSet");
CREATE INDEX "B2BAccessToken_updatedBy_bc9b277b" ON "B2BAccessToken" ("updatedBy");
CREATE INDEX "B2BAccessToken_user_e783323b" ON "B2BAccessToken" ("user");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field user to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" DROP COLUMN "user" CASCADE;
--
-- Add field updatedBy to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" DROP COLUMN "updatedBy" CASCADE;
--
-- Add field rightSet to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" DROP COLUMN "rightSet" CASCADE;
--
-- Add field createdBy to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" DROP COLUMN "createdBy" CASCADE;
--
-- Add field context to b2baccesstoken
--
ALTER TABLE "B2BAccessToken" DROP COLUMN "context" CASCADE;
--
-- Create constraint b2b_app_access_right_set_unique_app on model b2bappaccessrightset
--
DROP INDEX IF EXISTS "b2b_app_access_right_set_unique_app";
--
-- Add field canReadB2BAccessTokens to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" DROP COLUMN "canReadB2BAccessTokens" CASCADE;
--
-- Add field canManageB2BAccessTokens to userrightssethistoryrecord
--
ALTER TABLE "UserRightsSetHistoryRecord" DROP COLUMN "canManageB2BAccessTokens" CASCADE;
--
-- Add field canReadB2BAccessTokens to userrightsset
--
ALTER TABLE "UserRightsSet" DROP COLUMN "canReadB2BAccessTokens" CASCADE;
--
-- Add field canManageB2BAccessTokens to userrightsset
--
ALTER TABLE "UserRightsSet" DROP COLUMN "canManageB2BAccessTokens" CASCADE;
--
-- Add field type to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "type" CASCADE;
--
-- Add field name to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "name" CASCADE;
--
-- Add field canReadB2BAccessTokens to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "canReadB2BAccessTokens" CASCADE;
--
-- Add field canManageB2BAccessTokens to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "canManageB2BAccessTokens" CASCADE;
--
-- Add field name to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "name" CASCADE;
--
-- Add field canReadB2BAccessTokens to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "canReadB2BAccessTokens" CASCADE;
--
-- Add field canManageB2BAccessTokens to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "canManageB2BAccessTokens" CASCADE;

--
-- [CUSTOM] Drop non default type rows to satisfy unique constraint
-- [NOTE] "B2BAppAccessRight_accessRightSet_d66bc7b6_fk_B2BAppAcc" is defined in 20230804220052-0304_b2bappaccessrightset_and_more.js
--
ALTER TABLE "B2BAppAccessRight" DROP CONSTRAINT "B2BAppAccessRight_accessRightSet_d66bc7b6_fk_B2BAppAcc";
DELETE FROM "B2BAppAccessRightSet" WHERE "type" != 'GLOBAL';
ALTER TABLE "B2BAppAccessRight" ADD CONSTRAINT "B2BAppAccessRight_accessRightSet_d66bc7b6_fk_B2BAppAcc" FOREIGN KEY ("accessRightSet") REFERENCES "B2BAppAccessRightSet"("id");

-- [CUSTOM] Change generated execution order to successfully return old unique index
-- Add field type to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "type" CASCADE;

--
-- Remove constraint b2b_app_access_right_set_unique_app from model b2bappaccessrightset
--
CREATE UNIQUE INDEX "b2b_app_access_right_set_unique_app" ON "B2BAppAccessRightSet" ("app") WHERE "deletedAt" IS NULL;
--
-- Create model b2baccesstokenhistoryrecord
--
DROP TABLE "B2BAccessTokenHistoryRecord" CASCADE;
--
-- Create model b2baccesstoken
--
DROP TABLE "B2BAccessToken" CASCADE;
COMMIT;

    `)
}
