// auto generated by kmigrator
// KMIGRATOR:0019_auto_20210610_0741:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMiBvbiAyMDIxLTA2LTEwIDA3OjQxCgppbXBvcnQgZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuZmllbGRzLmpzb25iCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwMThfYXV0b18yMDIxMDYwOV8xMjExJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdmb3Jnb3RwYXNzd29yZGFjdGlvbicsCiAgICAgICAgICAgIG5hbWU9J2R2JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkludGVnZXJGaWVsZChkZWZhdWx0PTEpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nZm9yZ290cGFzc3dvcmRhY3Rpb24nLAogICAgICAgICAgICBuYW1lPSdzZW5kZXInLAogICAgICAgICAgICBmaWVsZD1kamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5maWVsZHMuanNvbmIuSlNPTkZpZWxkKGRlZmF1bHQ9eydkdic6IDEsICdmaW5nZXJwcmludCc6ICd1bmtub3duJ30pLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nZm9yZ290cGFzc3dvcmRhY3Rpb25oaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nZHYnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdmb3Jnb3RwYXNzd29yZGFjdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdzZW5kZXInLAogICAgICAgICAgICBmaWVsZD1kamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5maWVsZHMuanNvbmIuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field dv to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" ADD COLUMN "dv" integer DEFAULT 1 NOT NULL;
ALTER TABLE "ForgotPasswordAction" ALTER COLUMN "dv" DROP DEFAULT;
--
-- Add field sender to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" ADD COLUMN "sender" jsonb DEFAULT '{"dv": 1, "fingerprint": "unknown"}' NOT NULL;
ALTER TABLE "ForgotPasswordAction" ALTER COLUMN "sender" DROP DEFAULT;
--
-- Add field dv to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" ADD COLUMN "dv" integer NULL;
--
-- Add field sender to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" ADD COLUMN "sender" jsonb NULL;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field sender to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" DROP COLUMN "sender" CASCADE;
--
-- Add field dv to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" DROP COLUMN "dv" CASCADE;
--
-- Add field sender to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" DROP COLUMN "sender" CASCADE;
--
-- Add field dv to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" DROP COLUMN "dv" CASCADE;
COMMIT;

    `)
}
