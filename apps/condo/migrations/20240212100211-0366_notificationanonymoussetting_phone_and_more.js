// auto generated by kmigrator
// KMIGRATOR:0366_notificationanonymoussetting_phone_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMi40IG9uIDIwMjQtMDItMTIgMDU6MDIKCmltcG9ydCBkamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5pbmRleGVzCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzNjVfbm90aWZpY2F0aW9uYW5vbnltb3Vzc2V0dGluZ2hpc3RvcnlyZWNvcmRfYW5kX21vcmUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbmFub255bW91c3NldHRpbmcnLAogICAgICAgICAgICBuYW1lPSdwaG9uZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbmFub255bW91c3NldHRpbmdoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0ncGhvbmUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbmFub255bW91c3NldHRpbmcnLAogICAgICAgICAgICBuYW1lPSdlbWFpbCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9uYW5vbnltb3Vzc2V0dGluZycsCiAgICAgICAgICAgIG5hbWU9J21lc3NhZ2VUcmFuc3BvcnQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQ2hhckZpZWxkKGJsYW5rPVRydWUsIGNob2ljZXM9WygnZW1haWwnLCAnZW1haWwnKSwgKCdzbXMnLCAnc21zJyldLCBtYXhfbGVuZ3RoPTUwLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRJbmRleCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nbm90aWZpY2F0aW9uYW5vbnltb3Vzc2V0dGluZycsCiAgICAgICAgICAgIGluZGV4PWRqYW5nby5jb250cmliLnBvc3RncmVzLmluZGV4ZXMuQlRyZWVJbmRleChmaWVsZHM9WydwaG9uZScsICdtZXNzYWdlVHlwZSddLCBuYW1lPSduYXNfcGhvbmVfbWVzc2FnZVR5cGVfaWR4JyksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J25vdGlmaWNhdGlvbmFub255bW91c3NldHRpbmcnLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSkpLCBmaWVsZHM9KCdwaG9uZScsICdtZXNzYWdlVHlwZScsICdtZXNzYWdlVHJhbnNwb3J0JyksIG5hbWU9J25hc191bmlxdWVfcGhvbmVfbWVzc2FnZVR5cGVfbWVzc2FnZVRyYW5zcG9ydCcpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdub3RpZmljYXRpb25hbm9ueW1vdXNzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpLCAoJ21lc3NhZ2VUcmFuc3BvcnRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgncGhvbmUnLCAnbWVzc2FnZVR5cGUnKSwgbmFtZT0nbmFzX3VuaXF1ZV9waG9uZV9tZXNzYWdlVHlwZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdub3RpZmljYXRpb25hbm9ueW1vdXNzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpLCAoJ21lc3NhZ2VUeXBlX19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ3Bob25lJywgJ21lc3NhZ2VUcmFuc3BvcnQnKSwgbmFtZT0nbmFzX3VuaXF1ZV9waG9uZV9tZXNzYWdlVHJhbnNwb3J0JyksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field phone to notificationanonymoussetting
--
ALTER TABLE "NotificationAnonymousSetting" ADD COLUMN "phone" text NULL;
--
-- Add field phone to notificationanonymoussettinghistoryrecord
--
ALTER TABLE "NotificationAnonymousSettingHistoryRecord" ADD COLUMN "phone" text NULL;
--
-- Alter field email on notificationanonymoussetting
--
ALTER TABLE "NotificationAnonymousSetting" ALTER COLUMN "email" DROP NOT NULL;
--
-- Alter field messageTransport on notificationanonymoussetting
--
-- (no-op)
--
-- Create index nas_phone_messageType_idx on field(s) phone, messageType of model notificationanonymoussetting
--
CREATE INDEX "nas_phone_messageType_idx" ON "NotificationAnonymousSetting" USING btree ("phone", "messageType");
--
-- Create constraint nas_unique_phone_messageType_messageTransport on model notificationanonymoussetting
--
CREATE UNIQUE INDEX "nas_unique_phone_messageType_messageTransport" ON "NotificationAnonymousSetting" ("phone", "messageType", "messageTransport") WHERE "deletedAt" IS NULL;
--
-- Create constraint nas_unique_phone_messageType on model notificationanonymoussetting
--
CREATE UNIQUE INDEX "nas_unique_phone_messageType" ON "NotificationAnonymousSetting" ("phone", "messageType") WHERE ("deletedAt" IS NULL AND "messageTransport"::text IS NULL);
--
-- Create constraint nas_unique_phone_messageTransport on model notificationanonymoussetting
--
CREATE UNIQUE INDEX "nas_unique_phone_messageTransport" ON "NotificationAnonymousSetting" ("phone", "messageTransport") WHERE ("deletedAt" IS NULL AND "messageType"::text IS NULL);
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint nas_unique_phone_messageTransport on model notificationanonymoussetting
--
DROP INDEX IF EXISTS "nas_unique_phone_messageTransport";
--
-- Create constraint nas_unique_phone_messageType on model notificationanonymoussetting
--
DROP INDEX IF EXISTS "nas_unique_phone_messageType";
--
-- Create constraint nas_unique_phone_messageType_messageTransport on model notificationanonymoussetting
--
DROP INDEX IF EXISTS "nas_unique_phone_messageType_messageTransport";
--
-- Create index nas_phone_messageType_idx on field(s) phone, messageType of model notificationanonymoussetting
--
DROP INDEX IF EXISTS "nas_phone_messageType_idx";
--
-- Alter field messageTransport on notificationanonymoussetting
--
-- (no-op)
--
-- Alter field email on notificationanonymoussetting
--
ALTER TABLE "NotificationAnonymousSetting" ALTER COLUMN "email" SET NOT NULL;
--
-- Add field phone to notificationanonymoussettinghistoryrecord
--
ALTER TABLE "NotificationAnonymousSettingHistoryRecord" DROP COLUMN "phone" CASCADE;
--
-- Add field phone to notificationanonymoussetting
--
ALTER TABLE "NotificationAnonymousSetting" DROP COLUMN "phone" CASCADE;
COMMIT;

    `)
}
