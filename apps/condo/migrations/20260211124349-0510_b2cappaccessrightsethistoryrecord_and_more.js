// auto generated by kmigrator
// KMIGRATOR:0510_b2cappaccessrightsethistoryrecord_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMS41IG9uIDIwMjYtMDItMTEgMDc6NDMKCmltcG9ydCBkamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA1MDlfYXV0b18yMDI2MDIwNV8wNDA5JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdiMmNhcHBhY2Nlc3NyaWdodHNldGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdhcHAnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjYW5FeGVjdXRlU2VuZFZvSVBTdGFydFB1c2hNZXNzYWdlJywgbW9kZWxzLkJvb2xlYW5GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY2FuRXhlY3V0ZVNlbmRWb0lQQ2FuY2VsUHVzaE1lc3NhZ2UnLCBtb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9kYXRlJywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfYWN0aW9uJywgbW9kZWxzLkNoYXJGaWVsZChtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQjJDQXBwQWNjZXNzUmlnaHRTZXRIaXN0b3J5UmVjb3JkJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyY2FwcGFjY2Vzc3JpZ2h0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2FjY2Vzc1JpZ2h0U2V0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nYjJjYXBwYWNjZXNzcmlnaHRzZXQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdjYW5FeGVjdXRlU2VuZFZvSVBTdGFydFB1c2hNZXNzYWdlJywgbW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ2NhbkV4ZWN1dGVTZW5kVm9JUENhbmNlbFB1c2hNZXNzYWdlJywgbW9kZWxzLkJvb2xlYW5GaWVsZChkZWZhdWx0PUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoZGVmYXVsdD0xKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdhcHAnLCBtb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J2FwcCcsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5iMmNhcHAnKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY3JlYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0ndXBkYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9wdGlvbnM9ewogICAgICAgICAgICAgICAgJ2RiX3RhYmxlJzogJ0IyQ0FwcEFjY2Vzc1JpZ2h0U2V0JywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyY2FwcGFjY2Vzc3JpZ2h0JywKICAgICAgICAgICAgbmFtZT0nYWNjZXNzUmlnaHRTZXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J2FjY2Vzc1JpZ2h0U2V0JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmIyY2FwcGFjY2Vzc3JpZ2h0c2V0JyksCiAgICAgICAgKSwKICAgIF0K
// KMIGRATOR_VIEWS:0510_b2cappaccessrightsethistoryrecord_and_more:eyJkdiI6MSwibGlzdHMiOnsiVXNlciI6eyJmaWVsZHMiOlsiYXZhdGFyIiwiY3JlYXRlZEF0IiwiY3JlYXRlZEJ5IiwiY3VzdG9tQWNjZXNzIiwiZGVsZXRlZEF0IiwiZHYiLCJlbWFpbCIsImV4dGVybmFsRW1haWwiLCJleHRlcm5hbFBob25lIiwiZXh0ZXJuYWxTeXN0ZW1OYW1lIiwiaGFzTWFya2V0aW5nQ29uc2VudCIsImlkIiwiaXNBZG1pbiIsImlzRW1haWxWZXJpZmllZCIsImlzRXh0ZXJuYWxFbWFpbFZlcmlmaWVkIiwiaXNFeHRlcm5hbFBob25lVmVyaWZpZWQiLCJpc1Bob25lVmVyaWZpZWQiLCJpc1N1cHBvcnQiLCJpc1R3b0ZhY3RvckF1dGhlbnRpY2F0aW9uRW5hYmxlZCIsImxvY2FsZSIsIm1ldGEiLCJuYW1lIiwibmV3SWQiLCJwYXNzd29yZCIsInBob25lIiwicmlnaHRzU2V0Iiwic2VuZGVyIiwic2hvd0dsb2JhbEhpbnRzIiwidHlwZSIsInVwZGF0ZWRBdCIsInVwZGF0ZWRCeSIsInYiXSwic2Vuc2l0aXZlRmllbGRzIjpbImVtYWlsIiwiZXh0ZXJuYWxFbWFpbCIsImV4dGVybmFsUGhvbmUiLCJtZXRhIiwibmFtZSIsInBhc3N3b3JkIiwicGhvbmUiXX0sIkIyQ0FwcEFjY2Vzc1JpZ2h0U2V0Ijp7ImZpZWxkcyI6WyJhcHAiLCJjYW5FeGVjdXRlU2VuZFZvSVBDYW5jZWxQdXNoTWVzc2FnZSIsImNhbkV4ZWN1dGVTZW5kVm9JUFN0YXJ0UHVzaE1lc3NhZ2UiLCJjcmVhdGVkQXQiLCJjcmVhdGVkQnkiLCJkZWxldGVkQXQiLCJkdiIsImlkIiwibmV3SWQiLCJzZW5kZXIiLCJ1cGRhdGVkQXQiLCJ1cGRhdGVkQnkiLCJ2Il0sInNlbnNpdGl2ZUZpZWxkcyI6W119fX0=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model b2cappaccessrightsethistoryrecord
--
CREATE TABLE "B2CAppAccessRightSetHistoryRecord" ("app" uuid NULL, "canExecuteSendVoIPStartPushMessage" boolean NULL, "canExecuteSendVoIPCancelPushMessage" boolean NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field accessRightSet to b2cappaccessrighthistoryrecord
--
ALTER TABLE "B2CAppAccessRightHistoryRecord" ADD COLUMN "accessRightSet" uuid NULL;
--
-- Create model b2cappaccessrightset
--
CREATE TABLE "B2CAppAccessRightSet" ("canExecuteSendVoIPStartPushMessage" boolean NOT NULL, "canExecuteSendVoIPCancelPushMessage" boolean NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "app" uuid NOT NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
--
-- Add field accessRightSet to b2cappaccessright
--
ALTER TABLE "B2CAppAccessRight" ADD COLUMN "accessRightSet" uuid NULL CONSTRAINT "B2CAppAccessRight_accessRightSet_ccbd09cf_fk_B2CAppAcc" REFERENCES "B2CAppAccessRightSet"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "B2CAppAccessRight_accessRightSet_ccbd09cf_fk_B2CAppAcc" IMMEDIATE;
CREATE INDEX "B2CAppAccessRightSetHistoryRecord_history_id_b8f09758" ON "B2CAppAccessRightSetHistoryRecord" ("history_id");
ALTER TABLE "B2CAppAccessRightSet" ADD CONSTRAINT "B2CAppAccessRightSet_app_7303071a_fk_B2CApp_id" FOREIGN KEY ("app") REFERENCES "B2CApp" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "B2CAppAccessRightSet" ADD CONSTRAINT "B2CAppAccessRightSet_createdBy_a72bd1f5_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "B2CAppAccessRightSet" ADD CONSTRAINT "B2CAppAccessRightSet_updatedBy_c1472924_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "B2CAppAccessRightSet_createdAt_86055b9c" ON "B2CAppAccessRightSet" ("createdAt");
CREATE INDEX "B2CAppAccessRightSet_updatedAt_415601b4" ON "B2CAppAccessRightSet" ("updatedAt");
CREATE INDEX "B2CAppAccessRightSet_deletedAt_dfd19eb3" ON "B2CAppAccessRightSet" ("deletedAt");
CREATE INDEX "B2CAppAccessRightSet_app_7303071a" ON "B2CAppAccessRightSet" ("app");
CREATE INDEX "B2CAppAccessRightSet_createdBy_a72bd1f5" ON "B2CAppAccessRightSet" ("createdBy");
CREATE INDEX "B2CAppAccessRightSet_updatedBy_c1472924" ON "B2CAppAccessRightSet" ("updatedBy");
CREATE INDEX "B2CAppAccessRight_accessRightSet_ccbd09cf" ON "B2CAppAccessRight" ("accessRightSet");
COMMIT;

--
-- Create view for "B2CAppAccessRightSet" table
--
CREATE OR REPLACE VIEW "analytics"."B2CAppAccessRightSet" AS SELECT "app", "canExecuteSendVoIPCancelPushMessage", "canExecuteSendVoIPStartPushMessage", "createdAt", "createdBy", "deletedAt", "dv", "id", "newId", "sender", "updatedAt", "updatedBy", "v" FROM "public"."B2CAppAccessRightSet";

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field accessRightSet to b2cappaccessright
--
ALTER TABLE "B2CAppAccessRight" DROP COLUMN "accessRightSet" CASCADE;
--
-- Create model b2cappaccessrightset
--
DROP TABLE "B2CAppAccessRightSet" CASCADE;
--
-- Add field accessRightSet to b2cappaccessrighthistoryrecord
--
ALTER TABLE "B2CAppAccessRightHistoryRecord" DROP COLUMN "accessRightSet" CASCADE;
--
-- Create model b2cappaccessrightsethistoryrecord
--
DROP TABLE "B2CAppAccessRightSetHistoryRecord" CASCADE;
COMMIT;

--
-- Remove view for "B2CAppAccessRightSet" table
--
DROP VIEW IF EXISTS "analytics"."B2CAppAccessRightSet";

    `)
}
