// auto generated by kmigrator
// KMIGRATOR:0327_invoicehistoryrecord_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMi40IG9uIDIwMjMtMTAtMTkgMTI6MDMKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAzMjZfaW52b2ljZWNvbnRleHRoaXN0b3J5cmVjb3JkX2FuZF9tb3JlJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdpbnZvaWNlaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ2NvbnRleHQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdudW1iZXInLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdwcm9wZXJ0eScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VuaXRUeXBlJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndW5pdE5hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdhY2NvdW50TnVtYmVyJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndG9QYXknLCBtb2RlbHMuRGVjaW1hbEZpZWxkKGJsYW5rPVRydWUsIGRlY2ltYWxfcGxhY2VzPTQsIG1heF9kaWdpdHM9MTgsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdyb3dzJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndGlja2V0JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY29udGFjdCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NsaWVudCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3N0YXR1cycsIG1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2RhdGUnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9hY3Rpb24nLCBtb2RlbHMuQ2hhckZpZWxkKGNob2ljZXM9WygnYycsICdjJyksICgndScsICd1JyksICgnZCcsICdkJyldLCBtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnSW52b2ljZUhpc3RvcnlSZWNvcmQnLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW5hbWVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0naW52b2ljZWNvbnRleHQnLAogICAgICAgICAgICBvbGRfbmFtZT0ndmF0JywKICAgICAgICAgICAgbmV3X25hbWU9J3ZhdFBlcmNlbnQnLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW5hbWVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0naW52b2ljZWNvbnRleHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgb2xkX25hbWU9J3ZhdCcsCiAgICAgICAgICAgIG5ld19uYW1lPSd2YXRQZXJjZW50JywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2ludm9pY2Vjb250ZXh0JywKICAgICAgICAgICAgbmFtZT0nc2FsZXNUYXhQZXJjZW50JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkRlY2ltYWxGaWVsZChibGFuaz1UcnVlLCBkZWNpbWFsX3BsYWNlcz00LCBtYXhfZGlnaXRzPTE4LCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0naW52b2ljZWNvbnRleHRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nc2FsZXNUYXhQZXJjZW50JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkRlY2ltYWxGaWVsZChibGFuaz1UcnVlLCBkZWNpbWFsX3BsYWNlcz00LCBtYXhfZGlnaXRzPTE4LCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BbHRlckZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdpbnZvaWNlY29udGV4dCcsCiAgICAgICAgICAgIG5hbWU9J3RheFJlZ2ltZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoZGVmYXVsdD0nZ2VuZXJhbCcpLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0naW52b2ljZScsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ251bWJlcicsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3VuaXRUeXBlJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndW5pdE5hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdhY2NvdW50TnVtYmVyJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndG9QYXknLCBtb2RlbHMuRGVjaW1hbEZpZWxkKGRlY2ltYWxfcGxhY2VzPTQsIG1heF9kaWdpdHM9MTgpKSwKICAgICAgICAgICAgICAgICgncm93cycsIG1vZGVscy5KU09ORmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3N0YXR1cycsIG1vZGVscy5UZXh0RmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgndicsIG1vZGVscy5JbnRlZ2VyRmllbGQoZGVmYXVsdD0xKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnZHYnLCBtb2RlbHMuSW50ZWdlckZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdzZW5kZXInLCBtb2RlbHMuSlNPTkZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdjbGllbnQnLCBtb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J2NsaWVudCcsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICAgICAgKCdjb250YWN0JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjb250YWN0JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLmNvbnRhY3QnKSksCiAgICAgICAgICAgICAgICAoJ2NvbnRleHQnLCBtb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J2NvbnRleHQnLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5QUk9URUNULCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuaW52b2ljZWNvbnRleHQnKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nY3JlYXRlZEJ5JywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5TRVRfTlVMTCwgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSksCiAgICAgICAgICAgICAgICAoJ3Byb3BlcnR5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdwcm9wZXJ0eScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5wcm9wZXJ0eScpKSwKICAgICAgICAgICAgICAgICgndGlja2V0JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd0aWNrZXQnLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudGlja2V0JykpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VwZGF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdJbnZvaWNlJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model invoicehistoryrecord
--
CREATE TABLE "InvoiceHistoryRecord" ("context" uuid NULL, "number" jsonb NULL, "property" uuid NULL, "unitType" text NULL, "unitName" text NULL, "accountNumber" text NULL, "toPay" numeric(18, 4) NULL, "rows" jsonb NULL, "ticket" uuid NULL, "contact" uuid NULL, "client" uuid NULL, "status" text NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Rename field vat on invoicecontext to vatPercent
--
ALTER TABLE "InvoiceContext" RENAME COLUMN "vat" TO "vatPercent";
--
-- Rename field vat on invoicecontexthistoryrecord to vatPercent
--
ALTER TABLE "InvoiceContextHistoryRecord" RENAME COLUMN "vat" TO "vatPercent";
--
-- Add field salesTaxPercent to invoicecontext
--
ALTER TABLE "InvoiceContext" ADD COLUMN "salesTaxPercent" numeric(18, 4) NULL;
--
-- Add field salesTaxPercent to invoicecontexthistoryrecord
--
ALTER TABLE "InvoiceContextHistoryRecord" ADD COLUMN "salesTaxPercent" numeric(18, 4) NULL;
--
-- Alter field taxRegime on invoicecontext
--
ALTER TABLE "InvoiceContext" ALTER COLUMN "taxRegime" SET DEFAULT 'general';
UPDATE "InvoiceContext" SET "taxRegime" = 'general' WHERE "taxRegime" IS NULL; SET CONSTRAINTS ALL IMMEDIATE;
ALTER TABLE "InvoiceContext" ALTER COLUMN "taxRegime" SET NOT NULL;
ALTER TABLE "InvoiceContext" ALTER COLUMN "taxRegime" DROP DEFAULT;
--
-- Create model invoice
--
CREATE TABLE "Invoice" ("number" integer NOT NULL, "unitType" text NULL, "unitName" text NULL, "accountNumber" text NULL, "toPay" numeric(18, 4) NOT NULL, "rows" jsonb NOT NULL, "status" text NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "client" uuid NULL, "contact" uuid NULL, "context" uuid NOT NULL, "createdBy" uuid NULL, "property" uuid NULL, "ticket" uuid NULL, "updatedBy" uuid NULL);
CREATE INDEX "InvoiceHistoryRecord_history_id_d42ebe41" ON "InvoiceHistoryRecord" ("history_id");
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_client_95ec5986_fk_User_id" FOREIGN KEY ("client") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_contact_56992863_fk_Contact_id" FOREIGN KEY ("contact") REFERENCES "Contact" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_context_f82e2da9_fk_InvoiceContext_id" FOREIGN KEY ("context") REFERENCES "InvoiceContext" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_createdBy_daaa134b_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_property_117054a5_fk_Property_id" FOREIGN KEY ("property") REFERENCES "Property" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_ticket_eb180e52_fk_Ticket_id" FOREIGN KEY ("ticket") REFERENCES "Ticket" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Invoice" ADD CONSTRAINT "Invoice_updatedBy_a40231e2_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Invoice_createdAt_28992401" ON "Invoice" ("createdAt");
CREATE INDEX "Invoice_updatedAt_ec3478b9" ON "Invoice" ("updatedAt");
CREATE INDEX "Invoice_deletedAt_7cf57a3c" ON "Invoice" ("deletedAt");
CREATE INDEX "Invoice_client_95ec5986" ON "Invoice" ("client");
CREATE INDEX "Invoice_contact_56992863" ON "Invoice" ("contact");
CREATE INDEX "Invoice_context_f82e2da9" ON "Invoice" ("context");
CREATE INDEX "Invoice_createdBy_daaa134b" ON "Invoice" ("createdBy");
CREATE INDEX "Invoice_property_117054a5" ON "Invoice" ("property");
CREATE INDEX "Invoice_ticket_eb180e52" ON "Invoice" ("ticket");
CREATE INDEX "Invoice_updatedBy_a40231e2" ON "Invoice" ("updatedBy");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model invoice
--
DROP TABLE "Invoice" CASCADE;
--
-- Alter field taxRegime on invoicecontext
--
ALTER TABLE "InvoiceContext" ALTER COLUMN "taxRegime" DROP NOT NULL;
--
-- Add field salesTaxPercent to invoicecontexthistoryrecord
--
ALTER TABLE "InvoiceContextHistoryRecord" DROP COLUMN "salesTaxPercent" CASCADE;
--
-- Add field salesTaxPercent to invoicecontext
--
ALTER TABLE "InvoiceContext" DROP COLUMN "salesTaxPercent" CASCADE;
--
-- Rename field vat on invoicecontexthistoryrecord to vatPercent
--
ALTER TABLE "InvoiceContextHistoryRecord" RENAME COLUMN "vatPercent" TO "vat";
--
-- Rename field vat on invoicecontext to vatPercent
--
ALTER TABLE "InvoiceContext" RENAME COLUMN "vatPercent" TO "vat";
--
-- Create model invoicehistoryrecord
--
DROP TABLE "InvoiceHistoryRecord" CASCADE;
COMMIT;

    `)
}
