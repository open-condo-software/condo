// auto generated by kmigrator
// KMIGRATOR:0446_auto_20250203_0954:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMi41IG9uIDIwMjUtMDItMDMgMDk6NTQKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0NDVfb3JnYW5pemF0aW9uZW1wbG95ZWVyZXF1ZXN0aGlzdG9yeXJlY29yZF9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0nYXBwbWVzc2FnZXNldHRpbmcnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdyZWFzb24nLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCd0eXBlJywgbW9kZWxzLlRleHRGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnbm90aWZpY2F0aW9uV2luZG93U2l6ZScsIG1vZGVscy5JbnRlZ2VyRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ251bWJlck9mTm90aWZpY2F0aW9uSW5XaW5kb3cnLCBtb2RlbHMuSW50ZWdlckZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGRlZmF1bHQ9MSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnYjJiQXBwJywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdiMmJBcHAnLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5iMmJhcHAnKSksCiAgICAgICAgICAgICAgICAoJ2IyY0FwcCcsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nYjJjQXBwJywgbnVsbD1UcnVlLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEuYjJjYXBwJykpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQnknLCBtb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J2NyZWF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICAgICAgKCd1cGRhdGVkQnknLCBtb2RlbHMuRm9yZWlnbktleShibGFuaz1UcnVlLCBkYl9jb2x1bW49J3VwZGF0ZWRCeScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS51c2VyJykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdBcHBNZXNzYWdlU2V0dGluZycsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSdhcHBtZXNzYWdlc2V0dGluZ2hpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdiMmJBcHAnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdiMmNBcHAnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdyZWFzb24nLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCd0eXBlJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbm90aWZpY2F0aW9uV2luZG93U2l6ZScsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ251bWJlck9mTm90aWZpY2F0aW9uSW5XaW5kb3cnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NyZWF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3VwZGF0ZWRCeScsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9kYXRlJywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfYWN0aW9uJywgbW9kZWxzLkNoYXJGaWVsZChtYXhfbGVuZ3RoPTUwKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfaWQnLCBtb2RlbHMuVVVJREZpZWxkKGRiX2luZGV4PVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQXBwTWVzc2FnZVNldHRpbmdIaXN0b3J5UmVjb3JkJywKICAgICAgICAgICAgfSwKICAgICAgICApLAojICAgICAgICBtaWdyYXRpb25zLlJlbW92ZUZpZWxkKAojICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJjYXBwbWVzc2FnZXNldHRpbmcnLAojICAgICAgICAgICAgbmFtZT0nYXBwJywKIyAgICAgICAgKSwKIyAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKIyAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyY2FwcG1lc3NhZ2VzZXR0aW5nJywKIyAgICAgICAgICAgIG5hbWU9J2NyZWF0ZWRCeScsCiMgICAgICAgICksCiMgICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiMgICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmNhcHBtZXNzYWdlc2V0dGluZycsCiMgICAgICAgICAgICBuYW1lPSd1cGRhdGVkQnknLAojICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0JywKICAgICAgICAgICAgbmFtZT0nY2FuRXhlY3V0ZVNlbmRCMkJBcHBQdXNoTWVzc2FnZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1GYWxzZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBhY2Nlc3NyaWdodHNldCcsCiAgICAgICAgICAgIG5hbWU9J2Nhbk1hbmFnZU9yZ2FuaXphdGlvbkVtcGxveWVlcycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoZGVmYXVsdD1GYWxzZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdiMmJhcHBhY2Nlc3NyaWdodHNldCcsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRPcmdhbml6YXRpb25FbXBsb3llZXMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGRlZmF1bHQ9RmFsc2UpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0nYjJiYXBwYWNjZXNzcmlnaHRzZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nY2FuRXhlY3V0ZVNlbmRCMkJBcHBQdXNoTWVzc2FnZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2Nhbk1hbmFnZU9yZ2FuaXphdGlvbkVtcGxveWVlcycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5Cb29sZWFuRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2IyYmFwcGFjY2Vzc3JpZ2h0c2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2NhblJlYWRPcmdhbml6YXRpb25FbXBsb3llZXMnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuQm9vbGVhbkZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZENvbnN0cmFpbnQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2FwcG1lc3NhZ2VzZXR0aW5nJywKICAgICAgICAgICAgY29uc3RyYWludD1tb2RlbHMuVW5pcXVlQ29uc3RyYWludChjb25kaXRpb249bW9kZWxzLlEoKCdkZWxldGVkQXRfX2lzbnVsbCcsIFRydWUpKSwgZmllbGRzPSgnYjJjQXBwJywgJ3R5cGUnKSwgbmFtZT0nYXBwX21lc3NhZ2Vfc2V0dGluZ191bmlxdWVfYjJjX2FwcF9hbmRfdHlwZScpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRDb25zdHJhaW50KAogICAgICAgICAgICBtb2RlbF9uYW1lPSdhcHBtZXNzYWdlc2V0dGluZycsCiAgICAgICAgICAgIGNvbnN0cmFpbnQ9bW9kZWxzLlVuaXF1ZUNvbnN0cmFpbnQoY29uZGl0aW9uPW1vZGVscy5RKCgnZGVsZXRlZEF0X19pc251bGwnLCBUcnVlKSksIGZpZWxkcz0oJ2IyYkFwcCcsICd0eXBlJyksIG5hbWU9J2FwcF9tZXNzYWdlX3NldHRpbmdfdW5pcXVlX2IyYl9hcHBfYW5kX3R5cGUnKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuRGVsZXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2IyY2FwcG1lc3NhZ2VzZXR0aW5nJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuRGVsZXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2IyY2FwcG1lc3NhZ2VzZXR0aW5naGlzdG9yeXJlY29yZCcsCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model appmessagesetting
--
CREATE TABLE IF NOT EXISTS "AppMessageSetting" ("reason" text NOT NULL, "type" text NOT NULL, "notificationWindowSize" integer NOT NULL, "numberOfNotificationInWindow" integer NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "b2bApp" uuid NULL, "b2cApp" uuid NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
--
-- Create model appmessagesettinghistoryrecord
--
CREATE TABLE IF NOT EXISTS "AppMessageSettingHistoryRecord" ("b2bApp" uuid NULL, "b2cApp" uuid NULL, "reason" text NULL, "type" text NULL, "notificationWindowSize" integer NULL, "numberOfNotificationInWindow" integer NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field canExecuteSendB2BAppPushMessage to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "canExecuteSendB2BAppPushMessage" boolean DEFAULT false NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "canExecuteSendB2BAppPushMessage" DROP DEFAULT;
--
-- Add field canManageOrganizationEmployees to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "canManageOrganizationEmployees" boolean DEFAULT false NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "canManageOrganizationEmployees" DROP DEFAULT;
--
-- Add field canReadOrganizationEmployees to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" ADD COLUMN "canReadOrganizationEmployees" boolean DEFAULT false NOT NULL;
ALTER TABLE "B2BAppAccessRightSet" ALTER COLUMN "canReadOrganizationEmployees" DROP DEFAULT;
--
-- Add field canExecuteSendB2BAppPushMessage to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "canExecuteSendB2BAppPushMessage" boolean NULL;
--
-- Add field canManageOrganizationEmployees to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "canManageOrganizationEmployees" boolean NULL;
--
-- Add field canReadOrganizationEmployees to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" ADD COLUMN "canReadOrganizationEmployees" boolean NULL;
--
-- Create constraint app_message_setting_unique_b2c_app_and_type on model appmessagesetting
--
CREATE UNIQUE INDEX "app_message_setting_unique_b2c_app_and_type" ON "AppMessageSetting" ("b2cApp", "type") WHERE "deletedAt" IS NULL;
--
-- Create constraint app_message_setting_unique_b2b_app_and_type on model appmessagesetting
--
CREATE UNIQUE INDEX "app_message_setting_unique_b2b_app_and_type" ON "AppMessageSetting" ("b2bApp", "type") WHERE "deletedAt" IS NULL;
--
-- Delete model b2cappmessagesetting (in fix-database-migration-state.js)
--
-- DROP TABLE "B2CAppMessageSetting" CASCADE;
--
-- Delete model b2cappmessagesettinghistoryrecord (in fix-database-migration-state.js)
--
-- DROP TABLE "B2CAppMessageSettingHistoryRecord" CASCADE;

ALTER TABLE "AppMessageSetting" ADD CONSTRAINT "AppMessageSetting_b2bApp_715730ec_fk_B2BApp_id" FOREIGN KEY ("b2bApp") REFERENCES "B2BApp" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AppMessageSetting" ADD CONSTRAINT "AppMessageSetting_b2cApp_4bb405c2_fk_B2CApp_id" FOREIGN KEY ("b2cApp") REFERENCES "B2CApp" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AppMessageSetting" ADD CONSTRAINT "AppMessageSetting_createdBy_cf60575d_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "AppMessageSetting" ADD CONSTRAINT "AppMessageSetting_updatedBy_6d5512a1_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "AppMessageSetting_createdAt_f134bb32" ON "AppMessageSetting" ("createdAt");
CREATE INDEX "AppMessageSetting_updatedAt_d78cacf3" ON "AppMessageSetting" ("updatedAt");
CREATE INDEX "AppMessageSetting_deletedAt_f7184729" ON "AppMessageSetting" ("deletedAt");
CREATE INDEX "AppMessageSetting_b2bApp_715730ec" ON "AppMessageSetting" ("b2bApp");
CREATE INDEX "AppMessageSetting_b2cApp_4bb405c2" ON "AppMessageSetting" ("b2cApp");
CREATE INDEX "AppMessageSetting_createdBy_cf60575d" ON "AppMessageSetting" ("createdBy");
CREATE INDEX "AppMessageSetting_updatedBy_6d5512a1" ON "AppMessageSetting" ("updatedBy");
CREATE INDEX "AppMessageSettingHistoryRecord_history_id_66d9c757" ON "AppMessageSettingHistoryRecord" ("history_id");

--
-- Migrate data from B2CAppMessageSetting to AppMessageSetting
--
INSERT INTO "AppMessageSetting" ("reason", "type", "notificationWindowSize", "numberOfNotificationInWindow", "id", "v", "createdAt", "updatedAt", "deletedAt", "newId", "dv", "sender", "b2cApp", "createdBy", "updatedBy")
SELECT COALESCE("blockReason", 'reason'), "type", COALESCE("notificationWindowSize", 3600), COALESCE("numberOfNotificationInWindow", 1), "id", "v", "createdAt", "updatedAt", "deletedAt", "newId", "dv", "sender", "app", "createdBy", "updatedBy"
FROM "B2CAppMessageSetting";

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Delete model b2cappmessagesettinghistoryrecord
--
CREATE TABLE IF NOT EXISTS "B2CAppMessageSettingHistoryRecord" ("app" uuid NULL, "blockReason" text NULL, "isBlacklisted" boolean NULL, "type" text NULL, "notificationWindowSize" integer NULL, "numberOfNotificationInWindow" integer NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "dv" integer NULL, "sender" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Delete model b2cappmessagesetting
--
CREATE TABLE IF NOT EXISTS "B2CAppMessageSetting" ("blockReason" text NULL, "isBlacklisted" boolean NOT NULL, "type" text NOT NULL, "notificationWindowSize" integer NULL, "numberOfNotificationInWindow" integer NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "app" uuid NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL);
--
-- Create constraint app_message_setting_unique_b2b_app_and_type on model appmessagesetting
--
DROP INDEX IF EXISTS "app_message_setting_unique_b2b_app_and_type";
--
-- Create constraint app_message_setting_unique_b2c_app_and_type on model appmessagesetting
--
DROP INDEX IF EXISTS "app_message_setting_unique_b2c_app_and_type";
--
-- Add field canReadOrganizationEmployees to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "canReadOrganizationEmployees" CASCADE;
--
-- Add field canManageOrganizationEmployees to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "canManageOrganizationEmployees" CASCADE;
--
-- Add field canExecuteSendB2BAppPushMessage to b2bappaccessrightsethistoryrecord
--
ALTER TABLE "B2BAppAccessRightSetHistoryRecord" DROP COLUMN "canExecuteSendB2BAppPushMessage" CASCADE;
--
-- Add field canReadOrganizationEmployees to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "canReadOrganizationEmployees" CASCADE;
--
-- Add field canManageOrganizationEmployees to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "canManageOrganizationEmployees" CASCADE;
--
-- Add field canExecuteSendB2BAppPushMessage to b2bappaccessrightset
--
ALTER TABLE "B2BAppAccessRightSet" DROP COLUMN "canExecuteSendB2BAppPushMessage" CASCADE;
--
-- Create model appmessagesettinghistoryrecord
--
DROP TABLE "AppMessageSettingHistoryRecord" CASCADE;
--
-- Create model appmessagesetting
--
DROP TABLE "AppMessageSetting" CASCADE;
CREATE INDEX IF NOT EXISTS "B2CAppMessageSettingHistoryRecord_history_id_583c8d08" ON "B2CAppMessageSettingHistoryRecord" ("history_id");
ALTER TABLE "B2CAppMessageSetting" DROP CONSTRAINT IF EXISTS "B2CAppMessageSetting_app_6d573f2e_fk_B2CApp_id";
ALTER TABLE "B2CAppMessageSetting" ADD CONSTRAINT "B2CAppMessageSetting_app_6d573f2e_fk_B2CApp_id" FOREIGN KEY ("app") REFERENCES "B2CApp" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "B2CAppMessageSetting" DROP CONSTRAINT IF EXISTS "B2CAppMessageSetting_createdBy_d2428a98_fk_User_id";
ALTER TABLE "B2CAppMessageSetting" ADD CONSTRAINT "B2CAppMessageSetting_createdBy_d2428a98_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "B2CAppMessageSetting" DROP CONSTRAINT IF EXISTS "B2CAppMessageSetting_updatedBy_f907a2b2_fk_User_id";
ALTER TABLE "B2CAppMessageSetting" ADD CONSTRAINT "B2CAppMessageSetting_updatedBy_f907a2b2_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE UNIQUE INDEX IF NOT EXISTS "b2c_app_message_setting_unique_app_and_type" ON "B2CAppMessageSetting" ("app", "type") WHERE "deletedAt" IS NULL;
CREATE INDEX IF NOT EXISTS "B2CAppMessageSetting_createdAt_eb25d421" ON "B2CAppMessageSetting" ("createdAt");
CREATE INDEX IF NOT EXISTS "B2CAppMessageSetting_updatedAt_59b36073" ON "B2CAppMessageSetting" ("updatedAt");
CREATE INDEX IF NOT EXISTS "B2CAppMessageSetting_deletedAt_fad9c2e5" ON "B2CAppMessageSetting" ("deletedAt");
CREATE INDEX IF NOT EXISTS "B2CAppMessageSetting_app_6d573f2e" ON "B2CAppMessageSetting" ("app");
CREATE INDEX IF NOT EXISTS "B2CAppMessageSetting_createdBy_d2428a98" ON "B2CAppMessageSetting" ("createdBy");
CREATE INDEX IF NOT EXISTS "B2CAppMessageSetting_updatedBy_f907a2b2" ON "B2CAppMessageSetting" ("updatedBy");
COMMIT;

    `)
}
