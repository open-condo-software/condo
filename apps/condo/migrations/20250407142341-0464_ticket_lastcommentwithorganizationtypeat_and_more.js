// auto generated by kmigrator
// KMIGRATOR:0464_ticket_lastcommentwithorganizationtypeat_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMC43IG9uIDIwMjUtMDQtMDcgMDk6MjMKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzA0NjNfcGF5bWVudHNmaWxlaGlzdG9yeXJlY29yZF9wYXltZW50c2ZpbGVfYW5kX21vcmUnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldCcsCiAgICAgICAgICAgIG5hbWU9J2xhc3RDb21tZW50V2l0aE9yZ2FuaXphdGlvblR5cGVBdCcsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXQnLAogICAgICAgICAgICBuYW1lPSdsYXN0Q29tbWVudFdpdGhSZXNpZGVudFR5cGVDcmVhdGVkQnlVc2VyVHlwZScsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5DaGFyRmllbGQoYmxhbms9VHJ1ZSwgbWF4X2xlbmd0aD01MCwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2xhc3RDb21tZW50V2l0aE9yZ2FuaXphdGlvblR5cGVBdEZyb20nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nbGFzdENvbW1lbnRXaXRoT3JnYW5pemF0aW9uVHlwZUF0VG8nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nbGFzdENvbW1lbnRXaXRoUmVzaWRlbnRUeXBlQ3JlYXRlZEJ5VXNlclR5cGVGcm9tJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkNoYXJGaWVsZChibGFuaz1UcnVlLCBtYXhfbGVuZ3RoPTUwLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nbGFzdENvbW1lbnRXaXRoUmVzaWRlbnRUeXBlQ3JlYXRlZEJ5VXNlclR5cGVUbycsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5DaGFyRmllbGQoYmxhbms9VHJ1ZSwgbWF4X2xlbmd0aD01MCwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdsYXN0Q29tbWVudFdpdGhPcmdhbml6YXRpb25UeXBlQXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0aGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J2xhc3RDb21tZW50V2l0aFJlc2lkZW50VHlwZUNyZWF0ZWRCeVVzZXJUeXBlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcnRpY2tldGNvbW1lbnRyZWFkdGltZScsCiAgICAgICAgICAgIG5hbWU9J3JlYWRPcmdhbml6YXRpb25Db21tZW50QXQnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcnRpY2tldGNvbW1lbnRyZWFkdGltZWhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdyZWFkT3JnYW5pemF0aW9uQ29tbWVudEF0JywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';  
--
-- Add field lastCommentWithOrganizationTypeAt to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "lastCommentWithOrganizationTypeAt" timestamp with time zone NULL;
--
-- Add field lastCommentWithResidentTypeCreatedByUserType to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "lastCommentWithResidentTypeCreatedByUserType" varchar(50) NULL;
--
-- Add field lastCommentWithOrganizationTypeAtFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "lastCommentWithOrganizationTypeAtFrom" timestamp with time zone NULL;
--
-- Add field lastCommentWithOrganizationTypeAtTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "lastCommentWithOrganizationTypeAtTo" timestamp with time zone NULL;
--
-- Add field lastCommentWithResidentTypeCreatedByUserTypeFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "lastCommentWithResidentTypeCreatedByUserTypeFrom" varchar(50) NULL;
--
-- Add field lastCommentWithResidentTypeCreatedByUserTypeTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "lastCommentWithResidentTypeCreatedByUserTypeTo" varchar(50) NULL;
--
-- Add field lastCommentWithOrganizationTypeAt to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "lastCommentWithOrganizationTypeAt" timestamp with time zone NULL;
--
-- Add field lastCommentWithResidentTypeCreatedByUserType to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "lastCommentWithResidentTypeCreatedByUserType" text NULL;
--
-- Add field readOrganizationCommentAt to userticketcommentreadtime
--
ALTER TABLE "UserTicketCommentReadTime" ADD COLUMN "readOrganizationCommentAt" timestamp with time zone NULL;
--
-- Add field readOrganizationCommentAt to userticketcommentreadtimehistoryrecord
--
ALTER TABLE "UserTicketCommentReadTimeHistoryRecord" ADD COLUMN "readOrganizationCommentAt" timestamp with time zone NULL;
--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field readOrganizationCommentAt to userticketcommentreadtimehistoryrecord
--
ALTER TABLE "UserTicketCommentReadTimeHistoryRecord" DROP COLUMN "readOrganizationCommentAt" CASCADE;
--
-- Add field readOrganizationCommentAt to userticketcommentreadtime
--
ALTER TABLE "UserTicketCommentReadTime" DROP COLUMN "readOrganizationCommentAt" CASCADE;
--
-- Add field lastCommentWithResidentTypeCreatedByUserType to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "lastCommentWithResidentTypeCreatedByUserType" CASCADE;
--
-- Add field lastCommentWithOrganizationTypeAt to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "lastCommentWithOrganizationTypeAt" CASCADE;
--
-- Add field lastCommentWithResidentTypeCreatedByUserTypeTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "lastCommentWithResidentTypeCreatedByUserTypeTo" CASCADE;
--
-- Add field lastCommentWithResidentTypeCreatedByUserTypeFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "lastCommentWithResidentTypeCreatedByUserTypeFrom" CASCADE;
--
-- Add field lastCommentWithOrganizationTypeAtTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "lastCommentWithOrganizationTypeAtTo" CASCADE;
--
-- Add field lastCommentWithOrganizationTypeAtFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "lastCommentWithOrganizationTypeAtFrom" CASCADE;
--
-- Add field lastCommentWithResidentTypeCreatedByUserType to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "lastCommentWithResidentTypeCreatedByUserType" CASCADE;
--
-- Add field lastCommentWithOrganizationTypeAt to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "lastCommentWithOrganizationTypeAt" CASCADE;
COMMIT;

    `)
}
