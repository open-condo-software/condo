// auto generated by kmigrator
// KMIGRATOR:0215_remove_userexternalidentity_userexternalidentity_unique_identityid_and_identitytype_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMSBvbiAyMDIzLTAyLTAxIDA5OjMzCgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMjE0X21lcmdlXzIwMjMwMTMwXzE1MDQnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcmV4dGVybmFsaWRlbnRpdHknLAogICAgICAgICAgICBuYW1lPSd1c2VyRXh0ZXJuYWxJZGVudGl0eV91bmlxdWVfaWRlbnRpdHlpZF9hbmRfaWRlbnRpdHl0eXBlJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkQ29uc3RyYWludCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndXNlcmV4dGVybmFsaWRlbnRpdHknLAogICAgICAgICAgICBjb25zdHJhaW50PW1vZGVscy5VbmlxdWVDb25zdHJhaW50KGNvbmRpdGlvbj1tb2RlbHMuUSgoJ2RlbGV0ZWRBdF9faXNudWxsJywgVHJ1ZSkpLCBmaWVsZHM9KCdpZGVudGl0eUlkJywgJ2lkZW50aXR5VHlwZScpLCBuYW1lPSd1c2VyRXh0ZXJuYWxJZGVudGl0eV91bmlxdWVfaWRlbnRpdHlpZF9hbmRfaWRlbnRpdHl0eXBlJyksCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove constraint userExternalIdentity_unique_identityid_and_identitytype from model userexternalidentity
--
ALTER TABLE "UserExternalIdentity" DROP CONSTRAINT "userExternalIdentity_unique_identityid_and_identitytype";
--
-- Create constraint userExternalIdentity_unique_identityid_and_identitytype on model userexternalidentity
--
CREATE UNIQUE INDEX "userExternalIdentity_unique_identityid_and_identitytype" ON "UserExternalIdentity" ("identityId", "identityType") WHERE "deletedAt" IS NULL;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create constraint userExternalIdentity_unique_identityid_and_identitytype on model userexternalidentity
--
DROP INDEX IF EXISTS "userExternalIdentity_unique_identityid_and_identitytype";
--
-- Remove constraint userExternalIdentity_unique_identityid_and_identitytype from model userexternalidentity
--
ALTER TABLE "UserExternalIdentity" ADD CONSTRAINT "userExternalIdentity_unique_identityid_and_identitytype" UNIQUE ("identityId", "identityType");
COMMIT;

    `)
}
