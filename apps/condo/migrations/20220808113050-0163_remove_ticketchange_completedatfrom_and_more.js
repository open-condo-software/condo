// auto generated by kmigrator
// KMIGRATOR:0163_remove_ticketchange_completedatfrom_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMCBvbiAyMDIyLTA4LTA4IDA2OjMwCgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucwoKCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6CgogICAgZGVwZW5kZW5jaWVzID0gWwogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDE2Ml9yZW5hbWVfdGlja2V0Y2xhc3NpZmllcnJ1bGVfdGlja2V0Y2xhc3NpZmllcl9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nY29tcGxldGVkQXRGcm9tJywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuUmVtb3ZlRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2NvbXBsZXRlZEF0VG8nLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nbGFzdENvbW1lbnRBdEZyb20nLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5SZW1vdmVGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nbGFzdENvbW1lbnRBdFRvJywKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;

--
-- [CUSTOM] Set Statement Timeout to some large amount - 25 min (25 * 60 => 1500 sec)
--
SET statement_timeout = '1500s';       

--
-- Remove field completedAtFrom from ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "completedAtFrom" CASCADE;
--
-- Remove field completedAtTo from ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "completedAtTo" CASCADE;
--
-- Remove field lastCommentAtFrom from ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "lastCommentAtFrom" CASCADE;
--
-- Remove field lastCommentAtTo from ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "lastCommentAtTo" CASCADE;

--
-- [CUSTOM] Revert Statement Timeout to default amount - 10 secs
--
SET statement_timeout = '10s';

COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Remove field lastCommentAtTo from ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "lastCommentAtTo" timestamp with time zone NULL;
--
-- Remove field lastCommentAtFrom from ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "lastCommentAtFrom" timestamp with time zone NULL;
--
-- Remove field completedAtTo from ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "completedAtTo" timestamp with time zone NULL;
--
-- Remove field completedAtFrom from ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "completedAtFrom" timestamp with time zone NULL;
COMMIT;

    `)
}
