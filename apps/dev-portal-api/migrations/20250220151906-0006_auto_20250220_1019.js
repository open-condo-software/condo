// auto generated by kmigrator
// KMIGRATOR:0006_auto_20250220_1019:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI1LTAyLTIwIDEwOjE5Cgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucwoKCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6CgogICAgZGVwZW5kZW5jaWVzID0gWwogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDAwNV9hbHRlcl9iMmNhcHBhY2Nlc3NyaWdodF9lbnZpcm9ubWVudF9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICBdCg==

const { checkMinimalKVDataVersion, getKVClient } = require('@open-condo/keystone/kv')

exports.up = async () => {
    await checkMinimalKVDataVersion(2)
}

exports.down = async () => {
    const kv = getKVClient()
    const versionString = await kv.get('data_version')
    const dbSize = await kv.dbsize()
    // Rollback "empty db" if statement, since non-empty one mutates nothing
    if (dbSize === 1 && versionString === '2') {
        await kv.del('data_version')
    }
}
