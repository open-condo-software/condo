// auto generated by kmigrator
// KMIGRATOR:0010_webhookpayload:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI2LTAxLTE0IDA3OjEwCgppbXBvcnQgZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuaW5kZXhlcwppbXBvcnQgZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucywgbW9kZWxzCgoKY2xhc3MgTWlncmF0aW9uKG1pZ3JhdGlvbnMuTWlncmF0aW9uKToKCiAgICBkZXBlbmRlbmNpZXMgPSBbCiAgICAgICAgKCdfZGphbmdvX3NjaGVtYScsICcwMDA5X2IyYmFwcGhpc3RvcnlyZWNvcmRfYjJiYXBwJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkNyZWF0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSd3ZWJob29rcGF5bG9hZCcsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ3VybCcsIG1vZGVscy5UZXh0RmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ3BheWxvYWQnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdzZWNyZXQnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdldmVudFR5cGUnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdtb2RlbE5hbWUnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpdGVtSWQnLCBtb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzdGF0dXMnLCBtb2RlbHMuVGV4dEZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdhdHRlbXB0JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnbGFzdEh0dHBTdGF0dXNDb2RlJywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnbGFzdFJlc3BvbnNlQm9keScsIG1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2xhc3RFcnJvck1lc3NhZ2UnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdleHBpcmVzQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnbmV4dFJldHJ5QXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnbGFzdFNlbnRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ3YnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGRlZmF1bHQ9MSkpLAogICAgICAgICAgICAgICAgKCdjcmVhdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBkYl9pbmRleD1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIGRiX2luZGV4PVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIG1vZGVscy5VVUlERmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgbW9kZWxzLkpTT05GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnY3JlYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdjcmVhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgICAgICgndXBkYXRlZEJ5JywgbW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSd1cGRhdGVkQnknLCBudWxsPVRydWUsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLlNFVF9OVUxMLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudXNlcicpKSwKICAgICAgICAgICAgICAgICgnd2ViaG9va1N1YnNjcmlwdGlvbicsIG1vZGVscy5Gb3JlaWduS2V5KGJsYW5rPVRydWUsIGRiX2NvbHVtbj0nd2ViaG9va1N1YnNjcmlwdGlvbicsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uU0VUX05VTEwsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS53ZWJob29rc3Vic2NyaXB0aW9uJykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdXZWJob29rUGF5bG9hZCcsCiAgICAgICAgICAgICAgICAnaW5kZXhlcyc6IFtkamFuZ28uY29udHJpYi5wb3N0Z3Jlcy5pbmRleGVzLkJUcmVlSW5kZXgoZmllbGRzPVsnc3RhdHVzJywgJ25leHRSZXRyeUF0J10sIG5hbWU9J3dlYmhvb2tQYXlsb2FkX3N0YXR1c19ueHRSZXRyeUF0JyldLAogICAgICAgICAgICB9LAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model webhookpayload
--
CREATE TABLE "WebhookPayload" ("url" text NOT NULL, "payload" text NOT NULL, "secret" text NOT NULL, "eventType" text NOT NULL, "modelName" text NULL, "itemId" uuid NULL, "status" text NOT NULL, "attempt" integer NOT NULL, "lastHttpStatusCode" integer NULL, "lastResponseBody" text NULL, "lastErrorMessage" text NULL, "expiresAt" timestamp with time zone NOT NULL, "nextRetryAt" timestamp with time zone NOT NULL, "lastSentAt" timestamp with time zone NULL, "id" uuid NOT NULL PRIMARY KEY, "v" integer NOT NULL, "createdAt" timestamp with time zone NULL, "updatedAt" timestamp with time zone NULL, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL, "dv" integer NOT NULL, "sender" jsonb NOT NULL, "createdBy" uuid NULL, "updatedBy" uuid NULL, "webhookSubscription" uuid NULL);
ALTER TABLE "WebhookPayload" ADD CONSTRAINT "WebhookPayload_createdBy_5b4a8ff3_fk_User_id" FOREIGN KEY ("createdBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "WebhookPayload" ADD CONSTRAINT "WebhookPayload_updatedBy_bdc807c0_fk_User_id" FOREIGN KEY ("updatedBy") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "WebhookPayload" ADD CONSTRAINT "WebhookPayload_webhookSubscription_2db48436_fk_WebhookSu" FOREIGN KEY ("webhookSubscription") REFERENCES "WebhookSubscription" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "WebhookPayload_createdAt_d9ad003f" ON "WebhookPayload" ("createdAt");
CREATE INDEX "WebhookPayload_updatedAt_751f349c" ON "WebhookPayload" ("updatedAt");
CREATE INDEX "WebhookPayload_deletedAt_75898f15" ON "WebhookPayload" ("deletedAt");
CREATE INDEX "WebhookPayload_createdBy_5b4a8ff3" ON "WebhookPayload" ("createdBy");
CREATE INDEX "WebhookPayload_updatedBy_bdc807c0" ON "WebhookPayload" ("updatedBy");
CREATE INDEX "WebhookPayload_webhookSubscription_2db48436" ON "WebhookPayload" ("webhookSubscription");
CREATE INDEX "webhookPayload_status_nxtRetryAt" ON "WebhookPayload" USING btree ("status", "nextRetryAt");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model webhookpayload
--
DROP TABLE "WebhookPayload" CASCADE;
COMMIT;

    `)
}
