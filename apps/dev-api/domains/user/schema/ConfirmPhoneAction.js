/**
 * Generated by `createschema user.ConfirmPhoneAction 'code:Text; isVerified:Checkbox; expiresAt:DateTimeUtc'`
 */
const { historical, versioned, uuided, tracked, softDeleted, dvAndSender } = require('@open-condo/keystone/plugins')
const { GQLListSchema } = require('@open-condo/keystone/schema')

const { CONFIRM_ACTION_MAX_ATTEMPTS } = require('@dev-api/domains/user/constants')


const ConfirmPhoneAction = new GQLListSchema('ConfirmPhoneAction', {
    schemaDoc:
        'Internal schema used for user phone confirmation. ' +
        'It\'s impossible to work with it via API.',
    fields: {
        phone: {
            schemaDoc: 'Phone number to be verified',
            type: 'Text',
            isRequired: true,
        },
        code: {
            schemaDoc: 'Confirmation code. Generated inside one of action-creators, such as startConfirmPhoneAction',
            type: 'Text',
            isRequired: true,
        },
        isVerified: {
            schemaDoc:
                'Verifies number verification. ' +
                'If the number has been recently verified (before ConfirmPhoneAction expired), ' +
                'then knowing the ID ConfirmPhoneAction allows to register the user.',
            type: 'Checkbox',
            isRequired: true,
            defaultValue: false,
        },
        expiresAt: {
            schemaDoc:
                'Action expiration time. After the expiration time, ' +
                'it will not be possible to register a user using this action.',
            type: 'DateTimeUtc',
            isRequired: true,
        },
        attempts: {
            schemaDoc: 'Number of attempts to enter the code. ' +
                `When ${CONFIRM_ACTION_MAX_ATTEMPTS} attempts are reached, this action becomes invalid.`,
            type: 'Integer',
            isRequired: true,
            defaultValue: 0,
        },
    },
    plugins: [uuided(), versioned(), tracked(), softDeleted(), dvAndSender(), historical()],
    access: {
        read: false,
        create: false,
        update: false,
        delete: false,
        auth: false,
    },
})

module.exports = {
    ConfirmPhoneAction,
}
